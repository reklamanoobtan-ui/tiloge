<!DOCTYPE html>
<html lang="ka">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tilo.life - Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <meta name="google-adsense-account" content="ca-pub-5131926411609590">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5131926411609590"
        crossorigin="anonymous"></script>
    <style>
        :root {
            --primary: #4facfe;
            --secondary: #00f2fe;
            --accent: #ffd700;
            --danger: #ff4d4d;
            --bg: #0a0a0c;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background: var(--bg);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- Login Section --- */
        #login-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #0a0a0c 0%, #1a1a2e 100%);
        }

        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            padding: 50px;
            border-radius: 30px;
            border: 1px solid var(--border);
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .login-card h1 {
            font-size: 2rem;
            margin-bottom: 30px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            color: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 20px;
            outline: none;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--primary);
            background: rgba(0, 0, 0, 0.5);
        }

        /* --- Admin Layout --- */
        #admin-controls {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.02);
            border-right: 1px solid var(--border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
        }

        .sidebar-header {
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.2rem;
        }

        .nav-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(79, 172, 254, 0.1);
            color: var(--primary);
            border: 1px solid rgba(79, 172, 254, 0.2);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 40px;
            max-width: 1200px;
        }

        .header-bar {
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-bar h2 {
            font-size: 1.8rem;
            font-weight: 800;
        }

        /* Cards & Grids */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 30px;
            transition: 0.3s;
        }

        .card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .card h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
        }

        /* Tabs Logic */
        .tab-content {
            display: none !important;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active {
            display: block !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Buttons Custom */
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
        }

        .btn-gold {
            background: var(--accent);
            color: #000;
        }

        .btn-danger {
            background: var(--danger);
            color: #fff;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: #fff;
        }

        .btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Player List & Database */
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .players-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .site-fx-card {
            cursor: pointer;
            text-align: center;
            padding: 20px !important;
            font-weight: bold;
            font-size: 0.8rem;
            transition: 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
        }

        .site-fx-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.3);
        }

        .flex-row {
            display: flex;
            align-items: center;
        }

        .gap-5 {
            gap: 5px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }



        .player-details {
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-badge {
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 10px;
            border-radius: 8px;
            margin-right: 5px;
            margin-top: 5px;
            display: inline-block;
        }

        .stat-badge strong {
            color: var(--primary);
        }

        /* Status Toast */
        #status-msg {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border: 1px solid var(--border);
            display: none;
            animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* UI Helpers */
        .flex-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .full-width {
            width: 100%;
        }

        select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            color: #fff;
            padding: 12px;
            border-radius: 12px;
            outline: none;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .modal {
            background: #111118;
            padding: 35px;
            border-radius: 24px;
            border: 1px solid var(--border);
            width: 90%;
            max-width: 550px;
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6);
        }

        .hidden {
            display: none !important;
        }

        /* --- UI Polish & Responsive --- */

        /* Better Card Styling */
        .card,
        .mini-card,
        .login-card {
            background: rgba(30, 30, 40, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Input Fields Polish */
        input,
        select {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        input:focus,
        select:focus {
            background: rgba(0, 0, 0, 0.4);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.2);
        }

        /* Mobile Layout */
        @media (max-width: 900px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 5000;
                background: rgba(10, 10, 15, 0.98);
                width: 280px;
                box-shadow: 5px 0 30px rgba(0, 0, 0, 0.5);
            }

            .sidebar.mobile-active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
                padding-top: 80px;
                /* Space for toggle */
            }

            #mobile-nav-toggle {
                display: flex !important;
            }

            .header-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .header-bar .flex-row {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Mobile Toggle Button */
        #mobile-nav-toggle {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 6000;
            background: var(--primary);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            transition: 0.3s;
        }

        #mobile-nav-toggle:active {
            transform: scale(0.9);
        }
    </style>
</head>

<body>
    <button id="mobile-nav-toggle">â˜°</button>
    <!-- LOGIN SECTION -->
    <div id="login-section">
        <div class="login-card">
            <h1>ğŸ›¡ï¸ TILO ADMIN</h1>
            <input type="password" id="admin-pass" placeholder="áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒáƒáƒ áƒáƒšáƒ˜">
            <button class="btn btn-primary full-width" id="login-btn">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
            <p id="login-status" style="margin-top: 20px; color: var(--danger); font-size: 0.9rem;"></p>
        </div>
    </div>

    <!-- MAIN ADMIN PANEL -->
    <div id="admin-controls" style="display: none;">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">T</div>
                <h2 style="font-size: 1.2rem;">ADMIN PANEL</h2>
            </div>

            <div class="nav-items">
                <div class="nav-item active" data-tab="dashboard">ğŸ“Š Dashboard</div>
                <div class="nav-item" data-tab="online">ğŸŸ¢ áƒáƒœáƒšáƒáƒ˜áƒœ</div>
                <div class="nav-item" data-tab="players">ğŸ‘¥ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="site">ğŸŒ áƒ¡áƒáƒ˜áƒ¢áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</div>
                <div class="nav-item" data-tab="bosses">ğŸ‘¾ áƒ‘áƒáƒ¡áƒ”áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="systems">âš™ï¸ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ</div>
                <div class="nav-item" data-tab="events">ğŸ‰ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="youtube">ğŸ“º áƒ˜áƒ£áƒ—áƒ£áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="news">ğŸ“° áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="comments">ğŸ’¬ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="abuse" style="color: #ffd700;">ğŸ’  ADMIN ABUSE</div>
                <div class="nav-item" data-tab="critical" style="color: var(--danger);">âš ï¸ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜</div>
                <div class="nav-item" data-tab="console" style="color: #00ff00;">ğŸ’» áƒ™áƒáƒœáƒ¡áƒáƒšáƒ˜</div>
            </div>

            <div style="margin-top: auto;">
                <button class="btn btn-outline full-width" id="admin-logout-btn">ğŸ”’ áƒ’áƒáƒ›áƒáƒ¡áƒ•áƒšáƒ</button>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- DASHBOARD TAB -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="header-bar">
                    <h2>ğŸ“Š Dashboard</h2>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <h3>âš¡ áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜ áƒ›áƒáƒ áƒ—áƒ•áƒ</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.9rem;">áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜
                            áƒªáƒ•áƒšáƒ˜áƒšáƒ”áƒ‘áƒ</p>
                        <input type="text" id="target-nick" placeholder="áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜...">
                        <div class="flex-row mt-10" style="gap: 5px; flex-wrap: wrap;">
                            <input type="number" id="coin-amount" placeholder="áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ"
                                style="width: 100px; margin-bottom: 0;">
                            <button class="btn btn-gold" id="give-coins">ğŸª™ áƒ¥áƒáƒ˜áƒœáƒ˜áƒ¡ áƒ›áƒ˜áƒªáƒ”áƒ›áƒ</button>
                        </div>
                        <div class="flex-row mt-10" style="gap: 5px; flex-wrap: wrap;">
                            <input type="text" id="new-nick-val" placeholder="áƒáƒ®áƒáƒšáƒ˜ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜"
                                style="flex: 1; margin-bottom: 0;">
                            <button class="btn btn-primary" id="change-nick-btn">âœï¸ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ•áƒšáƒ</button>
                        </div>
                        <div class="flex-row mt-10" style="flex-wrap: wrap;">
                            <button class="btn btn-danger" id="ban-user">ğŸš« BAN ACCOUNT</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ğŸ’¬ Broadcast Message</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.9rem;">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ”áƒ— áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ
                            áƒ§áƒ•áƒ”áƒšáƒáƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ¨áƒ˜</p>
                        <input type="text" id="broadcast-msg" placeholder="áƒ áƒ áƒ“áƒáƒ•áƒ¬áƒ”áƒ áƒáƒ—?">
                        <button class="btn btn-primary full-width mt-10" id="send-broadcast">ğŸš€ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
                    </div>

                    <div class="card">
                        <h3>ğŸ“‰ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ‘áƒáƒœáƒ£áƒ¡áƒ˜</h3>
                        <div id="active-bonus-timer"
                            style="display: none; background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; border: 1px solid var(--accent);">
                            <p style="color: var(--accent); font-weight: 800; font-size: 1.1rem;" id="bonus-name">
                                Multiplier Active</p>
                            <p style="font-size: 2rem; font-weight: 800;" id="bonus-time-left">0:00</p>
                        </div>
                        <div id="no-bonus-msg" style="text-align: center; opacity: 0.3; padding: 20px;">
                            áƒáƒ›áƒŸáƒáƒ›áƒáƒ“ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ‘áƒáƒœáƒ£áƒ¡áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡
                        </div>
                    </div>
                </div>
                <div class="card" style="border: 1px solid #ffcc00; background: rgba(255,204,0,0.05);">
                    <h3 style="color: #ffcc00;">ğŸ“¢ Massive Announcement</h3>
                    <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.9rem;">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ”áƒ— áƒ“áƒ˜áƒ“áƒ˜ áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ áƒ”áƒ™áƒ áƒáƒœáƒ˜áƒ¡
                        áƒ‘áƒáƒšáƒáƒ¡ áƒ§áƒ•áƒ”áƒšáƒáƒ¡áƒ—áƒ•áƒ˜áƒ¡</p>
                    <input type="text" id="massive-msg" placeholder="áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒáƒ¥...">
                    <div class="flex-row mt-10">
                        <input type="number" id="massive-dur" value="10" placeholder="áƒ¬áƒáƒ›áƒ˜"
                            style="width: 80px; margin-bottom: 0;">
                        <button class="btn btn-gold full-width" id="send-massive">ğŸ”¥ áƒ§áƒ•áƒ”áƒšáƒáƒ¡áƒ—áƒáƒœ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
                    </div>
                </div>
            </div>

            <!-- ONLINE TAB -->
            <div id="tab-online" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸŸ¢ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜ áƒáƒœáƒšáƒáƒ˜áƒœáƒ¨áƒ˜</h2>
                    <div class="flex-row">
                        <span>áƒáƒœáƒšáƒáƒ˜áƒœ: <strong id="online-count" style="color: #00ff00;">0</strong></span>
                        <button class="btn btn-outline" id="refresh-online">ğŸ”„ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ</button>
                    </div>
                </div>
                <div id="online-list" class="players-container">
                    <!-- Loaded dynamically -->
                </div>
            </div>


            <!-- PLAYERS TAB -->
            <div id="tab-players" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ‘¥ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒáƒ–áƒ</h2>
                    <div class="flex-row">
                        <span>áƒ¡áƒ£áƒš: <strong id="total-players" style="color: var(--primary);">0</strong></span>
                        <button class="btn btn-outline" id="refresh-players">ğŸ”„ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ</button>
                    </div>
                </div>

                <div class="search-bar">
                    <input type="text" id="search-player" placeholder="áƒ«áƒ”áƒ‘áƒœáƒ áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜áƒ— áƒáƒœ áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜áƒ—..."
                        style="margin-bottom: 0;">
                    <select id="sort-players">
                        <option value="newest">ğŸ†• áƒáƒ®áƒáƒšáƒ˜ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜</option>
                        <option value="score">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ—</option>
                        <option value="coins">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜áƒ—</option>
                        <option value="time">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒ“áƒ áƒáƒ˜áƒ—</option>
                        <option value="nickname">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜áƒ—</option>
                    </select>
                </div>

                <div id="players-list" class="players-container">
                    <!-- Loaded dynamically -->
                </div>
            </div>


            <!-- SITE MANAGEMENT TAB -->
            <div id="tab-site" class="tab-content">
                <div class="header-bar">
                    <h2 style="color: #4facfe;">ğŸŒ áƒ¡áƒáƒ˜áƒ¢áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜ (20 áƒ”áƒ¤áƒ”áƒ¥áƒ¢áƒ˜)</h2>
                    <button class="btn btn-danger" onclick="stopEvent('site_effect')">ğŸ—‘ï¸ áƒ”áƒ¤áƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ’áƒáƒ—áƒ˜áƒ¨áƒ•áƒ</button>
                </div>
                <div class="dashboard-grid">
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'invert', 60)">
                        <span style="font-size: 1.5rem;">ğŸ™ƒ</span>
                        <span>Invert Colors</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'grayscale', 60)">
                        <span style="font-size: 1.5rem;">ğŸŒ‘</span>
                        <span>Grayscale</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'sepia', 60)">
                        <span style="font-size: 1.5rem;">ğŸ“œ</span>
                        <span>Retro Sepia</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'blur', 60)">
                        <span style="font-size: 1.5rem;">ğŸŒ«ï¸</span>
                        <span>Blur World</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'flicker', 60)">
                        <span style="font-size: 1.5rem;">âš¡</span>
                        <span>Glitch Flicker</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'shake', 60)">
                        <span style="font-size: 1.5rem;">ğŸ«¨</span>
                        <span>Screen Shake</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'mirror', 60)">
                        <span style="font-size: 1.5rem;">ğŸª</span>
                        <span>Mirror World</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'rotate', 60)">
                        <span style="font-size: 1.5rem;">ğŸ™ƒ</span>
                        <span>Upside Down</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'hue', 60)">
                        <span style="font-size: 1.5rem;">ğŸŒˆ</span>
                        <span>Color Shift</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'matrix', 60)">
                        <span style="font-size: 1.5rem;">ğŸ“Ÿ</span>
                        <span>Matrix Mode</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'vignette', 60)">
                        <span style="font-size: 1.5rem;">ğŸ¬</span>
                        <span>Cinematic</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'zoom', 60)">
                        <span style="font-size: 1.5rem;">ğŸ”</span>
                        <span>Zoom In</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'night', 60)">
                        <span style="font-size: 1.5rem;">ğŸŒ™</span>
                        <span>Night Mode</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'neon', 60)">
                        <span style="font-size: 1.5rem;">ğŸ”®</span>
                        <span>Neon Glow</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'tilt', 60)">
                        <span style="font-size: 1.5rem;">ğŸ“</span>
                        <span>Tilt Screen</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'contrast', 60)">
                        <span style="font-size: 1.5rem;">ğŸ­</span>
                        <span>High Contrast</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'outline', 60)">
                        <span style="font-size: 1.5rem;">âœï¸</span>
                        <span>Outline Mode</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'hide_ui', 60)">
                        <span style="font-size: 1.5rem;">ğŸ™ˆ</span>
                        <span>Hide Game UI</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'floating', 60)">
                        <span style="font-size: 1.5rem;">â˜ï¸</span>
                        <span>Floating Stains</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'disco', 60)">
                        <span style="font-size: 1.5rem;">ğŸ•º</span>
                        <span>Disco Party</span>
                    </div>
                </div>
            </div>

            <!-- BOSSES TAB -->
            <div id="tab-bosses" class="tab-content">
                <div class="header-bar">
                    <h2 style="color: #ff00ff;">ğŸ‘¾ áƒ‘áƒáƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
                </div>

                <!-- Regular Boss Section -->
                <div class="card"
                    style="background: rgba(255,0,255,0.05); border: 1px solid rgba(255,0,255,0.2); margin-bottom: 25px;">
                    <h3 style="color: #ff00ff; margin-bottom: 20px;">â­• áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="mini-card">
                            <span class="mini-label">ğŸ–¼ï¸ áƒ¤áƒáƒ¢áƒáƒ¡ URL</span>
                            <input type="text" id="reg-boss-img" class="search-input" placeholder="https://..."
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_img', 'reg-boss-img')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_img')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">ğŸ“ áƒ›áƒáƒ¡áƒ¨áƒ¢áƒáƒ‘áƒ˜ (1.0 = Normal)</span>
                            <input type="number" id="reg-boss-scale" class="search-input" value="1.0" step="0.1"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_scale', 'reg-boss-scale')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_scale')">OFF</button>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid" style="margin-bottom: 20px;">
                        <div class="mini-card">
                            <span class="mini-label">ğŸ‘ï¸ áƒ¡áƒ˜áƒ›áƒ™áƒ áƒ—áƒáƒšáƒ” (1-10)</span>
                            <input type="number" id="reg-boss-opacity" class="search-input" value="10" min="1" max="10"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_opacity', 'reg-boss-opacity')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_opacity')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">â¤ï¸ HP (Base) <span id="cur-reg-hp" class="cur-val"
                                    style="color:#ff00ff;"></span></span>
                            <input type="number" id="reg-boss-hp" class="search-input" value="10000"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_hp', 'reg-boss-hp')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_hp')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">â±ï¸ áƒ¡áƒáƒáƒ£áƒœáƒ˜áƒ¡ áƒ¡áƒ˜áƒ®áƒ¨áƒ˜áƒ áƒ” <span id="cur-reg-spawn" class="cur-val"
                                    style="color:#ff00ff;"></span></span>
                            <input type="number" id="reg-boss-spawn" class="search-input" value="60"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_spawn', 'reg-boss-spawn')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_spawn')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">ğŸ“ˆ áƒ’áƒáƒ©áƒ”áƒœáƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ <span id="cur-reg-thresh" class="cur-val"
                                    style="color:#ff00ff;"></span></span>
                            <input type="number" id="reg-boss-threshold" class="search-input" value="500"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_threshold', 'reg-boss-threshold')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_threshold')">OFF</button>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-outline full-width"
                        style="border-color: #ff00ff; color: #ff00ff; font-weight: bold; font-size: 1.1rem; padding: 15px;"
                        onclick="spawnBossNow('regular')">ğŸš€ áƒ›áƒ§áƒ˜áƒ¡áƒ˜áƒ”áƒ áƒ˜ áƒ¡áƒáƒáƒ£áƒœáƒ˜ (SPAWN REGULAR NOW)</button>
                </div>
                <button class="btn btn-danger full-width" style="margin-top: 15px;" onclick="resetRegularBoss()">ğŸ”„
                    áƒ§áƒ•áƒ”áƒšáƒ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ (RESET TO DEFAULT)</button>

                <!-- Triangle Boss Section -->
                <div class="card" style="background: rgba(0,255,255,0.05); border: 1px solid rgba(0,255,255,0.2);">
                    <h3 style="color: #00ffff; margin-bottom: 20px;">ğŸ”º áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜ áƒ‘áƒáƒ¡áƒ˜ (Elite)</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="mini-card">
                            <span class="mini-label">ğŸ–¼ï¸ áƒ¤áƒáƒ¢áƒáƒ¡ URL</span>
                            <input type="text" id="tri-boss-img" class="search-input" placeholder="https://..."
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('tri_boss_img', 'tri-boss-img')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('tri_boss_img')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">ğŸ“ áƒ›áƒáƒ¡áƒ¨áƒ¢áƒáƒ‘áƒ˜</span>
                            <input type="number" id="tri-boss-scale" class="search-input" value="1.0" step="0.1"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('tri_boss_scale', 'tri-boss-scale')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('tri_boss_scale')">OFF</button>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid" style="margin-bottom: 20px;">
                        <div class="mini-card">
                            <span class="mini-label">ğŸ‘ï¸ áƒ¡áƒ˜áƒ›áƒ™áƒ áƒ—áƒáƒšáƒ” (1-10)</span>
                            <input type="number" id="tri-boss-opacity" class="search-input" value="10" min="1" max="10"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('tri_boss_opacity', 'tri-boss-opacity')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('tri_boss_opacity')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">â¤ï¸ HP <span id="cur-tri-hp" class="cur-val"
                                    style="color:#00ffff;"></span></span>
                            <input type="number" id="tri-boss-hp" class="search-input" value="30000"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('tri_boss_hp', 'tri-boss-hp')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('tri_boss_hp')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">â±ï¸ áƒ¡áƒáƒáƒ£áƒœáƒ˜áƒ¡ áƒ¡áƒ˜áƒ®áƒ¨áƒ˜áƒ áƒ” <span id="cur-tri-spawn" class="cur-val"
                                    style="color:#00ffff;"></span></span>
                            <input type="number" id="tri-boss-spawn" class="search-input" value="120"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('tri_boss_spawn', 'tri-boss-spawn')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('tri_boss_spawn')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">ğŸ“ˆ áƒ’áƒáƒ©áƒ”áƒœáƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ <span id="cur-tri-thresh" class="cur-val"
                                    style="color:#00ffff;"></span></span>
                            <input type="number" id="tri-boss-threshold" class="search-input" value="1000"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('tri_boss_threshold', 'tri-boss-threshold')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('tri_boss_threshold')">OFF</button>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="background: rgba(0,255,255,0.1); margin-bottom: 0;">
                        <button class="btn btn-outline full-width"
                            style="border-color: #00ffff; color: #00ffff; font-weight: bold; font-size: 1.1rem; padding: 15px;"
                            onclick="spawnBossNow('triangle')">ğŸš€ áƒ›áƒ§áƒ˜áƒ¡áƒ˜áƒ”áƒ áƒ˜ áƒ¡áƒáƒáƒ£áƒœáƒ˜ (SPAWN ELITE NOW)</button>
                    </div>
                    <button class="btn btn-danger full-width" style="margin-top: 15px;" onclick="resetTriangleBoss()">ğŸ”„
                        áƒ§áƒ•áƒ”áƒšáƒ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ (RESET TO DEFAULT)</button>
                </div>

                <!-- Shared Enemy Settings -->
                <div class="card" style="margin-top: 25px; border-color: rgba(255, 77, 77, 0.3);">
                    <h3 style="color: #ff4d4d;">â˜ ï¸ áƒ¡áƒáƒ”áƒ áƒ—áƒ áƒ›áƒáƒ áƒ—áƒ•áƒ (Global Enemy Settings)</h3>
                    <div class="dashboard-grid" style="margin-top: 15px;">
                        <div class="mini-card">
                            <span class="mini-label">â˜ ï¸ áƒ‘áƒáƒ¡áƒ˜áƒ¡ HP <span id="cur-bosshp" class="cur-val"
                                    style="color:#ff4d4d;"></span></span>
                            <input type="number" id="val-bosshp" class="search-input" value="10000"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-danger" style="flex:2"
                                    onclick="quickTrigger('boss_hp', 'val-bosshp')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('boss_hp')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">âš¡ áƒ’áƒáƒ©áƒ”áƒœáƒ˜áƒ¡ áƒ“áƒ áƒ <span id="cur-spawn" class="cur-val"
                                    style="color:#ff4d4d;"></span></span>
                            <input type="number" id="val-spawn" class="search-input" value="500" placeholder="Low=Fast"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-danger" style="flex:2"
                                    onclick="quickTrigger('spawn_interval', 'val-spawn')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('spawn_interval')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">ğŸ”¢ áƒ‘áƒáƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒ˜áƒ›áƒ˜áƒ¢áƒ˜ <span id="cur-bosslimit" class="cur-val"
                                    style="color:#ff4d4d;"></span></span>
                            <input type="number" id="val-bosslimit" class="search-input" value="20"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-danger" style="flex:2"
                                    onclick="quickTrigger('boss_limit', 'val-bosslimit')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('boss_limit')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">ğŸ§¹ áƒšáƒáƒ¥áƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒ˜áƒ›áƒ˜áƒ¢áƒ˜ <span id="cur-stainlimit" class="cur-val"
                                    style="color:#ff4d4d;"></span></span>
                            <input type="number" id="val-stainlimit" class="search-input" value="50"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-danger" style="flex:2"
                                    onclick="quickTrigger('stain_limit', 'val-stainlimit')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('stain_limit')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card"
                            style="background: rgba(0, 255, 255, 0.1); border-color: rgba(0, 255, 255, 0.2);">
                            <span class="mini-label">â„ï¸ áƒ›áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ§áƒ˜áƒœáƒ•áƒ <span id="cur-freeze" class="cur-val"
                                    style="color:cyan;"></span></span>
                            <div class="flex-row gap-5" style="margin-top:28px;">
                                <button class="btn btn-primary" style="flex:2; background: rgba(0, 200, 200, 0.8);"
                                    onclick="quickTrigger('freeze_enemies', '1')">ON</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('freeze_enemies')">OFF</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-danger full-width" style="margin-top: 15px;"
                        onclick="resetGlobalEnemies()">ğŸ”„
                        áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ (RESET ALL GLOBAL)</button>
                </div>

                <!-- Status Display -->
                <div class="card" style="margin-top: 25px; background: rgba(0,0,0,0.3);">
                    <h3>ğŸ“Š áƒ›áƒ˜áƒ›áƒ“áƒ˜áƒœáƒáƒ áƒ” áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                        <div>
                            <span class="mini-label">â­• áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜</span>
                            <p id="regular-boss-status" style="color: #ff00ff; font-weight: bold;">Default Settings</p>
                        </div>
                        <div>
                            <span class="mini-label">ğŸ”º áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜ áƒ‘áƒáƒ¡áƒ˜</span>
                            <p id="triangle-boss-status" style="color: #00ffff; font-weight: bold;">Default Settings</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SYSTEMS TAB -->
            <div id="tab-systems" class="tab-content">
                <div class="header-bar">
                    <h2>âš™ï¸ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>ğŸ§¹ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒáƒ› áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!</p>
                        <button class="btn btn-danger full-width" id="reset-lb">âš  RESET LEADERBOARD âš </button>
                    </div>
                    <div class="card">
                        <h3>ğŸ“¡ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒ¢áƒ”áƒ¡áƒ¢áƒ˜</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ— Database-áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ áƒ“áƒ áƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜áƒ¡
                            áƒ›áƒ“áƒ’áƒáƒ›áƒáƒ áƒ”áƒáƒ‘áƒ</p>
                        <button class="btn btn-outline full-width" id="test-db-btn">ğŸ” DATABASE TEST</button>
                    </div>
                </div>
            </div>

            <!-- EVENTS TAB -->
            <div id="tab-events" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ‰ Global Events Management</h2>
                </div>
                <style>
                    .dashboard-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                        gap: 15px;
                    }

                    .mini-card {
                        padding: 15px;
                        background: rgba(255, 255, 255, 0.05);
                        border: 1px solid rgba(255, 255, 255, 0.1);
                        border-radius: 10px;
                    }

                    .mini-label {
                        display: block;
                        font-size: 0.8rem;
                        opacity: 0.7;
                        margin-bottom: 5px;
                    }
                </style>

                <div class="card" style="margin-bottom: 25px; background: rgba(0,0,0,0.3);">
                    <h3>ğŸŒ áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒ›áƒáƒ áƒ—áƒ•áƒ˜áƒ¡ áƒáƒáƒœáƒ”áƒšáƒ˜</h3>

                    <div
                        style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; display: flex; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label>â±ï¸ áƒ®áƒáƒœáƒ’áƒ áƒ«áƒšáƒ˜áƒ•áƒáƒ‘áƒ (áƒ¬áƒ—):</label>
                            <input type="number" id="global-duration" class="search-input" value="10"
                                style="width: 70px; text-align: center; padding: 5px;">
                        </div>

                        <div
                            style="display: flex; align-items: center; gap: 8px; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 15px;">
                            <label>ğŸ“ˆ áƒ’áƒáƒ«áƒšáƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ–áƒ áƒ“áƒ:</label>
                            <input type="number" id="val-upgrade-factor" class="search-input" value="1.3" step="0.1"
                                style="width: 70px; text-align: center; padding: 5px;">
                            <button class="btn btn-primary" style="padding: 5px 12px;"
                                onclick="quickTrigger('upgrade_config', 'val-upgrade-factor', 1440)">SET</button>
                            <button class="btn btn-outline" style="padding: 5px 12px;"
                                onclick="stopEvent('upgrade_config')">OFF</button>
                        </div>
                    </div>
                </div>

                <!-- Player & Economy -->
                <h4
                    style="margin: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; color: #ffd700;">
                    ğŸ‘¤ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ” & áƒ”áƒ™áƒáƒœáƒáƒ›áƒ˜áƒ™áƒ</h4>
                <div class="dashboard-grid">
                    <div class="mini-card">
                        <span class="mini-label">ğŸ’ª áƒ«áƒáƒšáƒ <span id="cur-strength" class="cur-val"
                                style="color:#4facfe;"></span></span>
                        <input type="number" id="val-strength" class="search-input" value="2"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('player_strength', 'val-strength')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('player_strength')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">ğŸ“ áƒ áƒáƒ“áƒ˜áƒ£áƒ¡áƒ˜ <span id="cur-radius" class="cur-val"
                                style="color:#4facfe;"></span></span>
                        <input type="number" id="val-radius" class="search-input" value="2"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('player_radius', 'val-radius')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('player_radius')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">ğŸ’° áƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜ <span id="cur-coin" class="cur-val"
                                style="color:#ffd700;"></span></span>
                        <input type="number" id="val-coin" class="search-input" value="2"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-gold" style="flex:2"
                                onclick="quickTrigger('coin_mult', 'val-coin')">SET</button>
                            <button class="btn btn-outline" style="flex:1" onclick="stopEvent('coin_mult')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">ğŸŒ áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜ <span id="cur-score" class="cur-val"
                                style="color:#ffd700;"></span></span>
                        <input type="number" id="val-score" class="search-input" value="2"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-gold" style="flex:2"
                                onclick="quickTrigger('multiplier', 'val-score')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('multiplier')">OFF</button>
                        </div>
                    </div>
                </div>

                <!-- Logic -->
                <h4
                    style="margin: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; color: #4facfe; display: flex; align-items: center; gap: 10px;">
                    ğŸ® áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒšáƒáƒ’áƒ˜áƒ™áƒ & áƒ áƒ”áƒŸáƒ˜áƒ›áƒ”áƒ‘áƒ˜
                </h4>
                <div class="dashboard-grid">
                    <!-- Crisis Settings -->
                    <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                        <span class="mini-label">âš ï¸ áƒ™áƒ áƒ˜áƒ–áƒ˜áƒ¡áƒ˜áƒ¡ áƒ“áƒ áƒ <span id="cur-crisis" class="cur-val"
                                style="color:orange;"></span></span>
                        <input type="number" id="val-crisis" class="search-input" value="30"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('crisis_time', 'val-crisis')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('crisis_time')">OFF</button>
                        </div>
                    </div>

                    <!-- Soap Milestone -->
                    <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                        <span class="mini-label">ğŸ§¼ áƒ¡áƒáƒáƒœáƒ˜áƒ¡ áƒ‘áƒáƒ áƒ˜áƒ”áƒ áƒ˜ <span id="cur-soap" class="cur-val"
                                style="color:#ff69b4;"></span></span>
                        <input type="number" id="val-soap" class="search-input" value="1250" placeholder="Score"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('soap_thresh', 'val-soap')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('soap_thresh')">OFF</button>
                        </div>
                    </div>

                    <!-- Minigame Milestone -->
                    <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                        <span class="mini-label">ğŸ® áƒ›áƒ˜áƒœáƒ˜-áƒ—áƒáƒ›áƒáƒ¨áƒ˜ <span id="cur-minigame" class="cur-val"
                                style="color:#4facfe;"></span></span>
                        <input type="number" id="val-minigame" class="search-input" value="1875" placeholder="Score"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('minigame_thresh', 'val-minigame')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('minigame_thresh')">OFF</button>
                        </div>
                    </div>

                    <!-- Spin Wheel Milestone -->
                    <div class="mini-card" style="border-color: rgba(255, 204, 0, 0.3);">
                        <span class="mini-label">ğŸ° Spin Wheel <span id="cur-spin" class="cur-val"
                                style="color:#ffcc00;"></span></span>
                        <input type="number" id="val-spinwheel" class="search-input" value="10000" placeholder="Score"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-gold" style="flex:2"
                                onclick="quickTrigger('spinwheel_thresh', 'val-spinwheel')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('spinwheel_thresh')">OFF</button>
                        </div>
                    </div>

                    <!-- God Mode -->
                    <div class="mini-card"
                        style="background: rgba(0, 255, 0, 0.05); border-color: rgba(0, 255, 0, 0.2);">
                        <span class="mini-label">ğŸ›¡ï¸ God Mode <span id="cur-god" class="cur-val"
                                style="color:lime;"></span></span>
                        <div class="flex-row gap-5" style="margin-top:28px;">
                            <button class="btn btn-primary" style="flex:2; background: rgba(0, 200, 0, 0.8);"
                                onclick="quickTrigger('god_mode', '1')">ON</button>
                            <button class="btn btn-outline" style="flex:1" onclick="stopEvent('god_mode')">OFF</button>
                        </div>
                    </div>

                    <!-- Freeze Enemies -->
                    <div class="mini-card"
                        style="background: rgba(0, 242, 254, 0.05); border-color: rgba(0, 242, 254, 0.2);">
                        <span class="mini-label">â„ï¸ Freeze Enemies <span id="cur-freeze" class="cur-val"
                                style="color:#00f2fe;"></span></span>
                        <div class="flex-row gap-5" style="margin-top:28px;">
                            <button class="btn btn-primary" style="flex:2; background: rgba(0, 242, 254, 0.6);"
                                onclick="quickTrigger('freeze_enemies', '1')">ON</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('freeze_enemies')">OFF</button>
                        </div>
                    </div>

                    <!-- Upgrade Balance -->
                    <div class="mini-card" style="border-color: rgba(255, 215, 0, 0.3);">
                        <span class="mini-label">âš¡ áƒ’áƒáƒ«áƒšáƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ«áƒáƒšáƒ <span id="cur-upgpow" class="cur-val"
                                style="color:gold;"></span></span>
                        <input type="number" id="val-upgpow" class="search-input" value="1.3" step="0.1"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('upgrade_power', 'val-upgpow')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('upgrade_power')">OFF</button>
                        </div>
                    </div>

                    <!-- Pink Bonus Balance -->
                    <div class="mini-card" style="border-color: rgba(255, 105, 180, 0.3);">
                        <span class="mini-label">ğŸŒ¸ Pink áƒ’áƒáƒ«áƒšáƒ˜áƒ”áƒ áƒ”áƒ‘áƒ <span id="cur-pinkpow" class="cur-val"
                                style="color:#ff69b4;"></span></span>
                        <input type="number" id="val-pinkpow" class="search-input" value="1.5" step="0.1"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('pink_power', 'val-pinkpow')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('pink_power')">OFF</button>
                        </div>
                    </div>
                </div>

                <div class="flex-row mt-20">
                    <button class="btn btn-danger full-width" id="stop-events"
                        style="opacity: 0.9; padding: 15px; font-size: 1.1rem;">ğŸ›‘ áƒ§áƒ•áƒ”áƒšáƒ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ
                        (RESET)</button>
                </div>
            </div>

            <!-- YOUTUBE TAB -->
            <div id="tab-youtube" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ“º YouTube Settings</h2>
                </div>
                <!-- YouTube Notifier Multi-Channel -->
                <div class="card"
                    style="background: rgba(0,0,0,0.2); border: 1px solid rgba(255,0,0,0.1); padding: 20px;">
                    <h4 style="color: #ff0000; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        ğŸ“¡ Multi-Channel Notification System
                        <span
                            style="font-size: 0.7rem; background: #333; color: #fff; padding: 2px 8px; border-radius: 4px;">LIMIT:
                            5</span>
                    </h4>

                    <div id="channel-config-list">
                        <div
                            style="display: grid; grid-template-columns: 3fr 1fr; gap: 10px; margin-bottom: 15px; background: rgba(255,255,255,0.02); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);">
                            <div style="font-size: 0.7rem; opacity: 0.5;">Channel ID (UC...) or Username</div>
                            <div style="font-size: 0.7rem; opacity: 0.5;">Weight %</div>

                            <input type="text" id="ch-id-1" class="search-input" placeholder="UCycgfC-1XTtOeMLr5Vz..."
                                style="width: 100%;">
                            <input type="number" id="ch-wt-1" class="search-input" value="100" style="width: 100%;">

                            <input type="text" id="ch-id-2" class="search-input" placeholder="Channel 2"
                                style="width: 100%;">
                            <input type="number" id="ch-wt-2" class="search-input" value="0" style="width: 100%;">

                            <input type="text" id="ch-id-3" class="search-input" placeholder="Channel 3"
                                style="width: 100%;">
                            <input type="number" id="ch-wt-3" class="search-input" value="0" style="width: 100%;">

                            <input type="text" id="ch-id-4" class="search-input" placeholder="Channel 4"
                                style="width: 100%;">
                            <input type="number" id="ch-wt-4" class="search-input" value="0" style="width: 100%;">

                            <input type="text" id="ch-id-5" class="search-input" placeholder="Channel 5"
                                style="width: 100%;">
                            <input type="number" id="ch-wt-5" class="search-input" value="0" style="width: 100%;">
                        </div>
                    </div>

                    <button class="btn btn-danger full-width" onclick="saveVideoConfig()"
                        style="background: #cc0000; border: none;">ğŸš€ UPDATE CHANNELS CONFIG</button>

                    <div
                        style="margin-top: 30px; padding: 20px; background: rgba(255, 215, 0, 0.03); border-radius: 15px; border: 1px dashed rgba(255, 215, 0, 0.3);">
                        <h4 style="color: var(--accent); margin-bottom: 15px;">ğŸ¯ forced_video (High Priority)</h4>
                        <p style="font-size: 0.8rem; opacity: 0.6; margin-bottom: 15px;">If active, this specific video
                            will always show instead of the channel rotation.</p>

                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="val-forced-video" class="search-input"
                                placeholder="https://www.youtube.com/watch?v=..." style="flex: 3;">
                            <button class="btn btn-gold" style="flex: 1;" onclick="saveForcedVideo()">SET VIDEO</button>
                        </div>
                        <button class="btn btn-outline full-width" onclick="stopEvent('forced_video')">DISABLE FORCED
                            VIDEO</button>
                    </div>
                </div>

                <div class="dashboard-grid mt-20">
                    <div class="mini-card" style="border-color: rgba(255, 0, 0, 0.3);">
                        <span class="mini-label">â±ï¸ Popup Sequence (sec) <span id="cur-timings" class="cur-val"
                                style="color:orange;"></span></span>
                        <input type="text" id="val-timings" class="search-input" value="10,30,60,300"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('video_timings', 'val-timings')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('video_timings')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card" style="border-color: rgba(255, 0, 0, 0.3);">
                        <span class="mini-label">ğŸ”„ Loop Interval (sec) <span id="cur-loop" class="cur-val"
                                style="color:cyan;"></span></span>
                        <input type="number" id="val-loop" class="search-input" value="300"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('video_loop', 'val-loop')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('video_loop')">OFF</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEWS TAB -->
            <div id="tab-news" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ“° áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="card" style="border-color: #5865F2;">
                        <h3 style="color: #5865F2;">ğŸŒ€ Discord Auto-Sync</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.85rem;">áƒáƒ˜áƒ¦áƒ” áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜ áƒ“áƒ˜áƒ¡áƒ¥áƒáƒ áƒ“áƒ˜áƒ¡
                            áƒ©áƒ”áƒœáƒ”áƒšáƒ˜áƒ“áƒáƒœ áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“.</p>
                        <div style="display: grid; gap: 10px;">
                            <input type="password" id="discord-token" placeholder="Discord Bot Token"
                                style="background: rgba(88, 101, 242, 0.1);">
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="discord-channel-id" value="1400447837757771816"
                                    placeholder="Channel ID" style="flex: 2;">
                                <input type="number" id="discord-limit" value="5" min="1" max="50"
                                    placeholder="áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ" style="flex: 1;">
                            </div>
                            <button class="btn btn-primary" id="sync-discord-btn"
                                style="background: #5865F2; border: none;">ğŸ”„ áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒáƒªáƒ˜áƒ</button>
                        </div>
                        <div id="sync-status" style="margin-top: 10px; font-size: 0.8rem; min-height: 1.2em;"></div>
                    </div>

                    <div class="card" style="border-color: #5865F2;">
                        <h3 style="color: #5865F2;">ğŸ“¢ Discord Webhook</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.85rem;">áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒ˜ áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡
                            áƒ“áƒáƒ“áƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡.</p>
                        <input type="password" id="discord-webhook-url" placeholder="Discord Webhook URL"
                            style="background: rgba(88, 101, 242, 0.1);">
                        <p style="font-size: 0.7rem; opacity: 0.4; margin-top: 5px;">áƒ©áƒáƒ¬áƒ”áƒ áƒ” áƒšáƒ˜áƒœáƒ™áƒ˜, áƒ áƒáƒ› áƒ¡áƒ˜áƒáƒ®áƒšáƒ”
                            áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ’áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒáƒ¡ áƒ©áƒáƒ¢áƒ¨áƒ˜.</p>
                    </div>

                    <!-- Fandom Wiki Auto-Sync -->
                    <div class="card" style="border-color: #f9a825; grid-column: span 2;">
                        <h3 style="color: #f9a825;">ğŸ”® Fandom Wiki Auto-Sync (Leaks)</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.85rem;">
                            áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ’áƒáƒ“áƒ›áƒáƒáƒ¥áƒ•áƒ¡ áƒáƒ®áƒáƒšáƒ˜ leak-áƒ”áƒ‘áƒ˜ Fandom Wiki-áƒ“áƒáƒœ áƒ“áƒ áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ¡ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ¨áƒ˜.
                        </p>
                        <div style="display:flex; flex-direction:column; gap:10px;">
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <button class="btn btn-primary" id="sync-fandom-btn"
                                    style="background: #f9a825; border: none; color: #000; font-weight: 700;">
                                    ğŸ”„ Sync All Now (áƒ‘áƒáƒšáƒ 3-3)
                                </button>
                                <label
                                    style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.85rem;">
                                    <input type="checkbox" id="fandom-auto-sync-toggle">
                                    <span>áƒáƒ•áƒ¢áƒ-áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒáƒªáƒ˜áƒ (10 áƒ¬áƒ—-áƒ¨áƒ˜ áƒ”áƒ áƒ—áƒ®áƒ”áƒš)</span>
                                </label>
                            </div>
                            <div style="font-size: 0.75rem; opacity: 0.7; display: flex; gap: 10px; flex-wrap: wrap;">
                                <span>â€¢ Steal a Brainrot (Leaks)</span>
                                <span>â€¢ Escape Tsunami (Leaks)</span>
                                <span>â€¢ 99 Nights (Update Log)</span>
                            </div>
                        </div>
                        <div id="fandom-sync-status"
                            style="margin-top: 12px; font-size: 0.8rem; min-height: 1.2em; color: #f9a825;"></div>
                        <div id="fandom-sync-log"
                            style="margin-top: 10px; max-height: 200px; overflow-y: auto; font-size: 0.75rem; opacity: 0.7;">
                        </div>
                    </div>

                    <div class="card" style="grid-column: span 2;">
                        <h3 id="news-form-title">ğŸ†• áƒáƒ®áƒáƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</h3>
                        <div style="margin-top: 20px; display: grid; gap: 15px;">
                            <input type="hidden" id="edit-news-id">
                            <input type="text" id="news-title-input" placeholder="áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜">
                            <div style="display: flex; gap: 15px;">
                                <input type="text" id="news-category-input" placeholder="áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ (áƒ›áƒáƒ’: áƒáƒáƒšáƒ˜áƒ¢áƒ˜áƒ™áƒ)"
                                    style="flex: 1;">
                                <input type="text" id="news-image-input" placeholder="áƒ¡áƒ£áƒ áƒáƒ—áƒ˜áƒ¡/GIF URL" style="flex: 1;">
                                <input type="text" id="news-video-input" placeholder="áƒ•áƒ˜áƒ“áƒ”áƒáƒ¡ URL (YouTube/Direct)"
                                    style="flex: 1;">
                            </div>
                            <textarea id="news-content-input" placeholder="áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ (HTML áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ˜áƒ—)"
                                style="height: 300px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; color: #fff; padding: 15px; font-family: inherit; resize: vertical;"></textarea>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" id="publish-news-btn" style="flex: 3;">ğŸš€
                                    áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ</button>
                                <button class="btn btn-outline hidden" id="cancel-news-edit-btn"
                                    style="flex: 1;">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="grid-column: span 3;">
                        <h3>ğŸ“‹ áƒáƒ áƒ¡áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜</h3>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-outline" onclick="loadAdminNews()"
                                style="margin-bottom: 15px; font-size: 0.8rem;">ğŸ”„ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ</button>
                            <div id="admin-news-list"
                                style="display: grid; gap: 10px; max-height: 500px; overflow-y: auto; padding-right: 5px;">
                                <!-- News items will load here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COMMENTS TAB -->
            <div id="tab-comments" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ’¬ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
                    <button class="btn btn-outline" onclick="loadAdminComments()">ğŸ”„ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ</button>
                </div>

                <div class="dashboard-grid" style="display: block;">
                    <div class="card">
                        <h3>áƒ§áƒ•áƒ”áƒšáƒ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜</h3>
                        <div id="admin-comments-list" style="margin-top: 20px; display: grid; gap: 15px;">
                            <!-- Comments will load here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- CRITICAL TAB -->
            <div id="tab-critical" class="tab-content">
                <div class="header-bar">
                    <h2 style="color: var(--danger);">âš ï¸ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ”áƒ‘áƒ˜</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="card" style="border-color: var(--accent);">
                        <h3 style="color: var(--accent);">ğŸš€ DATABASE SETUP</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒáƒ®áƒáƒšáƒ˜ Database-áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ áƒ—áƒ•áƒ áƒ“áƒ áƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ áƒ”áƒ áƒ—
                            áƒ™áƒšáƒ˜áƒ™áƒ¨áƒ˜.</p>
                        <button class="btn btn-gold full-width" id="run-setup-btn">RUN SETUP SCRIPT</button>
                    </div>
                    <div class="card" style="border-color: var(--danger);">
                        <h3 style="color: var(--danger);">ğŸ”¥ SITE RESTART</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ“áƒ áƒ¡áƒ”áƒ¡áƒ˜áƒ”áƒ‘áƒ˜áƒ¡
                            áƒ’áƒáƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ.</p>
                        <button class="btn btn-danger full-width" id="restart-site">RESTART NOW</button>
                    </div>
                    <div class="card" style="border-color: var(--danger); background: rgba(255, 77, 77, 0.05);">
                        <h3 style="color: var(--danger);">ğŸ§¹ WIPE DATA</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒáƒ áƒáƒ’áƒ áƒ”áƒ¡áƒ˜áƒ¡ áƒáƒœ áƒ›áƒ—áƒšáƒ˜áƒáƒœáƒ˜ áƒ‘áƒáƒ–áƒ˜áƒ¡ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ.</p>
                        <button class="btn btn-gold full-width" id="reset-scores-only-btn"
                            style="margin-bottom: 10px;">ğŸ† áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ áƒ”áƒ¡áƒ¢áƒáƒ áƒ¢áƒ”áƒ‘áƒ</button>
                        <button class="btn btn-danger full-width" id="wipe-progress-btn"
                            style="margin-bottom: 10px;">RESET
                            PROGRESS (Keep Accounts)</button>
                        <button class="btn btn-danger full-width" id="full-wipe-btn"
                            style="margin-bottom: 10px; background: #ff0000; border: 2px solid white;">ğŸ”¥ FULL RESET
                            (Delete All
                            Accounts)</button>
                        <button class="btn btn-outline full-width" id="drop-vip-col-btn"
                            style="border-color: #ffd700; color: #ffd700;">ğŸ—‘ï¸ DROP LEGACY VIP COLUMN</button>
                    </div>
                </div>
            </div>

            <!-- ADMIN ABUSE TAB -->
            <div id="tab-abuse" class="tab-content">
                <div class="header-bar">
                    <h2 id="abuse-form-title">ğŸ’  ADMIN ABUSE áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
                </div>

                <div class="dashboard-grid">
                    <div class="card" style="border-color: var(--news-primary);">
                        <input type="hidden" id="edit-abuse-id">
                        <label>áƒ¡áƒšáƒáƒ¢áƒ˜áƒ¡ áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜</label>
                        <input type="text" id="abuse-title-input" placeholder="áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜...">

                        <label>áƒ¡áƒ£áƒ áƒáƒ—áƒ˜áƒ¡ áƒšáƒ˜áƒœáƒ™áƒ˜</label>
                        <input type="text" id="abuse-image-input" placeholder="https://...">

                        <label>áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒ áƒ (Countdown)</label>
                        <input type="datetime-local" id="abuse-time-input">

                        <label>áƒ’áƒáƒ“áƒáƒ¡áƒáƒ¡áƒ•áƒšáƒ”áƒšáƒ˜ áƒšáƒ˜áƒœáƒ™áƒ˜</label>
                        <input type="text" id="abuse-link-input" placeholder="https://...">

                        <div class="flex-row mt-10" style="gap: 10px;">
                            <button class="btn btn-primary" id="publish-abuse-btn" onclick="publishAbuseItem()"
                                style="flex:2;">ğŸš€ áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ</button>
                            <button class="btn btn-outline hidden" id="cancel-abuse-edit-btn" onclick="resetAbuseForm()"
                                style="flex:1;">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ğŸ“‹ áƒáƒ áƒ¡áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¡áƒšáƒáƒ¢áƒ”áƒ‘áƒ˜ (áƒ‘áƒáƒšáƒ 10)</h3>
                        <div id="admin-abuse-list"
                            style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
                            <!-- Items list -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- CONSOLE TAB -->
            <div id="tab-console" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ’» áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒ™áƒáƒœáƒ¡áƒáƒšáƒ˜</h2>
                    <button class="btn btn-danger" onclick="clearConsole()">ğŸ—‘ï¸ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ</button>
                </div>
                <div id="console-output"
                    style="background: #1e1e1e; color: #d4d4d4; padding: 15px; height: 500px; overflow-y: scroll; font-family: 'Courier New', monospace; border-radius: 10px; border: 1px solid #333; font-size: 0.9rem;">
                    <div style="color: #6a9955;">[INFO] áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ áƒ›áƒ–áƒáƒ“áƒáƒ...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Messages -->
    <div id="status-msg"></div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal-overlay hidden">
        <div class="modal">
            <h2 style="margin-bottom: 20px;">âœï¸ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</h2>
            <div class="mini-card" style="margin-bottom: 10px;">
                <span class="mini-label">áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜</span>
                <input type="text" id="edit-user-nick" class="search-input" style="width: 100%;">
            </div>
            <div class="mini-card" style="margin-bottom: 10px;">
                <span class="mini-label">áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜ (áƒáƒ  áƒ˜áƒªáƒ•áƒšáƒ”áƒ‘áƒ)</span>
                <input type="text" id="edit-user-email" class="search-input" style="width: 100%; opacity: 0.5;"
                    readonly>
            </div>
            <div class="dashboard-grid" style="margin-bottom: 15px;">
                <div class="mini-card">
                    <span class="mini-label">â­ áƒ¥áƒ£áƒšáƒ</span>
                    <input type="number" id="edit-user-score" class="search-input" style="width: 100%;">
                </div>
                <div class="mini-card">
                    <span class="mini-label">ğŸª™ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜</span>
                    <input type="number" id="edit-user-coins" class="search-input" style="width: 100%;">
                </div>
                <div class="mini-card">
                    <span class="mini-label">ğŸ’° áƒ¡áƒ£áƒš áƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜</span>
                    <input type="number" id="edit-user-total-coins" class="search-input" style="width: 100%;">
                </div>
            </div>

            <!-- Ban Management -->
            <div id="ban-management-section"
                style="margin-bottom: 20px; padding: 15px; border: 1px dashed var(--danger); border-radius: 12px; display: none;">
                <h4 style="color: var(--danger); margin-bottom: 10px;">ğŸ›‘ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ˜áƒšáƒ˜áƒ!</h4>
                <p id="ban-info" style="font-size: 0.8rem; margin-bottom: 15px; opacity: 0.7;"></p>
                <button class="btn btn-outline" style="border-color: #00ff00; color: #00ff00; width: 100%;"
                    onclick="removeBan()">âœ… áƒ‘áƒáƒœáƒ˜áƒ¡/áƒ¢áƒáƒ˜áƒ›áƒáƒ£áƒ¢áƒ˜áƒ¡ áƒ›áƒáƒ®áƒ¡áƒœáƒ</button>
            </div>

            <!-- Ban Creation -->
            <div id="ban-create-section" style="margin-bottom: 20px;">
                <button class="btn btn-danger"
                    style="width: 100%; background: rgba(255, 0, 0, 0.1); border: 1px solid var(--danger);"
                    onclick="moderateUser(get('edit-user-email').value, 'ban')">ğŸš« áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ•áƒ (BAN)</button>
            </div>

            <div class="flex-row gap-10">
                <button class="btn btn-primary" style="flex: 2" onclick="saveUserEdit()">áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
                <button class="btn btn-outline" style="flex: 1"
                    onclick="get('edit-user-modal').classList.add('hidden')">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { neon } from 'https://cdn.jsdelivr.net/npm/@neondatabase/serverless@0.9.4/+esm';
        const sql = neon("postgresql://neondb_owner:npg_NBPsUe3FXb4o@ep-calm-wildflower-aim8iczt-pooler.c-4.us-east-1.aws.neon.tech/neondb?sslmode=require");

        const get = (id) => document.getElementById(id);
        const status = get('status-msg');

        function log(msg, color = 'var(--primary)') {
            status.textContent = msg;
            status.style.display = 'block';
            status.style.borderLeft = `5px solid ${color}`;
            setTimeout(() => {
                status.style.display = 'none';
            }, 4000);
        }

        // --- Tabs Logic ---
        document.querySelectorAll('.nav-item').forEach(item => {
            item.onclick = () => {
                const target = item.dataset.tab;

                // Update nav
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                // Update content
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                get(`tab-${target}`).classList.add('active');

                // Auto-load if entering tab
                if (target === 'players') loadPlayers();
                if (target === 'online') loadOnlinePlayers();
                if (target === 'comments') loadAdminComments();
                if (target === 'abuse') loadAdminAbuse();
            };
        });

        // Console Logic
        async function updateConsole() {
            try {
                const logs = await sql`SELECT * FROM chat_messages WHERE nickname = 'SYSTEM_LOG' ORDER BY created_at DESC LIMIT 50`;
                const output = get('console-output');
                if (!output) return;
                output.innerHTML = '';
                logs.forEach(log => {
                    const parts = log.message.split('|');
                    let level = 'INFO';
                    let msg = log.message;
                    if (parts.length > 1) { level = parts[0]; msg = parts.slice(1).join('|'); }

                    let color = '#d4d4d4';
                    if (level === 'ERROR') color = '#f44336';
                    if (level === 'WARN') color = '#ff9800';
                    if (level === 'SUCCESS') color = '#4caf50';

                    const time = new Date(log.created_at).toLocaleTimeString();
                    const line = document.createElement('div');
                    line.style.borderBottom = '1px solid #333';
                    line.style.padding = '4px 0';
                    line.innerHTML = `<span style="color: #666;">[${time}]</span> <span style="font-weight:bold; color:${color}">[${level}]</span> ${msg}`;
                    output.appendChild(line);
                });
            } catch (e) { }
        }

        window.clearConsole = async () => {
            if (confirm('áƒ¬áƒáƒ•áƒ¨áƒáƒšáƒáƒ— áƒšáƒáƒ’áƒ”áƒ‘áƒ˜?')) {
                try { await sql`DELETE FROM chat_messages WHERE nickname = 'SYSTEM_LOG'`; updateConsole(); } catch (e) { }
            }
        };
        setInterval(() => { if (get('tab-console')?.classList.contains('active')) updateConsole(); }, 3000);

        // Auth Logic
        const adminPass = "unoobi123!123!";

        // Auto-login check
        window.addEventListener('DOMContentLoaded', () => {
            const savedPass = localStorage.getItem('tilo_admin_auth');
            const authTime = parseInt(localStorage.getItem('tilo_admin_auth_time') || '0');
            const thirtyDays = 30 * 24 * 60 * 60 * 1000;

            if (savedPass === adminPass && (Date.now() - authTime) < thirtyDays) {
                enterAdmin();
            }
        });

        function enterAdmin() {
            get('login-section').style.display = 'none';
            get('admin-controls').style.display = 'flex';
            log('áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ—, áƒáƒ“áƒ›áƒ˜áƒœ!', 'var(--primary)');
            if (typeof updateDashboardStats === 'function') updateDashboardStats();
            loadPlayers();
        }

        const loginBtn = get('login-btn');
        if (loginBtn) {
            loginBtn.onclick = async () => {
                const passInput = get('admin-pass');
                const pass = passInput ? passInput.value.trim() : '';
                const loginStatus = get('login-status');

                if (!pass) return;
                if (loginStatus) loginStatus.textContent = "áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ¡...";

                if (pass === adminPass) {
                    localStorage.setItem('tilo_admin_auth', pass);
                    localStorage.setItem('tilo_admin_auth_time', Date.now().toString());
                    enterAdmin();
                } else {
                    if (loginStatus) {
                        loginStatus.textContent = "áƒáƒáƒ áƒáƒšáƒ˜ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜áƒ!";
                        loginStatus.style.color = "var(--danger)";
                    }
                }
            };
        }

        get('admin-logout-btn').onclick = () => {
            localStorage.removeItem('tilo_admin_auth');
            localStorage.removeItem('tilo_admin_auth_time');
            location.reload();
        };

        get('give-coins').onclick = async () => {
            const name = get('target-nick').value.trim();
            const amount = parseInt(get('coin-amount').value) || 0;
            if (!name || amount <= 0) return alert('áƒ›áƒ˜áƒ£áƒ—áƒ˜áƒ—áƒ”áƒ— áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜ áƒ“áƒ áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ!');
            try {
                await sql`UPDATE users SET coins = coins + ${amount}, total_coins = total_coins + ${amount} WHERE nickname = ${name}`;
                log(`áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒ ${amount} áƒ¥áƒáƒ˜áƒœáƒ˜ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ¡áƒ—áƒáƒœ: ${name}`, 'gold');
                get('coin-amount').value = '';
            } catch (e) { log('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ‘áƒáƒ–áƒáƒ¡áƒ—áƒáƒœ', 'red'); }
        };

        get('change-nick-btn').onclick = async () => {
            const oldName = get('target-nick').value.trim();
            const newName = get('new-nick-val').value.trim();
            if (!oldName || !newName) return alert('áƒ›áƒ˜áƒ£áƒ—áƒ˜áƒ—áƒ”áƒ— áƒ«áƒ•áƒ”áƒšáƒ˜ áƒ“áƒ áƒáƒ®áƒáƒšáƒ˜ áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜!');
            try {
                // Check if new name exists
                const check = await sql`SELECT id FROM users WHERE nickname = ${newName}`;
                if (check.length > 0) return alert('áƒ”áƒ¡ áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜ áƒ£áƒ™áƒ•áƒ” áƒ“áƒáƒ™áƒáƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ!');

                await sql`UPDATE users SET nickname = ${newName} WHERE nickname = ${oldName}`;
                log(`áƒ¡áƒáƒ®áƒ”áƒšáƒ˜ áƒ¨áƒ”áƒ˜áƒªáƒ•áƒáƒšáƒ: ${oldName} -> ${newName}`, 'var(--primary)');
                get('target-nick').value = newName;
                get('new-nick-val').value = '';
            } catch (e) { log('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ‘áƒáƒ–áƒáƒ¡áƒ—áƒáƒœ', 'red'); }
        };



        get('ban-user').onclick = async () => {
            const name = get('target-nick').value.trim();
            if (!name) return;
            if (confirm(`Are you sure you want to BAN (Chat & Game) for ${name}?`)) {
                try {
                    await sql`UPDATE users SET score = 0, survival_time = 0, coins = 0, best_score = 0, banned_until = '2099-01-01' WHERE nickname = ${name}`;
                    log(`ğŸš« Banned & Reset: ${name}`, 'red');
                    loadPlayers();
                } catch (e) { log('Error banning user', 'red'); }
            }
        };

        window.moderateUser = async (email, type) => {
            let until = null;
            let msg = "";

            if (type === 'ban') {
                if (!confirm(`áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— ${email}-áƒ˜áƒ¡ áƒ¡áƒáƒ›áƒ£áƒ“áƒáƒ›áƒáƒ“ áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ•áƒ?`)) return;
                until = new Date('2099-01-01');
                msg = "ğŸš« áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒáƒ˜áƒ‘áƒšáƒáƒ™áƒ áƒ¡áƒáƒ›áƒ£áƒ“áƒáƒ›áƒáƒ“";
            } else {
                if (!confirm(`áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— ${email}-áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ ${type} áƒ“áƒ¦áƒ˜áƒáƒœáƒ˜ áƒ¢áƒáƒ˜áƒ›áƒáƒ£áƒ¢áƒ˜áƒ¡ áƒ“áƒáƒ“áƒ”áƒ‘áƒ?`)) return;
                until = new Date();
                until.setDate(until.getDate() + type);
                msg = `â³ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ¡ áƒ“áƒáƒ”áƒ“áƒ ${type} áƒ“áƒ¦áƒ˜áƒáƒœáƒ˜ áƒ¢áƒáƒ˜áƒ›áƒáƒ£áƒ¢áƒ˜`;
            }

            try {
                await sql`UPDATE users SET banned_until = ${until} WHERE email = ${email}`;
                log(msg, 'var(--danger)');
                await loadAdminComments();
                await loadPlayers();

                // Refresh modal if currently viewing this user
                const modal = get('edit-user-modal');
                const editingEmail = get('edit-user-email') ? get('edit-user-email').value : null;
                if (modal && !modal.classList.contains('hidden') && editingEmail === email) {
                    editUser(email);
                }
            } catch (e) {
                console.error(e);
                log('Error moderating user', 'red');
            }
        };

        get('reset-lb').onclick = async () => {
            if (confirm("RESET ENTIRE LEADERBOARD?")) {
                try {
                    await sql`UPDATE users SET score = 0, survival_time = 0`;
                    log("Leaderboard Reset!", 'red');
                } catch (e) { log('Error', 'red'); }
            }
        };

        get('send-broadcast').onclick = async () => {
            const msg = get('broadcast-msg').value.trim();
            if (!msg) return;
            try {
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', ${msg})`;
                log(`Broadcasted: ${msg}`);
                get('broadcast-msg').value = '';
            } catch (e) { log('Error', 'red'); }
        };

        get('send-massive').onclick = async () => {
            const msg = get('massive-msg').value.trim();
            const dur = parseInt(get('massive-dur').value) || 10;
            if (!msg) return alert("áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜");
            try {
                // Encode duration in value: "message:::duration"
                const eventValue = `${msg}:::${dur}`;

                await sql`INSERT INTO global_events (event_type, event_value, expires_at) 
                         VALUES ('massive_announcement', ${eventValue}, NOW() + CAST(${dur} || ' seconds' AS INTERVAL))
                         ON CONFLICT (event_type) DO UPDATE SET event_value = EXCLUDED.event_value, expires_at = EXCLUDED.expires_at`;

                log(`MASSIVE SENT: ${msg} (${dur}s)`);
                get('massive-msg').value = '';
            } catch (e) {
                console.error(e);
                log('Error sending massive alert', 'red');
            }
        };


        const triggerEvent = async (type, val, duration) => {
            try {
                const expireDate = new Date(Date.now() + duration * 60000);
                await sql`DELETE FROM global_events WHERE event_type = ${type}`;
                await sql`INSERT INTO global_events (event_type, event_value, expires_at) 
                          VALUES (${type}, ${val.toString()}, ${expireDate.toISOString()})`;

                let msg = `Global Event Active!`;
                if (type === 'multiplier') msg = `ğŸŒ áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ ${val}X áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒ£áƒ¡áƒ¢áƒ˜!`;
                else if (type === 'crisis_time') msg = `âš ï¸ áƒ™áƒ áƒ˜áƒ–áƒ˜áƒ¡áƒ˜áƒ¡ áƒ“áƒ áƒ: ${val} áƒ¬áƒáƒ›áƒ˜`;
                else if (type === 'spawn_interval') msg = `âš¡ áƒ’áƒáƒ©áƒ”áƒœáƒ˜áƒ¡ áƒ¡áƒ˜áƒ©áƒ¥áƒáƒ áƒ”: ${val}ms`;
                else if (type === 'boss_limit') msg = `â˜ ï¸ áƒ‘áƒáƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒ˜áƒ›áƒ˜áƒ¢áƒ˜: ${val}`;
                else if (type === 'stain_limit') msg = `ğŸ§¹ áƒšáƒáƒ¥áƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒ˜áƒ›áƒ˜áƒ¢áƒ˜: ${val}`;
                else if (type === 'rainbow') msg = `ğŸŒˆ RAINBOW áƒ áƒ”áƒŸáƒ˜áƒ›áƒ˜ áƒ©áƒáƒ˜áƒ áƒ—áƒ!`;
                else if (type === 'player_strength') msg = `ğŸ’ª áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ«áƒáƒšáƒ: ${val}X`;
                else if (type === 'player_radius') msg = `ğŸ“ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ áƒáƒ“áƒ˜áƒ£áƒ¡áƒ˜: ${val}X`;
                else if (type === 'coin_mult') msg = `ğŸ’° áƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ›áƒ áƒáƒ•áƒšáƒ˜: ${val}X`;
                else if (type === 'boss_hp') msg = `â˜ ï¸ áƒ‘áƒáƒ¡áƒ˜áƒ¡ HP: ${val}`;
                else if (type === 'freeze_enemies') msg = `â„ï¸ áƒ›áƒ¢áƒ áƒ”áƒ‘áƒ˜ áƒ’áƒáƒ˜áƒ§áƒ˜áƒœáƒœáƒ”áƒœ!`;
                else if (type === 'god_mode') msg = `ğŸ›¡ï¸ áƒ£áƒ™áƒ•áƒ“áƒáƒ•áƒ”áƒ‘áƒ˜áƒ¡ áƒ áƒ”áƒŸáƒ˜áƒ›áƒ˜!`;
                else if (type === 'soap_thresh') msg = `ğŸ§¼ áƒ¡áƒáƒáƒœáƒ˜áƒ¡ áƒ¡áƒ˜áƒ®áƒ¨áƒ˜áƒ áƒ”: áƒ§áƒáƒ•áƒ”áƒš ${val} áƒ¥áƒ£áƒšáƒáƒ–áƒ”`;
                else if (type === 'minigame_thresh') msg = `ğŸ® áƒ›áƒ˜áƒœáƒ˜-áƒ—áƒáƒ›áƒáƒ¨áƒ˜: áƒ§áƒáƒ•áƒ”áƒš ${val} áƒ¥áƒ£áƒšáƒáƒ–áƒ”`;
                else if (type === 'soap_cutscene') msg = `ğŸ§¼ áƒ¡áƒáƒáƒœáƒ˜áƒ¡ áƒ“áƒ áƒ: ${val}ms`;
                else if (type === 'video_config') msg = `ğŸ“º YouTube Notifier áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ!`;
                else if (type === 'boss_spawn_rate') msg = `â±ï¸ áƒ‘áƒáƒ¡áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ©áƒ”áƒœáƒ˜áƒ¡ áƒ“áƒ áƒ: áƒ§áƒáƒ•áƒ”áƒš ${val} áƒ¬áƒáƒ›áƒ¨áƒ˜`;
                else if (type === 'upgrade_power') msg = `âš¡ áƒ’áƒáƒ«áƒšáƒ˜áƒ”áƒ áƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒ«áƒáƒšáƒ: ${val}X`;
                else if (type === 'pink_power') msg = `ğŸŒ¸ Pink áƒ’áƒáƒ«áƒšáƒ˜áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ«áƒáƒšáƒ: ${val}X`;
                else if (type === 'regular_boss_config') msg = `â­• áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ!`;
                else if (type === 'triangle_boss_config') msg = `ğŸ”º áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜ áƒ‘áƒáƒ¡áƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ!`;
                else if (type === 'reg_boss_img') msg = `ğŸ–¼ï¸ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¤áƒáƒ¢áƒ áƒ¨áƒ”áƒ˜áƒªáƒ•áƒáƒšáƒ`;
                else if (type === 'reg_boss_scale') msg = `ğŸ“ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ›áƒáƒ¡áƒ¨áƒ¢áƒáƒ‘áƒ˜: ${val}`;
                else if (type === 'reg_boss_opacity') msg = `ğŸ‘ï¸ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¡áƒ˜áƒ›áƒ™áƒ áƒ—áƒáƒšáƒ”: ${val}`;
                else if (type === 'reg_boss_hp') msg = `â¤ï¸ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ HP: ${val}`;
                else if (type === 'reg_boss_spawn') msg = `â±ï¸ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¡áƒáƒáƒ£áƒœáƒ˜: ${val}áƒ¬áƒ›`;
                else if (type === 'reg_boss_threshold') msg = `ğŸ“ˆ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ: ${val}`;
                else if (type === 'tri_boss_img') msg = `ğŸ–¼ï¸ Elite áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¤áƒáƒ¢áƒ áƒ¨áƒ”áƒ˜áƒªáƒ•áƒáƒšáƒ`;
                else if (type === 'tri_boss_scale') msg = `ğŸ“ Elite áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ›áƒáƒ¡áƒ¨áƒ¢áƒáƒ‘áƒ˜: ${val}`;
                else if (type === 'tri_boss_opacity') msg = `ğŸ‘ï¸ Elite áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¡áƒ˜áƒ›áƒ™áƒ áƒ—áƒáƒšáƒ”: ${val}`;
                else if (type === 'tri_boss_hp') msg = `â¤ï¸ Elite áƒ‘áƒáƒ¡áƒ˜áƒ¡ HP: ${val}`;
                else if (type === 'tri_boss_spawn') msg = `â±ï¸ Elite áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¡áƒáƒáƒ£áƒœáƒ˜: ${val}áƒ¬áƒ›`;
                else if (type === 'tri_boss_threshold') msg = `ğŸ“ˆ Elite áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ: ${val}`;
                else if (type === 'spawn_now') msg = `ğŸš€ áƒ›áƒ§áƒ˜áƒ¡áƒ˜áƒ”áƒ áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ’áƒáƒ©áƒ”áƒœáƒ: ${val.toUpperCase()}!`;

                msg += ` (${duration} áƒ¬áƒ—) âœ¨`;

                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', ${msg})`;
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('SYSTEM_LOG', ${'INFO|Event: ' + type + ' = ' + val})`;
                log(`áƒ’áƒáƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ“áƒ: ${type} (${val}) - ${duration} áƒ¬áƒ—`);
                updateBonusTimer();
            } catch (e) { console.error(e); log('Error triggering event', 'red'); }
        };

        const updateDashboardStatus = async () => {
            try {
                const events = await sql`SELECT * FROM global_events WHERE expires_at > NOW()`;
                document.querySelectorAll('.cur-val').forEach(el => el.textContent = '');

                events.forEach(ev => {
                    if (ev.event_type === 'player_strength') get('cur-strength').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'player_radius') get('cur-radius').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'coin_mult') get('cur-coin').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'multiplier') get('cur-score').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'boss_hp') get('cur-bosshp').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'boss_limit') get('cur-bosslimit').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'stain_limit') get('cur-stainlimit').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'spawn_interval') get('cur-spawn').textContent = `(${ev.event_value}ms)`;
                    if (ev.event_type === 'crisis_time') get('cur-crisis').textContent = `(${ev.event_value}s)`;
                    if (ev.event_type === 'soap_thresh') get('cur-soap').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'minigame_thresh') get('cur-minigame').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'soap_cutscene') get('cur-cutscene').textContent = `(${ev.event_value}ms)`;
                    if (ev.event_type === 'god_mode') get('cur-god').textContent = `(ON)`;
                    if (ev.event_type === 'freeze_enemies') get('cur-freeze').textContent = `(ON)`;
                    if (ev.event_type === 'video_config') {
                        try {
                            const cfg = JSON.parse(ev.event_value);
                            cfg.forEach((item, idx) => {
                                if (idx < 5) {
                                    const id = get(`ch-id-${idx + 1}`);
                                    const wt = get(`ch-wt-${idx + 1}`);
                                    if (id && !id.value) id.value = item.id;
                                    if (wt && wt.value == "0") wt.value = item.weight;
                                }
                            });
                        } catch (e) { }
                    }
                    if (ev.event_type === 'video_channel') get('cur-channel').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'video_timings') get('cur-timings').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'video_loop') get('cur-loop').textContent = `(${ev.event_value}s)`;
                    if (ev.event_type === 'boss_config') get('cur-boss-config').textContent = `(ACTIVE)`;
                    if (ev.event_type === 'forced_video') get('cur-forced-video').textContent = `(ACTIVE)`;
                    if (ev.event_type === 'boss_spawn_rate') get('cur-bossrate').textContent = `(${ev.event_value}s)`;
                    if (ev.event_type === 'upgrade_power') get('cur-upgpow').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'pink_power') get('cur-pinkpow').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'freeze_enemies') get('cur-freeze').textContent = `(ON)`;
                    if (ev.event_type === 'god_mode') get('cur-god').textContent = `(ON)`;

                    // Individual Boss Stats
                    if (ev.event_type === 'reg_boss_hp') get('cur-reg-hp')?.textContent ? get('cur-reg-hp').textContent = `(${ev.event_value})` : null;
                    if (ev.event_type === 'reg_boss_spawn') get('cur-reg-spawn')?.textContent ? get('cur-reg-spawn').textContent = `(${ev.event_value}s)` : null;
                    if (ev.event_type === 'reg_boss_threshold') get('cur-reg-thresh')?.textContent ? get('cur-reg-thresh').textContent = `(${ev.event_value})` : null;

                    if (ev.event_type === 'tri_boss_hp') get('cur-tri-hp')?.textContent ? get('cur-tri-hp').textContent = `(${ev.event_value})` : null;
                    if (ev.event_type === 'tri_boss_spawn') get('cur-tri-spawn')?.textContent ? get('cur-tri-spawn').textContent = `(${ev.event_value}s)` : null;
                    if (ev.event_type === 'tri_boss_threshold') get('cur-tri-thresh')?.textContent ? get('cur-tri-thresh').textContent = `(${ev.event_value})` : null;
                });
            } catch (e) { }
        };
        setInterval(updateDashboardStatus, 5000);
        updateDashboardStatus();

        window.quickTrigger = (type, inputId, customDur = null) => {
            const val = inputId === '1' ? '1' : (get(inputId)?.value || inputId);
            const dur = customDur || parseInt(get('global-duration').value) || 10;
            triggerEvent(type, val, dur);
        };

        window.stopEvent = async (type) => {
            if (!confirm(`áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— ${type}-áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ?`)) return;
            try {
                await sql`DELETE FROM global_events WHERE event_type = ${type}`;

                // Reset inputs to defaults
                const defaults = {
                    'reg_boss_hp': { id: 'reg-boss-hp', val: '10000' },
                    'reg_boss_spawn': { id: 'reg-boss-spawn', val: '60' },
                    'reg_boss_threshold': { id: 'reg-boss-threshold', val: '500' },
                    'reg_boss_scale': { id: 'reg-boss-scale', val: '1.0' },
                    'reg_boss_opacity': { id: 'reg-boss-opacity', val: '10' },
                    'reg_boss_img': { id: 'reg-boss-img', val: '' },

                    'tri_boss_hp': { id: 'tri-boss-hp', val: '30000' },
                    'tri_boss_spawn': { id: 'tri-boss-spawn', val: '120' },
                    'tri_boss_threshold': { id: 'tri-boss-threshold', val: '1000' },
                    'tri_boss_scale': { id: 'tri-boss-scale', val: '1.0' },
                    'tri_boss_opacity': { id: 'tri-boss-opacity', val: '10' },
                    'tri_boss_img': { id: 'tri-boss-img', val: '' },

                    'boss_hp': { id: 'val-bosshp', val: '10000' },
                    'spawn_interval': { id: 'val-spawn', val: '500' },
                    'boss_limit': { id: 'val-bosslimit', val: '20' },
                    'stain_limit': { id: 'val-stainlimit', val: '50' },

                    'upgrade_power': { id: 'val-upgpow', val: '1.3' },
                    'pink_power': { id: 'val-pinkpow', val: '1.5' },
                    'multiplier': { id: 'val-multiplier', val: '2' },
                    'crisis_time': { id: 'val-crisis', val: '30' }
                };

                if (defaults[type]) {
                    const el = get(defaults[type].id);
                    if (el) el.value = defaults[type].val;
                }

                log(`ğŸ›‘ ${type} áƒ’áƒáƒ£áƒ¥áƒ›áƒ“áƒ áƒ“áƒ áƒáƒ¦áƒ“áƒ’áƒ áƒ¡áƒáƒ¬áƒ§áƒ˜áƒ¡áƒ˜ áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ`, 'orange');
                updateBonusTimer();
                updateDashboardStatus();
            } catch (e) { log('Error', 'red'); }
        };

        window.saveVideoConfig = async () => {
            let config = [];
            for (let i = 1; i <= 5; i++) {
                let id = get(`ch-id-${i}`).value.trim();
                let wt = parseInt(get(`ch-wt-${i}`).value) || 0;
                if (id) config.push({ id, weight: wt });
            }
            if (config.length === 0) { alert('áƒ›áƒ˜áƒ£áƒ—áƒ˜áƒ—áƒ”áƒ— áƒ›áƒ˜áƒœáƒ˜áƒ›áƒ£áƒ› 1 áƒáƒ áƒ®áƒ˜'); return; }
            const val = JSON.stringify(config);
            const dur = parseInt(get('global-duration').value) || 120;
            triggerEvent('video_config', val, dur);
        };

        window.saveBossConfig = async () => {
            const img = get('boss-img-url').value.trim();
            const scale = get('boss-scale').value || "1.0";
            const dur = parseInt(get('global-duration').value) || 60;
            const config = { img, scale, opacity: get('boss-opacity').value || "10", triangleHP: get('triangle-boss-hp').value || "30000" };
            triggerEvent('boss_config', JSON.stringify(config), dur);
        };

        // Regular Boss Functions
        window.saveRegularBoss = async () => {
            const img = get('regular-boss-img').value.trim();
            const scale = get('regular-boss-scale').value || "1.0";
            const opacity = get('regular-boss-opacity').value || "10";
            const hp = get('regular-boss-hp').value || "10000";
            const spawn = get('regular-boss-spawn').value || "60";
            const threshold = get('regular-boss-threshold').value || "500";
            const dur = parseInt(get('global-duration').value) || 60;
            const config = { img, scale, opacity, hp, spawn, threshold };
            await triggerEvent('regular_boss_config', JSON.stringify(config), dur);
            get('regular-boss-status').textContent = `Active (HP: ${hp}, Spawn: ${spawn}s, Threshold: ${threshold})`;
            log('âœ… áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ', 'green');
        };

        window.resetRegularBoss = async () => {
            if (!confirm('áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ§áƒ•áƒ”áƒšáƒ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ?')) return;
            try {
                const types = ['reg_boss_img', 'reg_boss_scale', 'reg_boss_opacity', 'reg_boss_hp', 'reg_boss_spawn', 'reg_boss_threshold'];
                for (const t of types) {
                    await sql`DELETE FROM global_events WHERE event_type = ${t}`;
                }

                get('reg-boss-img').value = '';
                get('reg-boss-scale').value = '1.0';
                get('reg-boss-opacity').value = '10';
                get('reg-boss-hp').value = '10000';
                get('reg-boss-spawn').value = '60';
                get('reg-boss-threshold').value = '500';

                log('ğŸ”„ áƒ©áƒ•áƒ”áƒ£áƒšáƒ”áƒ‘áƒ áƒ˜áƒ•áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜ áƒ’áƒáƒœáƒ£áƒšáƒ“áƒ', 'orange');
                updateDashboardStatus();
            } catch (e) { log('Error resetting boss', 'red'); }
        };

        // Triangle Boss Functions
        window.saveTriangleBoss = async () => {
            const img = get('triangle-boss-img').value.trim();
            const scale = get('triangle-boss-scale').value || "1.0";
            const opacity = get('triangle-boss-opacity').value || "10";
            const hp = get('triangle-boss-hp-input').value || "30000";
            const spawn = get('triangle-boss-spawn').value || "120";
            const threshold = get('triangle-boss-threshold').value || "1000";
            const dur = parseInt(get('global-duration').value) || 60;
            const config = { img, scale, opacity, hp, spawn, threshold };
            await triggerEvent('triangle_boss_config', JSON.stringify(config), dur);
            get('triangle-boss-status').textContent = `Active (HP: ${hp}, Spawn: ${spawn}s, Threshold: ${threshold})`;
            log('âœ… áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜ áƒ‘áƒáƒ¡áƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ', 'cyan');
        };

        window.resetTriangleBoss = async () => {
            if (!confirm('áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒ§áƒ•áƒ”áƒšáƒ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ?')) return;
            try {
                const types = ['tri_boss_img', 'tri_boss_scale', 'tri_boss_opacity', 'tri_boss_hp', 'tri_boss_spawn', 'tri_boss_threshold'];
                for (const t of types) {
                    await sql`DELETE FROM global_events WHERE event_type = ${t}`;
                }

                get('tri-boss-img').value = '';
                get('tri-boss-scale').value = '1.0';
                get('tri-boss-opacity').value = '10';
                get('tri-boss-hp').value = '30000';
                get('tri-boss-spawn').value = '120';
                get('tri-boss-threshold').value = '1000';

                log('ğŸ”„ áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜ áƒ‘áƒáƒ¡áƒ˜áƒ¡ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜ áƒ’áƒáƒœáƒ£áƒšáƒ“áƒ', 'orange');
                updateDashboardStatus();
            } catch (e) { log('Error resetting boss', 'red'); }
        };

        window.resetGlobalEnemies = async () => {
            if (!confirm('áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ?')) return;
            try {
                const types = ['boss_hp', 'spawn_interval', 'boss_limit', 'stain_limit'];
                for (const t of types) {
                    await sql`DELETE FROM global_events WHERE event_type = ${t}`;
                }

                get('val-bosshp').value = '10000';
                get('val-spawn').value = '500';
                get('val-bosslimit').value = '20';
                get('val-stainlimit').value = '200';

                log('ğŸ”„ áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜ áƒ’áƒáƒœáƒ£áƒšáƒ“áƒ', 'orange');
                updateDashboardStatus();
            } catch (e) { log('Error resetting global settings', 'red'); }
        };

        window.spawnBossNow = async (type) => {
            // Type is 'regular' or 'triangle'
            // Trigger a very short event that clients will pick up
            await triggerEvent('spawn_now', type, 1); // Only active for 1 minute
            log(`ğŸš€ áƒ›áƒ§áƒ˜áƒ¡áƒ˜áƒ”áƒ áƒ˜ áƒ¡áƒáƒáƒ£áƒœáƒ˜: ${type.toUpperCase()}`, 'yellow');
        };

        window.saveForcedVideo = async () => {
            const url = get('val-forced-video').value.trim();
            if (!url) return alert("áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒšáƒ˜áƒœáƒ™áƒ˜");

            let videoId = '';
            try {
                if (url.includes('v=')) videoId = url.split('v=')[1].split('&')[0];
                else if (url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1].split('?')[0];
                else videoId = url; // assume raw ID
            } catch (e) { return alert("áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒšáƒ˜áƒœáƒ™áƒ˜"); }

            if (!videoId) return alert("ID áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ");

            const dur = parseInt(get('global-duration').value) || 60;
            const config = { id: videoId, link: url };
            triggerEvent('forced_video', JSON.stringify(config), dur);
        };

        get('stop-events').onclick = async () => {
            if (!confirm('áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ?')) return;
            try {
                await sql`DELETE FROM global_events`;
                log('ğŸ›‘ áƒ§áƒ•áƒ”áƒšáƒ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ˜ áƒ’áƒáƒ£áƒ¥áƒ›áƒ“áƒ', 'orange');
                updateBonusTimer();
            } catch (e) { log('Error', 'red'); }
        };

        get('restart-site').onclick = async () => {
            if (confirm("âš ï¸ áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ›áƒ—áƒ”áƒšáƒ˜ áƒ¡áƒáƒ˜áƒ¢áƒ˜áƒ¡ áƒ áƒ”áƒ¡áƒ¢áƒáƒ áƒ¢áƒ˜? áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ” áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ£áƒš áƒ˜áƒ¥áƒœáƒ”áƒ‘áƒ!")) {
                try {
                    await sql`DELETE FROM global_events`;
                    await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', 'ğŸ”„ áƒ¡áƒáƒ˜áƒ¢áƒ˜ áƒ áƒ”áƒ¡áƒ¢áƒáƒ áƒ¢áƒ“áƒ”áƒ‘áƒ 5 áƒ¬áƒáƒ›áƒ¨áƒ˜...')`;
                    log("Restarting site in 5 seconds...", 'red');
                    localStorage.setItem('tilo_force_reload', Date.now().toString());
                    setTimeout(() => { window.location.reload(); }, 5000);
                } catch (e) { console.error(e); log('Error restarting site', 'red'); }
            }
        };

        async function updateBonusTimer() {
            try {
                const events = await sql`SELECT event_type, event_value, expires_at FROM global_events WHERE expires_at > NOW() LIMIT 1`;
                const timerDiv = get('active-bonus-timer');
                const noMsg = get('no-bonus-msg');
                const bonusName = get('bonus-name');
                const timeLeft = get('bonus-time-left');

                if (events.length > 0) {
                    const event = events[0];
                    const remainingMs = new Date(event.expires_at) - new Date();
                    if (remainingMs > 0) {
                        const min = Math.floor(remainingMs / 60000);
                        const sec = Math.floor((remainingMs % 60000) / 1000);
                        bonusName.textContent = event.event_type === 'multiplier' ? `${event.event_value}X Score Bonus` : 'Rainbow Event';
                        timeLeft.textContent = `${min}:${sec.toString().padStart(2, '0')}`;
                        timerDiv.style.display = 'block';
                        noMsg.style.display = 'none';
                    } else {
                        timerDiv.style.display = 'none';
                        noMsg.style.display = 'block';
                    }
                } else {
                    timerDiv.style.display = 'none';
                    noMsg.style.display = 'block';
                }
            } catch (e) { console.error('Timer error:', e); }
        }

        setInterval(updateBonusTimer, 1000);

        // PLAYERS DB
        let allPlayers = [];
        let filteredPlayers = [];

        async function loadPlayers() {
            try {
                const sortBy = get('sort-players').value;
                let players;

                // Try fetching with banned_until
                try {
                    if (sortBy === 'newest') {
                        players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, last_active, banned_until FROM users ORDER BY id DESC LIMIT 1000`;
                    } else if (sortBy === 'score') {
                        players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, last_active, banned_until FROM users ORDER BY score DESC LIMIT 1000`;
                    } else if (sortBy === 'coins') {
                        players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, last_active, banned_until FROM users ORDER BY coins DESC LIMIT 1000`;
                    } else if (sortBy === 'time') {
                        players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, last_active, banned_until FROM users ORDER BY survival_time DESC LIMIT 1000`;
                    } else {
                        players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, last_active, banned_until FROM users ORDER BY nickname ASC LIMIT 1000`;
                    }
                } catch (e) {
                    if (e.message.includes('column "banned_until" does not exist')) {
                        console.warn("Schema mismatch, fallback to old query");
                        alert("âš ï¸ áƒ‘áƒáƒ–áƒáƒ¨áƒ˜ áƒáƒ™áƒšáƒ˜áƒ áƒ¡áƒ•áƒ”áƒ¢áƒ˜ 'banned_until'. áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ’áƒáƒ£áƒ¨áƒ•áƒáƒ— 'DATABASE SETUP' áƒ¡áƒ™áƒ áƒ˜áƒáƒ¢áƒ˜ 'Critical Actions' áƒ¢áƒáƒ‘áƒ¨áƒ˜!");

                        // Fallback query without banned_until
                        if (sortBy === 'newest') {
                            players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, last_active FROM users ORDER BY id DESC LIMIT 1000`;
                        } else {
                            players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, last_active FROM users ORDER BY nickname ASC LIMIT 1000`;
                        }
                    } else {
                        throw e;
                    }
                }

                allPlayers = players;
                filteredPlayers = players;
                displayPlayers(filteredPlayers);
                get('total-players').textContent = players.length;
            } catch (e) {
                console.error(e);
                log('áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ', 'red');
                alert("áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: " + e.message);
            }
        }

        function displayPlayers(players) {
            const container = get('players-list');
            if (players.length === 0) {
                container.innerHTML = '<p style="text-align: center; width: 100%; opacity: 0.5; padding: 50px;">áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</p>';
                return;
            }

            container.innerHTML = players.map(player => {
                const isGuest = player.email.startsWith('guest_');
                const timeFormatted = formatTime(player.survival_time);
                const lastActive = player.last_active ? new Date(player.last_active).toLocaleString('ka-GE') : 'áƒáƒ áƒáƒ¡áƒ“áƒ áƒáƒ¡';

                return `
                    <div class="player-card">
                        <div class="player-details">
                            <div class="player-name">
                                ${player.nickname}
                                ${isGuest ? '<span style="font-size: 0.65rem; background: #333; padding: 2px 6px; border-radius: 4px;">GUEST</span>' : ''}
                            </div>
                            <div style="font-size: 0.8rem; opacity: 0.5;">${player.email}</div>
                        </div>
                        <div class="stats">
                            <span class="stat-badge">â­ áƒ¥áƒ£áƒšáƒ: <strong>${Math.floor(player.score)}</strong></span>
                            <span class="stat-badge">ğŸª™ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜: <strong>${player.coins}</strong></span>
                            <span class="stat-badge">ğŸ’° áƒ¡áƒ£áƒš: <strong>${player.total_coins || 0}</strong></span>
                            <span class="stat-badge">â±ï¸ áƒ“áƒ áƒ: <strong>${timeFormatted}</strong></span>
                        </div>
                        <div style="margin-top: 15px; font-size: 0.7rem; opacity: 0.4;">áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜: ${lastActive}</div>
                        <div class="flex-row gap-5" style="margin-top: 15px;">
                            <button class="btn btn-outline" style="font-size: 0.75rem; padding: 5px 10px;" 
                                onclick="editUser('${player.email}')">âœï¸ EDIT</button>
                            <button class="btn btn-danger" style="font-size: 0.75rem; padding: 5px 10px;" 
                                onclick="deleteUser('${player.email}')">ğŸ—‘ï¸ DELETE</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.deleteUser = async (email) => {
            if (!confirm(`áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ: ${email}?`)) return;
            try {
                await sql`DELETE FROM users WHERE email = ${email}`;
                log(`áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ: ${email}`, 'red');
                loadPlayers();
            } catch (e) { log('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡áƒáƒ¡', 'red'); }
        };

        window.editUser = (email) => {
            const player = allPlayers.find(p => p.email === email);
            if (!player) return;

            const modal = get('edit-user-modal');
            get('edit-user-email').value = player.email;
            get('edit-user-nick').value = player.nickname;
            get('edit-user-score').value = Math.floor(player.score);
            get('edit-user-coins').value = player.coins;
            get('edit-user-total-coins').value = player.total_coins || 0;

            // Ban Logic
            const banSection = get('ban-management-section');
            const banInfo = get('ban-info');
            const banCreate = get('ban-create-section');

            if (player.banned_until && new Date(player.banned_until) > new Date()) {
                banSection.style.display = 'block';
                if (banCreate) banCreate.style.display = 'none';
                const date = new Date(player.banned_until).toLocaleString('ka-GE');
                banInfo.textContent = `áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ˜áƒšáƒ˜áƒ ${date}-áƒ›áƒ“áƒ”.`;
            } else {
                banSection.style.display = 'none';
                if (banCreate) banCreate.style.display = 'block';
            }

            modal.classList.remove('hidden');
        };

        window.removeBan = async () => {
            const email = get('edit-user-email').value;
            if (!confirm(`áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— ${email}-áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ‘áƒáƒœáƒ˜áƒ¡/áƒ¢áƒáƒ˜áƒ›áƒáƒ£áƒ¢áƒ˜áƒ¡ áƒ›áƒáƒ®áƒ¡áƒœáƒ?`)) return;

            try {
                await sql`UPDATE users SET banned_until = NULL WHERE email = ${email}`;
                log(`âœ… áƒ‘áƒáƒœáƒ˜ áƒ›áƒáƒ˜áƒ®áƒ¡áƒœáƒ: ${email}`, 'green');
                get('edit-user-modal').classList.add('hidden');
                loadPlayers();
            } catch (e) { log('Error removing ban', 'red'); }
        };

        async function loadOnlinePlayers() {
            try {
                // Anyone active in the last 2 minutes is considered online
                const online = await sql`SELECT nickname, email, score, coins, survival_time, last_active FROM users 
                                        WHERE last_active > NOW() - INTERVAL '2 minute' 
                                        ORDER BY last_active DESC`;

                get('online-count').textContent = online.length;
                const container = get('online-list');

                if (online.length === 0) {
                    container.innerHTML = '<p style="text-align: center; width: 100%; opacity: 0.5; padding: 50px;">áƒáƒœáƒšáƒáƒ˜áƒœáƒ¨áƒ˜ áƒáƒ áƒáƒ•áƒ˜áƒœ áƒáƒ áƒ˜áƒ¡</p>';
                    return;
                }

                container.innerHTML = online.map(player => `
                    <div class="player-card">
                        <div class="player-details">
                            <div class="player-name">ğŸŸ¢ ${player.nickname}</div>
                            <div style="font-size: 0.8rem; opacity: 0.5;">${player.email}</div>
                        </div>
                        <div class="stats">
                            <span class="stat-badge">â­ áƒ¥áƒ£áƒšáƒ: <strong>${Math.floor(player.score)}</strong></span>
                            <span class="stat-badge">ğŸª™ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜: <strong>${player.coins}</strong></span>
                            <span class="stat-badge">â±ï¸ áƒ“áƒ áƒ: <strong>${formatTime(player.survival_time)}</strong></span>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.7rem; color: #00ff00;">áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜áƒ áƒáƒ®áƒšáƒ</div>
                    </div>
                `).join('');
            } catch (e) {
                console.error(e);
                log('áƒáƒœáƒšáƒáƒ˜áƒœ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ', 'red');
            }
        }

        get('refresh-online').onclick = loadOnlinePlayers;
        setInterval(() => {
            if (get('tab-online').classList.contains('active')) loadOnlinePlayers();
        }, 10000);

        window.saveUserEdit = async () => {
            const email = get('edit-user-email').value;
            const nick = get('edit-user-nick').value.trim();
            const score = parseInt(get('edit-user-score').value) || 0;
            const coins = parseInt(get('edit-user-coins').value) || 0;
            const totalCoins = parseInt(get('edit-user-total-coins').value) || 0;
            try {
                await sql`UPDATE users SET 
                    nickname = ${nick}, 
                    score = ${score}, 
                    coins = ${coins}, 
                    total_coins = ${totalCoins}
                    WHERE email = ${email}`;

                log(`áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ: ${nick}`, 'green');
                get('edit-user-modal').classList.add('hidden');
                loadPlayers();
            } catch (e) { log('áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ', 'red'); }
        };

        function formatTime(s) {
            const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sc = s % 60;
            return h > 0 ? `${h}áƒ¡ ${m}áƒ¬` : m > 0 ? `${m}áƒ¬ ${sc}áƒ¬` : `${sc}áƒ¬`;
        }

        get('search-player').oninput = () => {
            const q = get('search-player').value.toLowerCase().trim();
            filteredPlayers = q ? allPlayers.filter(p => p.nickname.toLowerCase().includes(q) || p.email.toLowerCase().includes(q)) : allPlayers;
            displayPlayers(filteredPlayers);
        };

        get('refresh-players').onclick = loadPlayers;
        get('sort-players').onchange = loadPlayers;


        // RESET SCORES ONLY Logic
        get('reset-scores-only-btn').onclick = async () => {
            const confirmed = confirm("âš ï¸ áƒ’áƒáƒ¤áƒ áƒ—áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ: áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ‘áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ (Score & Best Score) áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ?\n\náƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜, áƒ“áƒ áƒ áƒ“áƒ áƒ”áƒ¥áƒáƒ£áƒœáƒ—áƒ”áƒ‘áƒ˜ (áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜/áƒáƒáƒ áƒáƒšáƒ˜) áƒ¨áƒ”áƒœáƒáƒ áƒ©áƒ£áƒœáƒ“áƒ”áƒ‘áƒ!");
            if (!confirmed) return;

            log('Resetting competitive scores...', 'var(--yellow)');
            try {
                await sql`UPDATE users SET competition_score = 0`;
                await sql`DELETE FROM shared_scores`;
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', 'ğŸ”„ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒáƒ› áƒ›áƒáƒáƒ®áƒ“áƒ˜áƒœáƒ áƒ áƒ”áƒ˜áƒ¢áƒ˜áƒœáƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ! áƒ“áƒáƒ˜áƒ¬áƒ§áƒ áƒáƒ®áƒáƒšáƒ˜ áƒ¡áƒ”áƒ–áƒáƒœáƒ˜! ğŸ†')`;
                log('ğŸ‰ áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒœáƒ£áƒšáƒ“áƒ!', 'var(--accent)');
            } catch (e) {
                console.error(e);
                log('Error resetting scores', 'red');
            }
        };

        // NEWS Logic
        const discordTokenInput = get('discord-token');
        if (localStorage.getItem('admin_discord_token')) discordTokenInput.value = localStorage.getItem('admin_discord_token');

        const webhookInput = get('discord-webhook-url');
        if (localStorage.getItem('admin_discord_webhook')) webhookInput.value = localStorage.getItem('admin_discord_webhook');

        get('publish-news-btn').onclick = async () => {
            const id = get('edit-news-id').value;
            const title = get('news-title-input').value.trim();
            const category = get('news-category-input').value.trim() || 'áƒ¡áƒ˜áƒáƒ®áƒšáƒ”';
            const imageUrl = get('news-image-input').value.trim();
            const videoUrl = get('news-video-input').value.trim();
            const content = get('news-content-input').value.trim();
            const webhookUrl = webhookInput.value.trim();

            if (!title || !content) {
                alert("áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜ áƒ“áƒ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!");
                return;
            }

            if (webhookUrl) localStorage.setItem('admin_discord_webhook', webhookUrl);

            try {
                let newsId = id;
                if (id) {
                    log('áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ...', 'var(--primary)');
                    await sql`UPDATE news SET title=${title}, content=${content}, image_url=${imageUrl}, video_url=${videoUrl}, category=${category} WHERE id=${id}`;
                    log('âœ… áƒ¡áƒ˜áƒáƒ®áƒšáƒ” áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ!', 'var(--accent)');
                } else {
                    log('áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ...', 'var(--primary)');
                    const res = await sql`INSERT INTO news (title, content, image_url, video_url, category) VALUES (${title}, ${content}, ${imageUrl}, ${videoUrl}, ${category}) RETURNING id`;
                    newsId = res[0].id;
                    log('âœ… áƒ¡áƒ˜áƒáƒ®áƒšáƒ” áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ“áƒ!', 'var(--accent)');

                    // Send to Discord
                    if (webhookUrl) sendDiscordNotification(webhookUrl, title, content, imageUrl, newsId);
                }

                resetNewsForm();
                loadAdminNews();
            } catch (e) {
                console.error(e);
                log('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ‘áƒáƒ–áƒáƒ¡áƒ—áƒáƒœ', 'red');
            }
        };

        async function sendDiscordNotification(url, title, content, image, id) {
            try {
                const siteUrl = `https://tilo.life/index.html?id=${id}`;
                const plainText = content.replace(/<[^>]*>/g, '').substring(0, 300) + '...';

                const embed = {
                    title: `ğŸ”¥ ${title.toUpperCase()}`,
                    url: siteUrl,
                    description: `\n${plainText}\n\n**[ğŸ‘‰ áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ¬áƒáƒ™áƒ˜áƒ—áƒ®áƒ•áƒ]( ${siteUrl} )**\n`,
                    color: 0x0066cc,
                    image: image ? { url: image } : null,
                    footer: {
                        text: "TILO.LIFE News â€¢ áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜ áƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘",
                        icon_url: "https://tilo.life/favicon.ico"
                    },
                    timestamp: new Date().toISOString()
                };

                await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: "ğŸ“¢ **áƒáƒ®áƒáƒšáƒ˜ áƒáƒáƒ¡áƒ¢áƒ˜ áƒ“áƒáƒ˜áƒ“áƒ TILO.LIFE-áƒ–áƒ”!** @everyone",
                        embeds: [embed]
                    })
                });
                log('ğŸ“¢ Discord-áƒ–áƒ” áƒ’áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒ!', 'var(--accent)');
            } catch (e) {
                console.error("Discord Webhook Error:", e);
                log('âŒ Discord áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ', 'red');
            }
        }

        function resetNewsForm() {
            get('edit-news-id').value = '';
            get('news-title-input').value = '';
            get('news-category-input').value = '';
            get('news-image-input').value = '';
            get('news-video-input').value = '';
            get('news-content-input').value = '';
            get('news-form-title').textContent = 'ğŸ†• áƒáƒ®áƒáƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ';
            get('publish-news-btn').textContent = 'ğŸš€ áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ';
            get('cancel-news-edit-btn').classList.add('hidden');
        }

        get('cancel-news-edit-btn').onclick = resetNewsForm;

        window.loadAdminNews = async () => {
            try {
                const news = await sql`SELECT * FROM news ORDER BY created_at DESC LIMIT 50`;
                const container = get('admin-news-list');
                container.innerHTML = news.map(item => `
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border);">
                        <div style="flex: 1; overflow: hidden;">
                            <div style="font-weight: 600; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${item.title}</div>
                            <div style="font-size: 0.75rem; opacity: 0.5; margin-top: 4px;">ğŸ“… ${new Date(item.created_at).toLocaleDateString()} | ğŸ·ï¸ ${item.category}</div>
                        </div>
                        <div style="display: flex; gap: 8px; margin-left: 15px;">
                            <button class="btn btn-outline" style="padding: 6px 12px; font-size: 0.8rem; border-color: #5865F2; color: #5865F2;" onclick="shareNewsToDiscord(${item.id})" title="Discord-áƒ–áƒ” áƒ’áƒáƒ–áƒ˜áƒáƒ áƒ”áƒ‘áƒ">ğŸ“¢</button>
                            <button class="btn btn-outline" style="padding: 6px 12px; font-size: 0.8rem;" onclick="editAdminNews(${item.id})">âœï¸</button>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8rem;" onclick="deleteAdminNews(${item.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) { console.error(e); }
        };

        window.shareNewsToDiscord = async (id) => {
            const webhookUrl = localStorage.getItem('admin_discord_webhook');
            if (!webhookUrl) return alert("áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¯áƒ”áƒ  áƒ›áƒ˜áƒ£áƒ—áƒ˜áƒ—áƒáƒ— Discord Webhook URL 'áƒáƒ®áƒáƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡' áƒ¢áƒáƒ‘áƒ¨áƒ˜!");

            if (!confirm("áƒ’áƒ¡áƒ£áƒ áƒ— áƒáƒ› áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ Discord-áƒ–áƒ” áƒ’áƒáƒ–áƒ˜áƒáƒ áƒ”áƒ‘áƒ?")) return;

            try {
                const res = await sql`SELECT * FROM news WHERE id = ${id}`;
                if (res.length === 0) return;
                const item = res[0];
                await sendDiscordNotification(webhookUrl, item.title, item.content, item.image_url, item.id);
                alert("âœ… áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒ˜áƒ’áƒ–áƒáƒ•áƒœáƒ Discord-áƒ–áƒ”!");
            } catch (e) {
                console.error(e);
                alert("áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ˜áƒ¡áƒáƒ¡!");
            }
        };

        window.editAdminNews = async (id) => {
            try {
                const res = await sql`SELECT * FROM news WHERE id = ${id}`;
                if (res.length === 0) return;
                const item = res[0];

                get('edit-news-id').value = item.id;
                get('news-title-input').value = item.title;
                get('news-category-input').value = item.category;
                get('news-image-input').value = item.image_url || '';
                get('news-video-input').value = item.video_url || '';
                get('news-content-input').value = item.content;

                get('news-form-title').textContent = 'âœï¸ áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ';
                get('publish-news-btn').textContent = 'ğŸ’¾ áƒªáƒ•áƒšáƒ˜áƒšáƒ”áƒ‘áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ';
                get('cancel-news-edit-btn').classList.remove('hidden');

                // Scroll to form
                get('news-form-title').scrollIntoView({ behavior: 'smooth' });
            } catch (e) { console.error(e); }
        };

        window.deleteAdminNews = async (id) => {
            if (!confirm("áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒáƒ› áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?")) return;
            try {
                await sql`DELETE FROM news WHERE id = ${id}`;
                log('ğŸ—‘ï¸ áƒ¡áƒ˜áƒáƒ®áƒšáƒ” áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ', 'var(--danger)');
                loadAdminNews();
            } catch (e) { console.error(e); }
        };

        // --- ADMIN ABUSE LOGIC (DYNAMIC) ---
        // --- ADMIN ABUSE LOGIC (DYNAMIC) ---
        window.loadAdminAbuse = async () => {
            try {
                // Auto-fix schema check: Ensure 'id' is SERIAL
                const schemaCheck = await sql`
                    SELECT column_default 
                    FROM information_schema.columns 
                    WHERE table_name = 'admin_abuse' AND column_name = 'id'
                `;

                if (schemaCheck.length > 0 && schemaCheck[0].column_default === null) {
                    log('Fixing Admin Abuse Schema...', 'var(--accent)');
                    await sql`DROP TABLE IF EXISTS admin_abuse`;
                    await sql`CREATE TABLE IF NOT EXISTS admin_abuse (id SERIAL PRIMARY KEY, title TEXT, image_url TEXT, end_time TIMESTAMPTZ, link_url TEXT, created_at TIMESTAMP DEFAULT NOW())`;
                    log('âœ… Schema Fixed!', 'green');
                }

                const slots = await sql`SELECT * FROM admin_abuse ORDER BY created_at DESC LIMIT 20`;
                const container = get('admin-abuse-list');
                if (!container) return;

                if (slots.length === 0) {
                    container.innerHTML = '<p style="opacity:0.5; text-align:center; padding:20px;">áƒ¡áƒšáƒáƒ¢áƒ”áƒ‘áƒ˜ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ áƒ˜áƒ¡.</p>';
                    return;
                }

                container.innerHTML = slots.map(s => `
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border);">
                        <div style="flex: 1; overflow: hidden;">
                            <div style="font-weight: 800; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${s.title}</div>
                            <div style="font-size: 0.7rem; opacity: 0.5; margin-top: 4px;">â³ ${s.end_time ? new Date(s.end_time).toLocaleString('ka-GE') : 'áƒáƒ  áƒáƒ áƒ˜áƒ¡'}</div>
                        </div>
                        <div style="display: flex; gap: 8px; margin-left: 15px;">
                            <button class="btn btn-outline" style="padding: 6px 12px; font-size: 0.8rem;" onclick="editAbuseItem(${s.id})">âœï¸</button>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8rem;" onclick="deleteAbuseItem(${s.id})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error(e);
                log('âŒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡áƒáƒ¡: ' + e.message, 'red');
            }
        };

        window.publishAbuseItem = async () => {
            const id = get('edit-abuse-id').value;
            const title = get('abuse-title-input').value.trim();
            const img = get('abuse-image-input').value.trim();
            const time = get('abuse-time-input').value;
            const link = get('abuse-link-input').value.trim();

            if (!title) return alert('áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜ áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!');

            try {
                log(id ? 'áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ¡...' : 'áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ¡...', 'var(--primary)');

                if (id) {
                    if (time) {
                        await sql`UPDATE admin_abuse SET title=${title}, image_url=${img}, end_time=${time}, link_url=${link} WHERE id=${id}`;
                    } else {
                        await sql`UPDATE admin_abuse SET title=${title}, image_url=${img}, link_url=${link} WHERE id=${id}`;
                    }
                    log('âœ… áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ!', 'var(--accent)');
                } else {
                    await sql`INSERT INTO admin_abuse (title, image_url, end_time, link_url) VALUES (${title}, ${img}, ${time || null}, ${link})`;
                    log('âœ… áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ“áƒ!', 'var(--accent)');
                }

                resetAbuseForm();
                loadAdminAbuse();
            } catch (e) {
                console.error(e);
                log('âŒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + e.message, 'red');
            }
        };

        window.editAbuseItem = async (id) => {
            try {
                const res = await sql`SELECT * FROM admin_abuse WHERE id = ${id}`;
                if (res.length === 0) return;
                const s = res[0];

                get('edit-abuse-id').value = s.id;
                get('abuse-title-input').value = s.title;
                get('abuse-image-input').value = s.image_url || '';
                get('abuse-link-input').value = s.link_url || '';

                if (s.end_time) {
                    const date = new Date(s.end_time);
                    date.setMinutes(date.getMinutes() - date.getTimezoneOffset());
                    get('abuse-time-input').value = date.toISOString().slice(0, 16);
                } else {
                    get('abuse-time-input').value = '';
                }

                get('abuse-form-title').textContent = 'âœï¸ áƒ¡áƒšáƒáƒ¢áƒ˜áƒ¡ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ';
                get('publish-abuse-btn').textContent = 'ğŸ’¾ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ';
                get('cancel-abuse-edit-btn').classList.remove('hidden');

                get('abuse-form-title').scrollIntoView({ behavior: 'smooth' });
            } catch (e) { console.error(e); }
        };

        window.deleteAbuseItem = async (id) => {
            if (!confirm('áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ¬áƒáƒ¨áƒšáƒ?')) return;
            try {
                await sql`DELETE FROM admin_abuse WHERE id = ${id}`;
                log('ğŸ—‘ï¸ áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ!', 'var(--danger)');
                loadAdminAbuse();
            } catch (e) { console.error(e); }
        };

        window.resetAbuseForm = () => {
            get('edit-abuse-id').value = '';
            get('abuse-title-input').value = '';
            get('abuse-image-input').value = '';
            get('abuse-time-input').value = '';
            get('abuse-link-input').value = '';

            get('abuse-form-title').textContent = 'ğŸ’  ADMIN ABUSE áƒ›áƒáƒ áƒ—áƒ•áƒ';
            get('publish-abuse-btn').textContent = 'ğŸš€ áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ';
            get('cancel-abuse-edit-btn').classList.add('hidden');
        };

        // Initialize news list if tab is active
        document.querySelector('[data-tab="news"]').addEventListener('click', loadAdminNews);

        // COMMENTS Logic
        window.loadAdminComments = async () => {
            try {
                const comments = await sql`
                    SELECT c.*, n.title as news_title 
                    FROM news_comments c 
                    LEFT JOIN news n ON c.news_id = n.id 
                    ORDER BY c.created_at DESC 
                    LIMIT 200
                `;
                const container = get('admin-comments-list');

                if (comments.length === 0) {
                    container.innerHTML = '<p style="opacity: 0.5; text-align: center; padding: 20px;">áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ”áƒ‘áƒ˜ áƒáƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ.</p>';
                    return;
                }

                container.innerHTML = comments.map(c => `
                    <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border: 1px solid var(--border); position: relative;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <div>
                                <span style="font-weight: 800; color: var(--primary);">${c.nickname}</span>
                                <span style="font-size: 0.75rem; opacity: 0.5; margin-left: 10px;">${c.user_email} â€¢ ${new Date(c.created_at).toLocaleString()}</span>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.7rem; border-color: #ff9800; color: #ff9800;" onclick="moderateUser('${c.user_email}', 1)">â³ 1áƒ“</button>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.7rem; border-color: #ff9800; color: #ff9800;" onclick="moderateUser('${c.user_email}', 7)">â³ 1áƒ™</button>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.7rem; border-color: #ff9800; color: #ff9800;" onclick="moderateUser('${c.user_email}', 30)">â³ 1áƒ—</button>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.7rem;" onclick="moderateUser('${c.user_email}', 'ban')">ğŸš« BAN</button>
                                <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.7rem; background: #666; border-color: #666;" onclick="deleteAdminComment(${c.id})">ğŸ—‘ï¸ áƒ¬áƒáƒ¨áƒšáƒ</button>
                            </div>
                        </div>
                        <div style="font-size: 0.9rem; margin-bottom: 10px; line-height: 1.5; color: #ddd;">${c.comment_text}</div>
                        <div style="font-size: 0.7rem; opacity: 0.4; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 8px;">
                            ğŸ“Œ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”: <span style="color: #4facfe;">${c.news_title || 'áƒ¬áƒáƒ¨áƒšáƒ˜áƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”'}</span>
                        </div>
                    </div>
                `).join('');
            } catch (e) { console.error(e); log('Error loading comments', 'red'); }
        };


        window.deleteAdminComment = async (id) => {
            if (!confirm("áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒáƒ› áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?")) return;
            try {
                await sql`DELETE FROM news_comments WHERE id = ${id}`;
                log('ğŸ—‘ï¸ áƒ™áƒáƒ›áƒ”áƒœáƒ¢áƒáƒ áƒ˜ áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ', 'var(--danger)');
                loadAdminComments();
            } catch (e) { console.error(e); log('Error deleting comment', 'red'); }
        };

        get('sync-discord-btn').onclick = async () => {
            const token = get('discord-token').value.trim();
            const channelId = get('discord-channel-id').value.trim();
            const limit = parseInt(get('discord-limit').value) || 5;
            const status = get('sync-status');

            if (!token || !channelId) {
                alert("Please provide Token and Channel ID");
                return;
            }

            localStorage.setItem('admin_discord_token', token);
            status.textContent = "âŒ› Syncing from Discord...";
            status.style.color = "orange";

            try {
                const response = await fetch(`https://discord.com/api/v10/channels/${channelId}/messages?limit=${limit}`, {
                    headers: { 'Authorization': `Bot ${token}` }
                });

                if (!response.ok) throw new Error("Discord API Error: " + response.status);

                const messages = await response.json();
                let imported = 0;

                for (const msg of messages) {
                    if (!msg.content && msg.attachments.length === 0) continue;

                    // Use first line as title, rest as content
                    const lines = msg.content.split('\n');
                    let title = lines[0].substring(0, 100) || "Discord News";
                    let content = lines.slice(1).join('<br>') || msg.content;
                    if (lines.length === 1) {
                        content = title;
                        title = title.substring(0, 50) + "...";
                    }

                    const imageUrl = msg.attachments.length > 0 ? msg.attachments[0].url : null;
                    const category = "Discord";

                    // Check if already exists (simple title check)
                    const existing = await sql`SELECT id FROM news WHERE title = ${title} AND created_at > NOW() - INTERVAL '1 day'`;
                    if (existing.length === 0) {
                        await sql`INSERT INTO news (title, content, image_url, category, author) VALUES (${title}, ${content}, ${imageUrl}, ${category}, 'Discord Sync')`;
                        imported++;
                    }
                }

                status.textContent = `âœ… Success! Imported ${imported} new posts.`;
                status.style.color = "#00ff00";
                log(`Discord Sync Complete: +${imported} posts`, 'green');

            } catch (e) {
                console.error(e);
                status.textContent = "âŒ Error: " + e.message;
                status.style.color = "red";
                log('Discord Sync Failed', 'red');
            }
        };


        // DB SETUP
        // WIPE PROGRESS Logic
        get('wipe-progress-btn').onclick = async () => {
            const confirmed = confirm("âš ï¸ áƒ’áƒáƒ¤áƒ áƒ—áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ: áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ‘áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡, áƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒ áƒ“áƒ áƒáƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ?\n\náƒ”áƒ¥áƒáƒ£áƒœáƒ—áƒ”áƒ‘áƒ˜ (áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜/áƒáƒáƒ áƒáƒšáƒ˜) áƒ¨áƒ”áƒœáƒáƒ áƒ©áƒ£áƒœáƒ“áƒ”áƒ‘áƒ, áƒ›áƒáƒ’áƒ áƒáƒ› áƒáƒ áƒáƒ’áƒ áƒ”áƒ¡áƒ˜ áƒ¬áƒáƒ˜áƒ¨áƒšáƒ”áƒ‘áƒ!");
            if (!confirmed) return;

            log('Wiping progress...', 'var(--danger)');
            try {
                await sql`
                    UPDATE users 
                    SET score = 0, 
                        coins = 0, 
                        survival_time = 0, 
                        best_score = 0
                `;

                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', 'ğŸ”„ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒáƒ› áƒ›áƒáƒáƒ®áƒ“áƒ˜áƒœáƒ áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ! áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜ áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ 0-áƒ“áƒáƒœ! ğŸ§¼')`;

                const msg = 'ğŸ‰ áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒáƒ áƒáƒ’áƒ áƒ”áƒ¡áƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒœáƒ£áƒšáƒ“áƒ!';
                log(msg, 'green');
                alert(msg);
                loadPlayers();
            } catch (e) {
                console.error(e);
                log('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡', 'red');
                alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + e.message);
            }
        };

        // FULL WIPE Logic
        get('full-wipe-btn').onclick = async () => {
            const confirmed = confirm("ğŸ”¥ áƒ§áƒ£áƒ áƒáƒ“áƒ¦áƒ”áƒ‘áƒ: áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ›áƒ—áƒšáƒ˜áƒáƒœáƒ˜ áƒ‘áƒáƒ–áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?\n\náƒ¬áƒáƒ˜áƒ¨áƒšáƒ”áƒ‘áƒ áƒ§áƒ•áƒ”áƒšáƒ áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜, áƒáƒáƒ áƒáƒšáƒ˜ áƒ“áƒ áƒ”áƒ¥áƒáƒ£áƒœáƒ—áƒ˜! áƒáƒ›áƒ˜áƒ¡ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!");
            if (!confirmed) return;

            log('Deleting ALL data...', 'var(--danger)');
            try {
                await sql`DELETE FROM users`;
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', 'ğŸ”¥ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒáƒ› áƒ¡áƒ áƒ£áƒšáƒáƒ“ áƒ’áƒáƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒáƒ–áƒ!')`;
                log('ğŸ’¥ áƒ‘áƒáƒ–áƒ áƒ¡áƒ áƒ£áƒšáƒáƒ“ áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ!', 'red');
                loadPlayers();
            } catch (e) { log('Error: ' + e.message, 'red'); }
        };

        get('drop-vip-col-btn').onclick = async () => {
            if (!confirm("âš ï¸ Remove 'is_vip' column from database? This matches the VIP removal update.")) return;
            try {
                await sql`ALTER TABLE users DROP COLUMN IF EXISTS is_vip`;
                log('âœ… VIP column removed from database!', 'green');
            } catch (e) { log('Error dropping column: ' + e.message, 'red'); }
        };

        get('run-setup-btn').onclick = async () => {
            if (!confirm("áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— Database Setup? (áƒ”áƒ¡ áƒáƒ  áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡ áƒáƒ áƒ¡áƒ”áƒ‘áƒ£áƒš áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ¡)")) return;
            log('Setup áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ...', 'var(--accent)');
            try {
                // 1. Users table update
                await sql`CREATE TABLE IF NOT EXISTS users (id SERIAL PRIMARY KEY, email VARCHAR(255) UNIQUE NOT NULL, password VARCHAR(255) NOT NULL, nickname VARCHAR(50) NOT NULL, score INTEGER DEFAULT 0, coins INTEGER DEFAULT 0, total_coins INTEGER DEFAULT 0, survival_time INTEGER DEFAULT 0, best_score INTEGER DEFAULT 0, best_survival_time INTEGER DEFAULT 0, total_survival_time INTEGER DEFAULT 0, last_active TIMESTAMP DEFAULT NOW(), created_at TIMESTAMP DEFAULT NOW())`;
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS total_coins INTEGER DEFAULT 0`; } catch (e) { }
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS best_survival_time INTEGER DEFAULT 0`; } catch (e) { }
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS total_survival_time INTEGER DEFAULT 0`; } catch (e) { }
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS banned_until TIMESTAMPTZ`; } catch (e) { }

                // 2. Achievements (Match History) table
                await sql`CREATE TABLE IF NOT EXISTS game_results (id SERIAL PRIMARY KEY, user_email VARCHAR(255) REFERENCES users(email) ON DELETE CASCADE, score INTEGER NOT NULL, duration_seconds INTEGER NOT NULL, coins_earned INTEGER NOT NULL, played_at TIMESTAMP DEFAULT NOW())`;

                // 3. Indexes & Supporting tables
                await sql`CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)`;
                await sql`CREATE TABLE IF NOT EXISTS chat_messages (id SERIAL PRIMARY KEY, nickname VARCHAR(50) NOT NULL, message TEXT NOT NULL, created_at TIMESTAMP DEFAULT NOW())`;
                await sql`CREATE TABLE IF NOT EXISTS global_events (event_type VARCHAR(50) PRIMARY KEY, event_value TEXT, expires_at TIMESTAMP)`;

                // 4. Duel System Tables
                await sql`CREATE TABLE IF NOT EXISTS duel_invitations (id SERIAL PRIMARY KEY, sender_email VARCHAR(255) NOT NULL, receiver_email VARCHAR(255) NOT NULL, status VARCHAR(20) DEFAULT 'pending', created_at TIMESTAMP DEFAULT NOW())`;
                await sql`CREATE TABLE IF NOT EXISTS duels (id SERIAL PRIMARY KEY, player1_email VARCHAR(255) NOT NULL, player2_email VARCHAR(255) NOT NULL, player1_score INTEGER DEFAULT 0, player2_score INTEGER DEFAULT 0, start_time TIMESTAMP DEFAULT NOW(), end_time TIMESTAMP, winner_email VARCHAR(255), status VARCHAR(20) DEFAULT 'active')`;

                // 5. Admin Abuse Table (Force Recreate for Schema Update)
                try { await sql`DROP TABLE IF EXISTS admin_abuse`; } catch (e) { }
                await sql`CREATE TABLE IF NOT EXISTS admin_abuse (id SERIAL PRIMARY KEY, title TEXT, image_url TEXT, end_time TIMESTAMPTZ, link_url TEXT, created_at TIMESTAMP DEFAULT NOW())`;

                log('ğŸ‰ SETUP áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜áƒ!', 'green');
                loadPlayers();
            } catch (e) { log('Setup Error: ' + e.message, 'red'); }
        };

        get('test-db-btn').onclick = async () => {
            log('áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ...', 'white');
            try {
                const res = await sql`SELECT 1 as test`;
                const tables = await sql`SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'`;
                const tNames = tables.map(t => t.table_name);
                alert(`âœ… áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ OK!\náƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜: ${tNames.join(', ')}`);
                log('áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ', 'green');
            } catch (e) { log('DB Error', 'red'); alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + e.message); }
        };

        // ğŸ”® FANDOM WIKI AUTO-SYNC (Multi-Source)
        const FANDOM_SOURCES = [
            { id: 'brainrot', api: 'https://stealabrainrot.fandom.com/api.php', url: 'https://stealabrainrot.fandom.com', page: 'Leaks', type: 'leaks', category: 'áƒ¡áƒ—áƒ˜áƒšáƒ˜', prefix: 'ğŸ”® Brainrot áƒšáƒ˜áƒ™áƒ˜:' },
            { id: 'tsunami', api: 'https://escape-tsunami-for-brainrots.fandom.com/api.php', url: 'https://escape-tsunami-for-brainrots.fandom.com', page: 'Leaks', type: 'leaks', category: 'áƒªáƒ£áƒœáƒáƒ›áƒ˜', prefix: 'ğŸŒŠ Tsunami áƒšáƒ˜áƒ™áƒ˜:' },
            { id: 'nights', api: 'https://99-nights-in-the-forest.fandom.com/api.php', url: 'https://99-nights-in-the-forest.fandom.com', page: 'Update_Log', type: 'updates', category: '99 áƒ¦áƒáƒ›áƒ”', prefix: 'ğŸ› ï¸ 99 Nights áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ:' }
        ];
        let fandomAutoSyncInterval = null;

        function fandomLog(msg, color = '#f9a825') {
            const logEl = get('fandom-sync-log');
            const statusEl = get('fandom-sync-status');
            if (statusEl) statusEl.innerHTML = `<span style="color:${color}">${msg}</span>`;
            if (logEl) logEl.innerHTML = `<div style="color:${color};margin-bottom:4px;">[${new Date().toLocaleTimeString()}] ${msg}</div>` + logEl.innerHTML;
        }

        async function parseFandomSource(source) {
            try {
                const resp = await fetch(`${source.api}?action=parse&page=${source.page}&format=json&prop=wikitext&origin=*`);
                const data = await resp.json();
                if (!data.parse) return [];
                const wikitext = data.parse.wikitext['*'];
                const entries = [];

                if (source.type === 'leaks') {
                    const regex = /File:([^\|\]\n]+)\|([^\]\n]+)/g;
                    let match;
                    while ((match = regex.exec(wikitext)) !== null) {
                        const filename = match[1].split('|')[0].trim();
                        let desc = match[2].trim();

                        // Specific date extraction for Leaks (often at the end like "(Feb. 20th)")
                        let postDate = new Date();
                        const dateMatch = desc.match(/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\.? (\d+)/i);
                        if (dateMatch) {
                            const months = { jan: 0, feb: 1, mar: 2, apr: 3, may: 4, jun: 5, jul: 6, aug: 7, sep: 8, oct: 9, nov: 10, dec: 11 };
                            const m = months[dateMatch[1].toLowerCase().substring(0, 3)];
                            const d = parseInt(dateMatch[2]);
                            postDate = new Date(new Date().getFullYear(), m, d, 12, 0, 0);
                        }

                        desc = desc.replace(/\[\[([^\|\]]+)\|?([^\]]*)\]\]/g, (_, link, display) => display || link);
                        desc = desc.replace(/thumb|center|px|\|/g, '').trim();
                        entries.push({ filename, description: desc, date: postDate });
                    }
                } else if (source.type === 'updates') {
                    const rows = wikitext.split('|-');
                    for (let i = 1; i < rows.length; i++) {
                        const row = rows[i].trim();
                        const cells = row.split(/^\|/m).filter(c => c.trim() !== '');
                        if (cells.length >= 2) {
                            const nameCell = cells[0].trim();
                            const descCell = cells[cells.length - 1].trim();

                            const titleMatch = nameCell.match(/'''(.+?)'''/);
                            const title = titleMatch ? titleMatch[1] : nameCell.split('\n')[0].replace(/\[\[.+?\]\]/g, '').trim();
                            const fileMatch = nameCell.match(/File:([^\|\]\n]+)/);

                            let postDate = new Date();
                            // Handle M/D/YY or M/D/YYYY
                            const dateMatch = nameCell.match(/(\d{1,2})\/(\d{1,2})\/(''')?(\d{2,4})/);
                            if (dateMatch) {
                                let y = parseInt(dateMatch[4]);
                                if (y < 100) y += 2000;
                                postDate = new Date(y, parseInt(dateMatch[1]) - 1, parseInt(dateMatch[2]), 12, 0, 0);
                            }

                            entries.push({
                                filename: fileMatch ? fileMatch[1].split('|')[0].trim() : '',
                                description: `${title}: ${descCell.replace(/\[\[([^\|\]]+)\|?([^\]]*)\]\]/g, (_, link, display) => display || link).trim()}`,
                                date: postDate
                            });
                        }
                    }
                }
                return entries;
            } catch (e) { console.error(e); return []; }
        }

        async function getImageUrl(api, filename) {
            if (!filename) return '';
            try {
                const resp = await fetch(`${api}?action=query&titles=File:${encodeURIComponent(filename)}&prop=imageinfo&iiprop=url&format=json&origin=*`);
                const data = await resp.json();
                const pages = data.query.pages;
                const pageId = Object.keys(pages)[0];
                if (pages[pageId].imageinfo && pages[pageId].imageinfo.length > 0) {
                    return pages[pageId].imageinfo[0].url;
                }
            } catch (e) { console.error('Image Error:', e); }
            return '';
        }

        async function syncFandomAll(count = 3) {
            try {
                fandomLog('ğŸ“¡ Fandom Wiki-áƒ”áƒ‘áƒ˜áƒ“áƒáƒœ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒáƒ›áƒáƒ¦áƒ”áƒ‘áƒ...');
                let totalAdded = 0;

                for (const source of FANDOM_SOURCES) {
                    fandomLog(`ğŸ” áƒ›áƒáƒ¬áƒ›áƒ“áƒ”áƒ‘áƒ ${source.id}...`);
                    const allEntries = await parseFandomSource(source);
                    if (allEntries.length === 0) {
                        fandomLog(`âš ï¸ ${source.id}-áƒ–áƒ” áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ`, 'orange');
                        continue;
                    }

                    // For Leaks, newest are at the bottom. For Update Log, newest are at the top.
                    let latest;
                    if (source.type === 'leaks') {
                        latest = allEntries.slice(-count).reverse();
                    } else {
                        latest = allEntries.slice(0, count);
                    }

                    const existing = await sql`SELECT title FROM news WHERE category = ${source.category} ORDER BY created_at DESC LIMIT 50`;
                    const existingTitles = new Set(existing.map(e => e.title.toLowerCase().trim()));

                    for (const entry of latest) {
                        const fullTitle = `${source.prefix} ${entry.description}`;
                        if (existingTitles.has(fullTitle.toLowerCase().trim())) {
                            // fandomLog(`â­ï¸ áƒáƒ áƒ¡áƒ”áƒ‘áƒáƒ‘áƒ¡: ${source.id}`, '#888');
                            continue;
                        }

                        fandomLog(`ğŸ–¼ï¸ áƒ¡áƒ£áƒ áƒáƒ—áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ: ${entry.filename || 'No Image'}...`);
                        const imageUrl = await getImageUrl(source.api, entry.filename);

                        const opinions = ["áƒ¡áƒáƒ˜áƒœáƒ¢áƒ”áƒ áƒ”áƒ¡áƒáƒ“ áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ£áƒ áƒ”áƒ‘áƒ! ğŸ”¥", "áƒáƒ®áƒáƒšáƒ˜ áƒáƒ›áƒ‘áƒ”áƒ‘áƒ˜áƒ! ğŸ®", "áƒ”áƒáƒ˜áƒ™áƒ£áƒ áƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒáƒ! ğŸ’¥", "áƒ•áƒ”áƒšáƒáƒ“áƒ”áƒ‘áƒ˜áƒ— áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ¡! ğŸ˜", "áƒ«áƒáƒšáƒ˜áƒáƒœ áƒ›áƒáƒ’áƒáƒ áƒ˜áƒ! ğŸ†"];
                        const opinion = opinions[Math.floor(Math.random() * opinions.length)];

                        const content = `
                            <p><strong>${entry.description}</strong></p>
                            <p>ğŸ’¬ <em>áƒáƒ–áƒ áƒ˜:</em> ${opinion}</p>
                            <p>áƒ¬áƒ§áƒáƒ áƒ: <a href="${source.url}/wiki/${source.page}" target="_blank">${source.id} Wiki</a></p>
                            <p style="opacity:0.5;font-size:0.8em;">ğŸ”® áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒ˜ áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒáƒªáƒ˜áƒ</p>
                        `;

                        const res = await sql`INSERT INTO news (title, content, image_url, video_url, category, created_at) VALUES (${fullTitle}, ${content}, ${imageUrl}, ${''}, ${source.category}, ${entry.date || new Date()}) RETURNING id`;

                        const webhookUrl = localStorage.getItem('admin_discord_webhook');
                        if (webhookUrl) {
                            try { await sendDiscordNotification(webhookUrl, fullTitle, content, imageUrl, res[0].id); } catch (e) { }
                        }
                        totalAdded++;
                        fandomLog(`âœ… áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒ (${source.id}): ${entry.description.slice(0, 30)}...`, '#4caf50');
                    }
                }

                if (totalAdded > 0) {
                    fandomLog(`ğŸ‰ áƒ¡áƒ£áƒš áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒ ${totalAdded} áƒ¡áƒ˜áƒáƒ®áƒšáƒ”!`, '#4caf50');
                    loadAdminNews();
                } else {
                    fandomLog('âœ¨ áƒáƒ®áƒáƒšáƒ˜ áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡.', '#4caf50');
                }
            } catch (e) {
                console.error(e);
                fandomLog(`âŒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ${e.message}`, 'red');
            }
        }

        // Sync button â€” manual: last 3
        get('sync-fandom-btn').onclick = () => syncFandomAll(3);

        // Auto-sync toggle
        const autoSyncToggle = get('fandom-auto-sync-toggle');
        if (localStorage.getItem('fandom_auto_sync') === 'true') {
            autoSyncToggle.checked = true;
            startFandomAutoSync();
        }

        autoSyncToggle.onchange = () => {
            localStorage.setItem('fandom_auto_sync', autoSyncToggle.checked);
            if (autoSyncToggle.checked) {
                startFandomAutoSync();
                fandomLog('ğŸ”„ áƒáƒ•áƒ¢áƒ-áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒáƒªáƒ˜áƒ áƒ©áƒáƒ áƒ—áƒ£áƒšáƒ˜áƒ (10 áƒ¬áƒ—)', '#4caf50');
            } else {
                stopFandomAutoSync();
                fandomLog('â¹ï¸ áƒáƒ•áƒ¢áƒ-áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒáƒªáƒ˜áƒ áƒ’áƒáƒ›áƒáƒ áƒ—áƒ£áƒšáƒ˜áƒ', '#888');
            }
        };

        function startFandomAutoSync() {
            if (fandomAutoSyncInterval) clearInterval(fandomAutoSyncInterval);
            fandomAutoSyncInterval = setInterval(() => syncFandomAll(1), 10 * 60 * 1000);
            fandomLog('ğŸ”„ áƒáƒ•áƒ¢áƒ-áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒáƒªáƒ˜áƒ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜áƒ', '#4caf50');
        }

        function stopFandomAutoSync() {
            if (fandomAutoSyncInterval) {
                clearInterval(fandomAutoSyncInterval);
                fandomAutoSyncInterval = null;
            }
        }

    </script>
</body>

</html>