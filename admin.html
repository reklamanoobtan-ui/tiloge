<!DOCTYPE html>
<html lang="ka">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tilo.life - Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4facfe;
            --secondary: #00f2fe;
            --accent: #ffd700;
            --danger: #ff4d4d;
            --bg: #0a0a0c;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background: var(--bg);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- Login Section --- */
        #login-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #0a0a0c 0%, #1a1a2e 100%);
        }

        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            padding: 50px;
            border-radius: 30px;
            border: 1px solid var(--border);
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .login-card h1 {
            font-size: 2rem;
            margin-bottom: 30px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            color: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 20px;
            outline: none;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--primary);
            background: rgba(0, 0, 0, 0.5);
        }

        /* --- Admin Layout --- */
        #admin-controls {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.02);
            border-right: 1px solid var(--border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
        }

        .sidebar-header {
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.2rem;
        }

        .nav-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(79, 172, 254, 0.1);
            color: var(--primary);
            border: 1px solid rgba(79, 172, 254, 0.2);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 40px;
            max-width: 1200px;
        }

        .header-bar {
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-bar h2 {
            font-size: 1.8rem;
            font-weight: 800;
        }

        /* Cards & Grids */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 30px;
            transition: 0.3s;
        }

        .card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .card h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
        }

        /* Tabs Logic */
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Buttons Custom */
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
        }

        .btn-gold {
            background: var(--accent);
            color: #000;
        }

        .btn-danger {
            background: var(--danger);
            color: #fff;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: #fff;
        }

        .btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Player List & Database */
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .players-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .player-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .player-card.vip {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(0, 0, 0, 0) 100%);
        }

        .player-details {
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-badge {
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 10px;
            border-radius: 8px;
            margin-right: 5px;
            margin-top: 5px;
            display: inline-block;
        }

        .stat-badge strong {
            color: var(--primary);
        }

        /* Status Toast */
        #status-msg {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border: 1px solid var(--border);
            display: none;
            animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* UI Helpers */
        .flex-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .full-width {
            width: 100%;
        }

        select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            color: #fff;
            padding: 12px;
            border-radius: 12px;
            outline: none;
        }
    </style>
</head>

<body>

    <!-- LOGIN SECTION -->
    <div id="login-section">
        <div class="login-card">
            <h1>ğŸ›¡ï¸ TILO ADMIN</h1>
            <input type="password" id="admin-pass" placeholder="áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒáƒáƒ áƒáƒšáƒ˜">
            <button class="btn btn-primary full-width" id="login-btn">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
            <p id="login-status" style="margin-top: 20px; color: var(--danger); font-size: 0.9rem;"></p>
        </div>
    </div>

    <!-- MAIN ADMIN PANEL -->
    <div id="admin-controls" style="display: none;">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">T</div>
                <h2 style="font-size: 1.2rem;">ADMIN PANEL</h2>
            </div>

            <div class="nav-items">
                <div class="nav-item active" data-tab="dashboard">ğŸ“Š Dashboard</div>
                <div class="nav-item" data-tab="players">ğŸ‘¥ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="systems">âš™ï¸ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ</div>
                <div class="nav-item" data-tab="events">ğŸ‰ áƒ˜áƒ•áƒ”áƒœáƒ—áƒ”áƒ‘áƒ˜</div>
                <div class="nav-item" data-tab="critical" style="color: var(--danger);">âš ï¸ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜</div>
            </div>

            <div style="margin-top: auto;">
                <button class="btn btn-outline full-width" onclick="location.reload()">ğŸ”’ áƒ’áƒáƒ›áƒáƒ¡áƒ•áƒšáƒ</button>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- DASHBOARD TAB -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="header-bar">
                    <h2>ğŸ“Š Dashboard</h2>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <h3>âš¡ áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜ áƒ›áƒáƒ áƒ—áƒ•áƒ</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.9rem;">áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜
                            áƒªáƒ•áƒšáƒ˜áƒšáƒ”áƒ‘áƒ</p>
                        <input type="text" id="target-nick" placeholder="áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜...">
                        <div class="flex-row mt-10" style="flex-wrap: wrap;">
                            <button class="btn btn-gold" id="give-coins">ğŸª™ +1000 Coins</button>
                            <button class="btn btn-primary" id="give-vip">ğŸ‘‘ Grant VIP</button>
                            <button class="btn btn-danger" id="ban-user">ğŸš« BAN ACCOUNT</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>ğŸ’¬ Broadcast Message</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.9rem;">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ”áƒ— áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ
                            áƒ§áƒ•áƒ”áƒšáƒáƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ¨áƒ˜</p>
                        <input type="text" id="broadcast-msg" placeholder="áƒ áƒ áƒ“áƒáƒ•áƒ¬áƒ”áƒ áƒáƒ—?">
                        <button class="btn btn-primary full-width mt-10" id="send-broadcast">ğŸš€ áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
                    </div>

                    <div class="card">
                        <h3>ğŸ“‰ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ‘áƒáƒœáƒ£áƒ¡áƒ˜</h3>
                        <div id="active-bonus-timer"
                            style="display: none; background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; border: 1px solid var(--accent);">
                            <p style="color: var(--accent); font-weight: 800; font-size: 1.1rem;" id="bonus-name">
                                Multiplier Active</p>
                            <p style="font-size: 2rem; font-weight: 800;" id="bonus-time-left">0:00</p>
                        </div>
                        <div id="no-bonus-msg" style="text-align: center; opacity: 0.3; padding: 20px;">
                            áƒáƒ›áƒŸáƒáƒ›áƒáƒ“ áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜ áƒ‘áƒáƒœáƒ£áƒ¡áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡
                        </div>
                    </div>
                </div>
            </div>

            <!-- PLAYERS TAB -->
            <div id="tab-players" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ‘¥ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒáƒ–áƒ</h2>
                    <div class="flex-row">
                        <span>áƒ¡áƒ£áƒš: <strong id="total-players" style="color: var(--primary);">0</strong></span>
                        <button class="btn btn-outline" id="refresh-players">ğŸ”„ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ</button>
                    </div>
                </div>

                <div class="search-bar">
                    <input type="text" id="search-player" placeholder="áƒ«áƒ”áƒ‘áƒœáƒ áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜áƒ— áƒáƒœ áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜áƒ—..."
                        style="margin-bottom: 0;">
                    <select id="sort-players">
                        <option value="newest">ğŸ†• áƒáƒ®áƒáƒšáƒ˜ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜</option>
                        <option value="score">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ—</option>
                        <option value="coins">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜áƒ—</option>
                        <option value="time">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒ“áƒ áƒáƒ˜áƒ—</option>
                        <option value="nickname">áƒ“áƒáƒáƒšáƒáƒ’áƒ” áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜áƒ—</option>
                    </select>
                </div>

                <div id="players-list" class="players-container">
                    <!-- Loaded dynamically -->
                </div>
            </div>


            <!-- SYSTEMS TAB -->
            <div id="tab-systems" class="tab-content">
                <div class="header-bar">
                    <h2>âš™ï¸ áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ£áƒ áƒ˜ áƒ›áƒáƒ áƒ—áƒ•áƒ</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>ğŸ§¹ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒáƒ› áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!</p>
                        <button class="btn btn-danger full-width" id="reset-lb">âš  RESET LEADERBOARD âš </button>
                    </div>
                    <div class="card">
                        <h3>ğŸ“¡ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒ¢áƒ”áƒ¡áƒ¢áƒ˜</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ— Database-áƒ—áƒáƒœ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ áƒ“áƒ áƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜áƒ¡
                            áƒ›áƒ“áƒ’áƒáƒ›áƒáƒ áƒ”áƒáƒ‘áƒ</p>
                        <button class="btn btn-outline full-width" id="test-db-btn">ğŸ” DATABASE TEST</button>
                    </div>
                </div>
            </div>

            <!-- EVENTS TAB -->
            <div id="tab-events" class="tab-content">
                <div class="header-bar">
                    <h2>ğŸ‰ Global Events Management</h2>
                </div>
                <div class="card" style="margin-bottom: 25px;">
                    <h3>ğŸŒ Custom Multiplier Configuration</h3>
                    <div style="margin-top: 15px;">
                        <label style="display:block; margin-bottom:5px; opacity:0.8;">Multiplier Amount (X):</label>
                        <input type="number" id="event-mult" class="search-input"
                            style="width: 100%; margin-bottom: 15px; background: rgba(0,0,0,0.2); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;"
                            value="2" min="1">

                        <label style="display:block; margin-bottom:5px; opacity:0.8;">Duration (Minutes):</label>
                        <input type="number" id="event-duration" class="search-input"
                            style="width: 100%; margin-bottom: 15px; background: rgba(0,0,0,0.2); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;"
                            value="10" min="1">

                        <button class="btn btn-gold full-width" id="start-custom-event"
                            style="font-weight: bold; font-size: 1.1rem;">ğŸš€ START EVENT</button>
                        <button class="btn btn-danger full-width mt-10" id="stop-events"
                            style="margin-top: 10px; opacity: 0.8;">ğŸ›‘ STOP ALL EVENTS</button>
                    </div>
                </div>
            </div>

            <!-- CRITICAL TAB -->
            <div id="tab-critical" class="tab-content">
                <div class="header-bar">
                    <h2 style="color: var(--danger);">âš ï¸ áƒ™áƒ áƒ˜áƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ”áƒ‘áƒ˜</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="card" style="border-color: var(--accent);">
                        <h3 style="color: var(--accent);">ğŸš€ DATABASE SETUP</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒáƒ®áƒáƒšáƒ˜ Database-áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ áƒ—áƒ•áƒ áƒ“áƒ áƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ áƒ”áƒ áƒ—
                            áƒ™áƒšáƒ˜áƒ™áƒ¨áƒ˜.</p>
                        <button class="btn btn-gold full-width" id="run-setup-btn">RUN SETUP SCRIPT</button>
                    </div>
                    <div class="card" style="border-color: var(--danger);">
                        <h3 style="color: var(--danger);">ğŸ”¥ SITE RESTART</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ“áƒ áƒ¡áƒ”áƒ¡áƒ˜áƒ”áƒ‘áƒ˜áƒ¡
                            áƒ’áƒáƒ¬áƒ§áƒ•áƒ”áƒ¢áƒ.</p>
                        <button class="btn btn-danger full-width" id="restart-site">RESTART NOW</button>
                    </div>
                    <div class="card" style="border-color: var(--danger); background: rgba(255, 77, 77, 0.05);">
                        <h3 style="color: var(--danger);">ğŸ§¹ WIPE DATA</h3>
                        <p style="opacity: 0.6; margin-bottom: 20px;">áƒáƒ áƒáƒ’áƒ áƒ”áƒ¡áƒ˜áƒ¡ áƒáƒœ áƒ›áƒ—áƒšáƒ˜áƒáƒœáƒ˜ áƒ‘áƒáƒ–áƒ˜áƒ¡ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ.</p>
                        <button class="btn btn-danger full-width" id="wipe-progress-btn"
                            style="margin-bottom: 10px;">RESET PROGRESS (Keep Accounts)</button>
                        <button class="btn btn-danger full-width" id="full-wipe-btn"
                            style="background: #ff0000; border: 2px solid white;">ğŸ”¥ FULL RESET (Delete All
                            Accounts)</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Messages -->
    <div id="status-msg"></div>

    <script type="module">
        import { neon } from 'https://cdn.jsdelivr.net/npm/@neondatabase/serverless@0.9.4/+esm';
        const sql = neon("postgresql://neondb_owner:npg_NBPsUe3FXb4o@ep-calm-wildflower-aim8iczt-pooler.c-4.us-east-1.aws.neon.tech/neondb?sslmode=require");

        const get = (id) => document.getElementById(id);
        const status = get('status-msg');

        function log(msg, color = 'var(--primary)') {
            status.textContent = msg;
            status.style.display = 'block';
            status.style.borderLeft = `5px solid ${color}`;
            setTimeout(() => {
                status.style.display = 'none';
            }, 4000);
        }

        // --- Tabs Logic ---
        document.querySelectorAll('.nav-item').forEach(item => {
            item.onclick = () => {
                const target = item.dataset.tab;

                // Update nav
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                // Update content
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                get(`tab-${target}`).classList.add('active');

                // Auto-load if entering tab
                if (target === 'players') loadPlayers();
            };
        });

        // Auth Logic
        get('login-btn').onclick = async () => {
            const pass = get('admin-pass').value.trim();
            const loginStatus = get('login-status');

            if (!pass) return;
            loginStatus.textContent = "áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ¡...";

            if (pass === "unoobi123!123!") {
                get('login-section').style.display = 'none';
                get('admin-controls').style.display = 'flex';
                log('áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ—, áƒáƒ“áƒ›áƒ˜áƒœ!', 'var(--primary)');
                if (typeof updateDashboardStats === 'function') updateDashboardStats();
                loadPlayers(); // Load players immediately
            } else {
                loginStatus.textContent = "áƒáƒáƒ áƒáƒšáƒ˜ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜áƒ!";
                loginStatus.style.color = "var(--danger)";
            }
        };

        get('give-coins').onclick = async () => {
            const name = get('target-nick').value.trim();
            if (!name) return;
            try {
                await sql`UPDATE users SET coins = coins + 1000 WHERE nickname = ${name}`;
                log(`Sent 1000 coins to ${name}`);
            } catch (e) { log('Error updating database', 'red'); }
        };

        get('give-vip').onclick = async () => {
            const name = get('target-nick').value.trim();
            if (!name) return;
            try {
                await sql`UPDATE users SET is_vip = true WHERE nickname = ${name}`;
                log(`Given VIP to ${name}`);
            } catch (e) { log('Error updating database', 'red'); }
        };

        get('ban-user').onclick = async () => {
            const name = get('target-nick').value.trim();
            if (!name) return;
            if (confirm(`Are you sure you want to BAN ${name}?`)) {
                try {
                    await sql`UPDATE users SET score = 0, survival_time = 0, coins = 0, is_vip = false, best_score = 0 WHERE nickname = ${name}`;
                    log(`Banned/Reset ${name}`, 'red');
                } catch (e) { log('Error updating database', 'red'); }
            }
        };

        get('reset-lb').onclick = async () => {
            if (confirm("RESET ENTIRE LEADERBOARD?")) {
                try {
                    await sql`UPDATE users SET score = 0, survival_time = 0`;
                    log("Leaderboard Reset!", 'red');
                } catch (e) { log('Error', 'red'); }
            }
        };

        get('send-broadcast').onclick = async () => {
            const msg = get('broadcast-msg').value.trim();
            if (!msg) return;
            try {
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', ${msg})`;
                get('broadcast-msg').value = '';
                log("Broadcast sent!");
            } catch (e) { log('Error', 'red'); }
        };

        const triggerEvent = async (type, val, duration) => {
            try {
                const expireDate = new Date(Date.now() + duration * 60000);
                await sql`DELETE FROM global_events WHERE event_type = ${type}`;
                await sql`INSERT INTO global_events (event_type, event_value, expires_at) 
                          VALUES (${type}, ${val.toString()}, ${expireDate.toISOString()})`;

                const msg = `ğŸŒ GLOBAL ${val}X SCORE ACTIVE FOR ${duration} MINUTES! âœ¨`;
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', ${msg})`;
                log(`Triggered ${val}X for ${duration}m`);
                updateBonusTimer();
            } catch (e) { console.error(e); log('Error triggering event', 'red'); }
        };

        get('start-custom-event').onclick = () => {
            const mult = parseInt(get('event-mult').value) || 2;
            const dur = parseInt(get('event-duration').value) || 10;
            triggerEvent('multiplier', mult, dur);
        };

        get('stop-events').onclick = async () => {
            if (!confirm('Stop all active events?')) return;
            try {
                await sql`DELETE FROM global_events`;
                log('ğŸ›‘ Events Stopped', 'orange');
                updateBonusTimer();
            } catch (e) { log('Error', 'red'); }
        };

        get('restart-site').onclick = async () => {
            if (confirm("âš ï¸ áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ›áƒ—áƒ”áƒšáƒ˜ áƒ¡áƒáƒ˜áƒ¢áƒ˜áƒ¡ áƒ áƒ”áƒ¡áƒ¢áƒáƒ áƒ¢áƒ˜? áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ” áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ£áƒš áƒ˜áƒ¥áƒœáƒ”áƒ‘áƒ!")) {
                try {
                    await sql`DELETE FROM global_events`;
                    await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', 'ğŸ”„ áƒ¡áƒáƒ˜áƒ¢áƒ˜ áƒ áƒ”áƒ¡áƒ¢áƒáƒ áƒ¢áƒ“áƒ”áƒ‘áƒ 5 áƒ¬áƒáƒ›áƒ¨áƒ˜...')`;
                    log("Restarting site in 5 seconds...", 'red');
                    localStorage.setItem('tilo_force_reload', Date.now().toString());
                    setTimeout(() => { window.location.reload(); }, 5000);
                } catch (e) { console.error(e); log('Error restarting site', 'red'); }
            }
        };

        async function updateBonusTimer() {
            try {
                const events = await sql`SELECT event_type, event_value, expires_at FROM global_events WHERE expires_at > NOW() LIMIT 1`;
                const timerDiv = get('active-bonus-timer');
                const noMsg = get('no-bonus-msg');
                const bonusName = get('bonus-name');
                const timeLeft = get('bonus-time-left');

                if (events.length > 0) {
                    const event = events[0];
                    const remainingMs = new Date(event.expires_at) - new Date();
                    if (remainingMs > 0) {
                        const min = Math.floor(remainingMs / 60000);
                        const sec = Math.floor((remainingMs % 60000) / 1000);
                        bonusName.textContent = event.event_type === 'multiplier' ? `${event.event_value}X Score Bonus` : 'Rainbow Event';
                        timeLeft.textContent = `${min}:${sec.toString().padStart(2, '0')}`;
                        timerDiv.style.display = 'block';
                        noMsg.style.display = 'none';
                    } else {
                        timerDiv.style.display = 'none';
                        noMsg.style.display = 'block';
                    }
                } else {
                    timerDiv.style.display = 'none';
                    noMsg.style.display = 'block';
                }
            } catch (e) { console.error('Timer error:', e); }
        }

        setInterval(updateBonusTimer, 1000);

        // PLAYERS DB
        let allPlayers = [];
        let filteredPlayers = [];

        async function loadPlayers() {
            try {
                const sortBy = get('sort-players').value;
                let players;

                if (sortBy === 'newest') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY id DESC LIMIT 1000`;
                } else if (sortBy === 'score') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY score DESC LIMIT 1000`;
                } else if (sortBy === 'coins') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY coins DESC LIMIT 1000`;
                } else if (sortBy === 'time') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY survival_time DESC LIMIT 1000`;
                } else {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY nickname ASC LIMIT 1000`;
                }

                allPlayers = players;
                filteredPlayers = players;
                displayPlayers(filteredPlayers);
                get('total-players').textContent = players.length;
            } catch (e) {
                console.error(e);
                log('áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ', 'red');
                alert("áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: " + e.message);
            }
        }

        function displayPlayers(players) {
            const container = get('players-list');
            if (players.length === 0) {
                container.innerHTML = '<p style="text-align: center; width: 100%; opacity: 0.5; padding: 50px;">áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ”áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</p>';
                return;
            }

            container.innerHTML = players.map(player => {
                const isGuest = player.email.startsWith('guest_');
                const timeFormatted = formatTime(player.survival_time);
                const lastActive = player.last_active ? new Date(player.last_active).toLocaleString('ka-GE') : 'áƒáƒ áƒáƒ¡áƒ“áƒ áƒáƒ¡';

                return `
                    <div class="player-card ${player.is_vip ? 'vip' : ''}">
                        <div class="player-details">
                            <div class="player-name">
                                ${player.is_vip ? 'ğŸ‘‘ ' : ''}${player.nickname}
                                ${isGuest ? '<span style="font-size: 0.65rem; background: #333; padding: 2px 6px; border-radius: 4px;">GUEST</span>' : ''}
                            </div>
                            <div style="font-size: 0.8rem; opacity: 0.5;">${player.email}</div>
                        </div>
                        <div class="stats">
                            <span class="stat-badge">â­ áƒ¥áƒ£áƒšáƒ: <strong>${Math.floor(player.score)}</strong></span>
                            <span class="stat-badge">ğŸª™ áƒ‘áƒáƒšáƒáƒœáƒ¡áƒ˜: <strong>${player.coins}</strong></span>
                            <span class="stat-badge">ğŸ’° áƒ¡áƒ£áƒš: <strong>${player.total_coins || 0}</strong></span>
                            <span class="stat-badge">â±ï¸ áƒ“áƒ áƒ: <strong>${timeFormatted}</strong></span>
                        </div>
                        <div style="margin-top: 15px; font-size: 0.7rem; opacity: 0.4;">áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜: ${lastActive}</div>
                    </div>
                `;
            }).join('');
        }

        function formatTime(s) {
            const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sc = s % 60;
            return h > 0 ? `${h}áƒ¡ ${m}áƒ¬` : m > 0 ? `${m}áƒ¬ ${sc}áƒ¬` : `${sc}áƒ¬`;
        }

        get('search-player').oninput = () => {
            const q = get('search-player').value.toLowerCase().trim();
            filteredPlayers = q ? allPlayers.filter(p => p.nickname.toLowerCase().includes(q) || p.email.toLowerCase().includes(q)) : allPlayers;
            displayPlayers(filteredPlayers);
        };

        get('refresh-players').onclick = loadPlayers;
        get('sort-players').onchange = loadPlayers;


        // DB SETUP
        // WIPE PROGRESS Logic
        get('wipe-progress-btn').onclick = async () => {
            const confirmed = confirm("âš ï¸ áƒ’áƒáƒ¤áƒ áƒ—áƒ®áƒ˜áƒšáƒ”áƒ‘áƒ: áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ‘áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡, áƒ¥áƒáƒ˜áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒ áƒ“áƒ áƒáƒ˜áƒ¡ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ?\n\náƒ”áƒ¥áƒáƒ£áƒœáƒ—áƒ”áƒ‘áƒ˜ (áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜/áƒáƒáƒ áƒáƒšáƒ˜) áƒ¨áƒ”áƒœáƒáƒ áƒ©áƒ£áƒœáƒ“áƒ”áƒ‘áƒ, áƒ›áƒáƒ’áƒ áƒáƒ› áƒáƒ áƒáƒ’áƒ áƒ”áƒ¡áƒ˜ áƒ¬áƒáƒ˜áƒ¨áƒšáƒ”áƒ‘áƒ!");
            if (!confirmed) return;

            log('Wiping progress...', 'var(--danger)');
            try {
                await sql`
                    UPDATE users 
                    SET score = 0, 
                        coins = 0, 
                        survival_time = 0, 
                        best_score = 0
                `;

                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', 'ğŸ”„ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒáƒ› áƒ›áƒáƒáƒ®áƒ“áƒ˜áƒœáƒ áƒ¥áƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ! áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜ áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ 0-áƒ“áƒáƒœ! ğŸ§¼')`;

                const msg = 'ğŸ‰ áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒáƒ áƒáƒ’áƒ áƒ”áƒ¡áƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒœáƒ£áƒšáƒ“áƒ!';
                log(msg, 'green');
                alert(msg);
                loadPlayers();
            } catch (e) {
                console.error(e);
                log('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ’áƒáƒœáƒ£áƒšáƒ”áƒ‘áƒ˜áƒ¡áƒáƒ¡', 'red');
                alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + e.message);
            }
        };

        // FULL WIPE Logic
        get('full-wipe-btn').onclick = async () => {
            const confirmed = confirm("ğŸ”¥ áƒ§áƒ£áƒ áƒáƒ“áƒ¦áƒ”áƒ‘áƒ: áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— áƒ›áƒ—áƒšáƒ˜áƒáƒœáƒ˜ áƒ‘áƒáƒ–áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?\n\náƒ¬áƒáƒ˜áƒ¨áƒšáƒ”áƒ‘áƒ áƒ§áƒ•áƒ”áƒšáƒ áƒ˜áƒ›áƒ”áƒ˜áƒšáƒ˜, áƒáƒáƒ áƒáƒšáƒ˜ áƒ“áƒ áƒ”áƒ¥áƒáƒ£áƒœáƒ—áƒ˜! áƒáƒ›áƒ˜áƒ¡ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!");
            if (!confirmed) return;

            log('Deleting ALL data...', 'var(--danger)');
            try {
                await sql`DELETE FROM users`;
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('ğŸ“¢ SYSTEM', 'ğŸ”¥ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒáƒ› áƒ¡áƒ áƒ£áƒšáƒáƒ“ áƒ’áƒáƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒáƒ–áƒ!')`;
                log('ğŸ’¥ áƒ‘áƒáƒ–áƒ áƒ¡áƒ áƒ£áƒšáƒáƒ“ áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ!', 'red');
                loadPlayers();
            } catch (e) { log('Error: ' + e.message, 'red'); }
        };

        get('run-setup-btn').onclick = async () => {
            if (!confirm("áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ— Database Setup? (áƒ”áƒ¡ áƒáƒ  áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡ áƒáƒ áƒ¡áƒ”áƒ‘áƒ£áƒš áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ¡)")) return;
            log('Setup áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ...', 'var(--accent)');
            try {
                // 1. Users table update
                await sql`CREATE TABLE IF NOT EXISTS users (id SERIAL PRIMARY KEY, email VARCHAR(255) UNIQUE NOT NULL, password VARCHAR(255) NOT NULL, nickname VARCHAR(50) NOT NULL, score INTEGER DEFAULT 0, coins INTEGER DEFAULT 0, total_coins INTEGER DEFAULT 0, is_vip BOOLEAN DEFAULT FALSE, survival_time INTEGER DEFAULT 0, best_score INTEGER DEFAULT 0, best_survival_time INTEGER DEFAULT 0, total_survival_time INTEGER DEFAULT 0, last_active TIMESTAMP DEFAULT NOW(), created_at TIMESTAMP DEFAULT NOW())`;
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS total_coins INTEGER DEFAULT 0`; } catch (e) { }
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS best_survival_time INTEGER DEFAULT 0`; } catch (e) { }
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS total_survival_time INTEGER DEFAULT 0`; } catch (e) { }

                // 2. Achievements (Match History) table
                await sql`CREATE TABLE IF NOT EXISTS game_results (id SERIAL PRIMARY KEY, user_email VARCHAR(255) REFERENCES users(email) ON DELETE CASCADE, score INTEGER NOT NULL, duration_seconds INTEGER NOT NULL, coins_earned INTEGER NOT NULL, played_at TIMESTAMP DEFAULT NOW())`;

                // 3. Indexes & Supporting tables
                await sql`CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)`;
                await sql`CREATE TABLE IF NOT EXISTS chat_messages (id SERIAL PRIMARY KEY, nickname VARCHAR(50) NOT NULL, message TEXT NOT NULL, created_at TIMESTAMP DEFAULT NOW())`;
                await sql`CREATE TABLE IF NOT EXISTS global_events (event_type VARCHAR(50) PRIMARY KEY, event_value TEXT, expires_at TIMESTAMP)`;

                log('ğŸ‰ SETUP áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜áƒ!', 'green');
                loadPlayers();
            } catch (e) { log('Setup Error: ' + e.message, 'red'); }
        };

        get('test-db-btn').onclick = async () => {
            log('áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ...', 'white');
            try {
                const res = await sql`SELECT 1 as test`;
                const tables = await sql`SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'`;
                const tNames = tables.map(t => t.table_name);
                alert(`âœ… áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ OK!\náƒªáƒ®áƒ áƒ˜áƒšáƒ”áƒ‘áƒ˜: ${tNames.join(', ')}`);
                log('áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ', 'green');
            } catch (e) { log('DB Error', 'red'); alert('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + e.message); }
        };

    </script>
</body>

</html>