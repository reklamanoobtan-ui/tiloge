<!DOCTYPE html>
<html lang="ka">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tilo.life - Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4facfe;
            --secondary: #00f2fe;
            --accent: #ffd700;
            --danger: #ff4d4d;
            --bg: #0a0a0c;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            background: var(--bg);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- Login Section --- */
        #login-section {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #0a0a0c 0%, #1a1a2e 100%);
        }

        .login-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            padding: 50px;
            border-radius: 30px;
            border: 1px solid var(--border);
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .login-card h1 {
            font-size: 2rem;
            margin-bottom: 30px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            color: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            width: 100%;
            margin-bottom: 20px;
            outline: none;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--primary);
            background: rgba(0, 0, 0, 0.5);
        }

        /* --- Admin Layout --- */
        #admin-controls {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.02);
            border-right: 1px solid var(--border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
        }

        .sidebar-header {
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.2rem;
        }

        .nav-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-item {
            padding: 15px 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(79, 172, 254, 0.1);
            color: var(--primary);
            border: 1px solid rgba(79, 172, 254, 0.2);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 40px;
            max-width: 1200px;
        }

        .header-bar {
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-bar h2 {
            font-size: 1.8rem;
            font-weight: 800;
        }

        /* Cards & Grids */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 30px;
            transition: 0.3s;
        }

        .card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .card h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
        }

        /* Tabs Logic */
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Buttons Custom */
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
        }

        .btn-gold {
            background: var(--accent);
            color: #000;
        }

        .btn-danger {
            background: var(--danger);
            color: #fff;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: #fff;
        }

        .btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* Player List & Database */
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .players-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .site-fx-card {
            cursor: pointer;
            text-align: center;
            padding: 20px !important;
            font-weight: bold;
            font-size: 0.8rem;
            transition: 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
        }

        .site-fx-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.3);
        }

        .flex-row {
            display: flex;
            align-items: center;
        }

        .gap-5 {
            gap: 5px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .player-card.vip {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(0, 0, 0, 0) 100%);
        }

        .player-details {
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-badge {
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px 10px;
            border-radius: 8px;
            margin-right: 5px;
            margin-top: 5px;
            display: inline-block;
        }

        .stat-badge strong {
            color: var(--primary);
        }

        /* Status Toast */
        #status-msg {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border: 1px solid var(--border);
            display: none;
            animation: slideIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* UI Helpers */
        .flex-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .full-width {
            width: 100%;
        }

        select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            color: #fff;
            padding: 12px;
            border-radius: 12px;
            outline: none;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .modal {
            background: #111118;
            padding: 35px;
            border-radius: 24px;
            border: 1px solid var(--border);
            width: 90%;
            max-width: 550px;
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <!-- LOGIN SECTION -->
    <div id="login-section">
        <div class="login-card">
            <h1>🛡️ TILO ADMIN</h1>
            <input type="password" id="admin-pass" placeholder="შეიყვანეთ პაროლი">
            <button class="btn btn-primary full-width" id="login-btn">შესვლა</button>
            <p id="login-status" style="margin-top: 20px; color: var(--danger); font-size: 0.9rem;"></p>
        </div>
    </div>

    <!-- MAIN ADMIN PANEL -->
    <div id="admin-controls" style="display: none;">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">T</div>
                <h2 style="font-size: 1.2rem;">ADMIN PANEL</h2>
            </div>

            <div class="nav-items">
                <div class="nav-item active" data-tab="dashboard">📊 Dashboard</div>
                <div class="nav-item" data-tab="players">👥 მომხმარებლები</div>
                <div class="nav-item" data-tab="site">🌐 საიტის მართვა</div>
                <div class="nav-item" data-tab="bosses">👾 ბოსები</div>
                <div class="nav-item" data-tab="systems">⚙️ სისტემა</div>
                <div class="nav-item" data-tab="events">🎉 ივენთები</div>
                <div class="nav-item" data-tab="critical" style="color: var(--danger);">⚠️ კრიტიკული</div>
                <div class="nav-item" data-tab="console" style="color: #00ff00;">💻 კონსოლი</div>
            </div>

            <div style="margin-top: auto;">
                <button class="btn btn-outline full-width" onclick="location.reload()">🔒 გამოსვლა</button>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- DASHBOARD TAB -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="header-bar">
                    <h2>📊 Dashboard</h2>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <h3>⚡ სწრაფი მართვა</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.9rem;">მოთამაშის მონაცემების სწრაფი
                            ცვლილება</p>
                        <input type="text" id="target-nick" placeholder="მოთამაშის ნიკნეიმი...">
                        <div class="flex-row mt-10" style="flex-wrap: wrap;">
                            <button class="btn btn-gold" id="give-coins">🪙 +1000 Coins</button>
                            <button class="btn btn-primary" id="give-vip">👑 Grant VIP</button>
                            <button class="btn btn-danger" id="ban-user">🚫 BAN ACCOUNT</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3>💬 Broadcast Message</h3>
                        <p style="opacity: 0.6; margin-bottom: 15px; font-size: 0.9rem;">გაგზავნეთ შეტყობინება
                            ყველასთვის ჩატში</p>
                        <input type="text" id="broadcast-msg" placeholder="რა დავწეროთ?">
                        <button class="btn btn-primary full-width mt-10" id="send-broadcast">🚀 გაგზავნა</button>
                    </div>

                    <div class="card">
                        <h3>📉 აქტიური ბონუსი</h3>
                        <div id="active-bonus-timer"
                            style="display: none; background: rgba(255,215,0,0.1); padding: 20px; border-radius: 15px; border: 1px solid var(--accent);">
                            <p style="color: var(--accent); font-weight: 800; font-size: 1.1rem;" id="bonus-name">
                                Multiplier Active</p>
                            <p style="font-size: 2rem; font-weight: 800;" id="bonus-time-left">0:00</p>
                        </div>
                        <div id="no-bonus-msg" style="text-align: center; opacity: 0.3; padding: 20px;">
                            ამჟამად აქტიური ბონუსი არ არის
                        </div>
                    </div>
                </div>
            </div>

            <!-- PLAYERS TAB -->
            <div id="tab-players" class="tab-content">
                <div class="header-bar">
                    <h2>👥 მომხმარებლების ბაზა</h2>
                    <div class="flex-row">
                        <span>სულ: <strong id="total-players" style="color: var(--primary);">0</strong></span>
                        <button class="btn btn-outline" id="refresh-players">🔄 განახლება</button>
                    </div>
                </div>

                <div class="search-bar">
                    <input type="text" id="search-player" placeholder="ძებნა ნიკნეიმით ან იმეილით..."
                        style="margin-bottom: 0;">
                    <select id="sort-players">
                        <option value="newest">🆕 ახალი მოთამაშეები</option>
                        <option value="score">დაალაგე ქულებით</option>
                        <option value="coins">დაალაგე ქოინებით</option>
                        <option value="time">დაალაგე დროით</option>
                        <option value="nickname">დაალაგე ნიკნეიმით</option>
                    </select>
                </div>

                <div id="players-list" class="players-container">
                    <!-- Loaded dynamically -->
                </div>
            </div>


            <!-- SITE MANAGEMENT TAB -->
            <div id="tab-site" class="tab-content">
                <div class="header-bar">
                    <h2 style="color: #4facfe;">🌐 საიტის მართვის პანელი (20 ეფექტი)</h2>
                    <button class="btn btn-danger" onclick="stopEvent('site_effect')">🗑️ ეფექტის გათიშვა</button>
                </div>
                <div class="dashboard-grid">
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'invert', 60)">
                        <span style="font-size: 1.5rem;">🙃</span>
                        <span>Invert Colors</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'grayscale', 60)">
                        <span style="font-size: 1.5rem;">🌑</span>
                        <span>Grayscale</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'sepia', 60)">
                        <span style="font-size: 1.5rem;">📜</span>
                        <span>Retro Sepia</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'blur', 60)">
                        <span style="font-size: 1.5rem;">🌫️</span>
                        <span>Blur World</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'flicker', 60)">
                        <span style="font-size: 1.5rem;">⚡</span>
                        <span>Glitch Flicker</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'shake', 60)">
                        <span style="font-size: 1.5rem;">🫨</span>
                        <span>Screen Shake</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'mirror', 60)">
                        <span style="font-size: 1.5rem;">🪞</span>
                        <span>Mirror World</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'rotate', 60)">
                        <span style="font-size: 1.5rem;">🙃</span>
                        <span>Upside Down</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'hue', 60)">
                        <span style="font-size: 1.5rem;">🌈</span>
                        <span>Color Shift</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'matrix', 60)">
                        <span style="font-size: 1.5rem;">📟</span>
                        <span>Matrix Mode</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'vignette', 60)">
                        <span style="font-size: 1.5rem;">🎬</span>
                        <span>Cinematic</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'zoom', 60)">
                        <span style="font-size: 1.5rem;">🔍</span>
                        <span>Zoom In</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'night', 60)">
                        <span style="font-size: 1.5rem;">🌙</span>
                        <span>Night Mode</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'neon', 60)">
                        <span style="font-size: 1.5rem;">🔮</span>
                        <span>Neon Glow</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'tilt', 60)">
                        <span style="font-size: 1.5rem;">📐</span>
                        <span>Tilt Screen</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'contrast', 60)">
                        <span style="font-size: 1.5rem;">🎭</span>
                        <span>High Contrast</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'outline', 60)">
                        <span style="font-size: 1.5rem;">✏️</span>
                        <span>Outline Mode</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'hide_ui', 60)">
                        <span style="font-size: 1.5rem;">🙈</span>
                        <span>Hide Game UI</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'floating', 60)">
                        <span style="font-size: 1.5rem;">☁️</span>
                        <span>Floating Stains</span>
                    </div>
                    <div class="mini-card site-fx-card" onclick="quickTrigger('site_effect', 'disco', 60)">
                        <span style="font-size: 1.5rem;">🕺</span>
                        <span>Disco Party</span>
                    </div>
                </div>
            </div>

            <!-- BOSSES TAB -->
            <div id="tab-bosses" class="tab-content">
                <div class="header-bar">
                    <h2 style="color: #ff00ff;">👾 ბოსების მართვა</h2>
                </div>

                <!-- Regular Boss Section -->
                <div class="card"
                    style="background: rgba(255,0,255,0.05); border: 1px solid rgba(255,0,255,0.2); margin-bottom: 25px;">
                    <h3 style="color: #ff00ff; margin-bottom: 20px;">⭕ ჩვეულებრივი ბოსი</h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="mini-card">
                            <span class="mini-label">🖼️ ფოტოს URL</span>
                            <input type="text" id="reg-boss-img" class="search-input" placeholder="https://..."
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_img', 'reg-boss-img')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_img')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">📐 მასშტაბი (1.0 = Normal)</span>
                            <input type="number" id="reg-boss-scale" class="search-input" value="1.0" step="0.1"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_scale', 'reg-boss-scale')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_scale')">OFF</button>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid" style="margin-bottom: 20px;">
                        <div class="mini-card">
                            <span class="mini-label">👁️ სიმკრთალე (1-10)</span>
                            <input type="number" id="reg-boss-opacity" class="search-input" value="10" min="1" max="10"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_opacity', 'reg-boss-opacity')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_opacity')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">❤️ HP (Base) <span id="cur-reg-hp" class="cur-val"
                                    style="color:#ff00ff;"></span></span>
                            <input type="number" id="reg-boss-hp" class="search-input" value="10000"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_hp', 'reg-boss-hp')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_hp')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">⏱️ სპაუნის სიხშირე <span id="cur-reg-spawn" class="cur-val"
                                    style="color:#ff00ff;"></span></span>
                            <input type="number" id="reg-boss-spawn" class="search-input" value="60"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_spawn', 'reg-boss-spawn')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_spawn')">OFF</button>
                            </div>
                        </div>
                        <div class="mini-card">
                            <span class="mini-label">📈 გაჩენის ქულა <span id="cur-reg-thresh" class="cur-val"
                                    style="color:#ff00ff;"></span></span>
                            <input type="number" id="reg-boss-threshold" class="search-input" value="500"
                                style="width: 100%; margin-bottom: 5px;">
                            <div class="flex-row gap-5">
                                <button class="btn btn-primary" style="flex:2"
                                    onclick="quickTrigger('reg_boss_threshold', 'reg-boss-threshold')">SET</button>
                                <button class="btn btn-outline" style="flex:1"
                                    onclick="stopEvent('reg_boss_threshold')">OFF</button>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-outline full-width"
                        style="border-color: #ff00ff; color: #ff00ff; font-weight: bold; font-size: 1.1rem; padding: 15px;"
                        onclick="spawnBossNow('regular')">🚀 მყისიერი სპაუნი (SPAWN REGULAR NOW)</button>
                </div>
                <button class="btn btn-danger full-width" style="margin-top: 15px;" onclick="resetRegularBoss()">🔄
                    ყველა პარამეტრის განულება (RESET TO DEFAULT)</button>
            </div>

            <!-- Triangle Boss Section -->
            <div class="card" style="background: rgba(0,255,255,0.05); border: 1px solid rgba(0,255,255,0.2);">
                <h3 style="color: #00ffff; margin-bottom: 20px;">🔺 სამკუთხედი ბოსი (Elite)</h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div class="mini-card">
                        <span class="mini-label">🖼️ ფოტოს URL</span>
                        <input type="text" id="tri-boss-img" class="search-input" placeholder="https://..."
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('tri_boss_img', 'tri-boss-img')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('tri_boss_img')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">📐 მასშტაბი</span>
                        <input type="number" id="tri-boss-scale" class="search-input" value="1.0" step="0.1"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('tri_boss_scale', 'tri-boss-scale')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('tri_boss_scale')">OFF</button>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid" style="margin-bottom: 20px;">
                    <div class="mini-card">
                        <span class="mini-label">👁️ სიმკრთალე (1-10)</span>
                        <input type="number" id="tri-boss-opacity" class="search-input" value="10" min="1" max="10"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('tri_boss_opacity', 'tri-boss-opacity')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('tri_boss_opacity')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">❤️ HP <span id="cur-tri-hp" class="cur-val"
                                style="color:#00ffff;"></span></span>
                        <input type="number" id="tri-boss-hp" class="search-input" value="30000"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('tri_boss_hp', 'tri-boss-hp')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('tri_boss_hp')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">⏱️ სპაუნის სიხშირე <span id="cur-tri-spawn" class="cur-val"
                                style="color:#00ffff;"></span></span>
                        <input type="number" id="tri-boss-spawn" class="search-input" value="120"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('tri_boss_spawn', 'tri-boss-spawn')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('tri_boss_spawn')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">📈 გაჩენის ქულა <span id="cur-tri-thresh" class="cur-val"
                                style="color:#00ffff;"></span></span>
                        <input type="number" id="tri-boss-threshold" class="search-input" value="1000"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-primary" style="flex:2"
                                onclick="quickTrigger('tri_boss_threshold', 'tri-boss-threshold')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('tri_boss_threshold')">OFF</button>
                        </div>
                    </div>
                </div>

                <div class="card" style="background: rgba(0,255,255,0.1); margin-bottom: 0;">
                    <button class="btn btn-outline full-width"
                        style="border-color: #00ffff; color: #00ffff; font-weight: bold; font-size: 1.1rem; padding: 15px;"
                        onclick="spawnBossNow('triangle')">🚀 მყისიერი სპაუნი (SPAWN ELITE NOW)</button>
                </div>
                <button class="btn btn-danger full-width" style="margin-top: 15px;" onclick="resetTriangleBoss()">🔄
                    ყველა პარამეტრის განულება (RESET TO DEFAULT)</button>
            </div>

            <!-- Shared Enemy Settings -->
            <div class="card" style="margin-top: 25px; border-color: rgba(255, 77, 77, 0.3);">
                <h3 style="color: #ff4d4d;">☠️ საერთო მართვა (Global Enemy Settings)</h3>
                <div class="dashboard-grid" style="margin-top: 15px;">
                    <div class="mini-card">
                        <span class="mini-label">☠️ ბოსის HP <span id="cur-bosshp" class="cur-val"
                                style="color:#ff4d4d;"></span></span>
                        <input type="number" id="val-bosshp" class="search-input" value="10000"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-danger" style="flex:2"
                                onclick="quickTrigger('boss_hp', 'val-bosshp')">SET</button>
                            <button class="btn btn-outline" style="flex:1" onclick="stopEvent('boss_hp')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">⚡ გაჩენის დრო <span id="cur-spawn" class="cur-val"
                                style="color:#ff4d4d;"></span></span>
                        <input type="number" id="val-spawn" class="search-input" value="500" placeholder="Low=Fast"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-danger" style="flex:2"
                                onclick="quickTrigger('spawn_interval', 'val-spawn')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('spawn_interval')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">🔢 ბოსების ლიმიტი <span id="cur-bosslimit" class="cur-val"
                                style="color:#ff4d4d;"></span></span>
                        <input type="number" id="val-bosslimit" class="search-input" value="20"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-danger" style="flex:2"
                                onclick="quickTrigger('boss_limit', 'val-bosslimit')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('boss_limit')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card">
                        <span class="mini-label">🧹 ლაქების ლიმიტი <span id="cur-stainlimit" class="cur-val"
                                style="color:#ff4d4d;"></span></span>
                        <input type="number" id="val-stainlimit" class="search-input" value="200"
                            style="width: 100%; margin-bottom: 5px;">
                        <div class="flex-row gap-5">
                            <button class="btn btn-danger" style="flex:2"
                                onclick="quickTrigger('stain_limit', 'val-stainlimit')">SET</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('stain_limit')">OFF</button>
                        </div>
                    </div>
                    <div class="mini-card"
                        style="background: rgba(0, 255, 255, 0.1); border-color: rgba(0, 255, 255, 0.2);">
                        <span class="mini-label">❄️ მტრების გაყინვა <span id="cur-freeze" class="cur-val"
                                style="color:cyan;"></span></span>
                        <div class="flex-row gap-5" style="margin-top:28px;">
                            <button class="btn btn-primary" style="flex:2; background: rgba(0, 200, 200, 0.8);"
                                onclick="quickTrigger('freeze_enemies', '1')">ON</button>
                            <button class="btn btn-outline" style="flex:1"
                                onclick="stopEvent('freeze_enemies')">OFF</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-danger full-width" style="margin-top: 15px;" onclick="resetGlobalEnemies()">🔄
                    გლობალური პარამეტრების განულება (RESET ALL GLOBAL)</button>
            </div>

            <!-- Status Display -->
            <div class="card" style="margin-top: 25px; background: rgba(0,0,0,0.3);">
                <h3>📊 მიმდინარე სტატუსი</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div>
                        <span class="mini-label">⭕ ჩვეულებრივი ბოსი</span>
                        <p id="regular-boss-status" style="color: #ff00ff; font-weight: bold;">Default Settings</p>
                    </div>
                    <div>
                        <span class="mini-label">🔺 სამკუთხედი ბოსი</span>
                        <p id="triangle-boss-status" style="color: #00ffff; font-weight: bold;">Default Settings</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SYSTEMS TAB -->
        <div id="tab-systems" class="tab-content">
            <div class="header-bar">
                <h2>⚙️ სისტემური მართვა</h2>
            </div>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>🧹 მონაცემების გასუფთავება</h3>
                    <p style="opacity: 0.6; margin-bottom: 20px;">ამ მოქმედების გაუქმება შეუძლებელია!</p>
                    <button class="btn btn-danger full-width" id="reset-lb">⚠ RESET LEADERBOARD ⚠</button>
                </div>
                <div class="card">
                    <h3>📡 კავშირის ტესტი</h3>
                    <p style="opacity: 0.6; margin-bottom: 20px;">შეამოწმეთ Database-თან კავშირი და ცხრილების
                        მდგომარეობა</p>
                    <button class="btn btn-outline full-width" id="test-db-btn">🔍 DATABASE TEST</button>
                </div>
            </div>
        </div>

        <!-- EVENTS TAB -->
        <div id="tab-events" class="tab-content">
            <div class="header-bar">
                <h2>🎉 Global Events Management</h2>
            </div>
            <style>
                .dashboard-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 15px;
                }

                .mini-card {
                    padding: 15px;
                    background: rgba(255, 255, 255, 0.05);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 10px;
                }

                .mini-label {
                    display: block;
                    font-size: 0.8rem;
                    opacity: 0.7;
                    margin-bottom: 5px;
                }
            </style>

            <div class="card" style="margin-bottom: 25px; background: rgba(0,0,0,0.3);">
                <h3>🌍 გლობალური მართვის პანელი</h3>

                <div
                    style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; display: flex; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label>⏱️ ხანგრძლივობა (წთ):</label>
                        <input type="number" id="global-duration" class="search-input" value="10"
                            style="width: 70px; text-align: center; padding: 5px;">
                    </div>

                    <div
                        style="display: flex; align-items: center; gap: 8px; border-left: 1px solid rgba(255,255,255,0.1); padding-left: 15px;">
                        <label>📈 გაძლიერების ზრდა:</label>
                        <input type="number" id="val-upgrade-factor" class="search-input" value="1.3" step="0.1"
                            style="width: 70px; text-align: center; padding: 5px;">
                        <button class="btn btn-primary" style="padding: 5px 12px;"
                            onclick="quickTrigger('upgrade_config', 'val-upgrade-factor', 1440)">SET</button>
                        <button class="btn btn-outline" style="padding: 5px 12px;"
                            onclick="stopEvent('upgrade_config')">OFF</button>
                    </div>
                </div>
            </div>

            <!-- Player & Economy -->
            <h4
                style="margin: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; color: #ffd700;">
                👤 მოთამაშე & ეკონომიკა</h4>
            <div class="dashboard-grid">
                <div class="mini-card">
                    <span class="mini-label">💪 ძალა <span id="cur-strength" class="cur-val"
                            style="color:#4facfe;"></span></span>
                    <input type="number" id="val-strength" class="search-input" value="2"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('player_strength', 'val-strength')">SET</button>
                        <button class="btn btn-outline" style="flex:1"
                            onclick="stopEvent('player_strength')">OFF</button>
                    </div>
                </div>
                <div class="mini-card">
                    <span class="mini-label">📏 რადიუსი <span id="cur-radius" class="cur-val"
                            style="color:#4facfe;"></span></span>
                    <input type="number" id="val-radius" class="search-input" value="2"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('player_radius', 'val-radius')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('player_radius')">OFF</button>
                    </div>
                </div>
                <div class="mini-card">
                    <span class="mini-label">💰 ქოინები <span id="cur-coin" class="cur-val"
                            style="color:#ffd700;"></span></span>
                    <input type="number" id="val-coin" class="search-input" value="2"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-gold" style="flex:2"
                            onclick="quickTrigger('coin_mult', 'val-coin')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('coin_mult')">OFF</button>
                    </div>
                </div>
                <div class="mini-card">
                    <span class="mini-label">🌍 ქულები <span id="cur-score" class="cur-val"
                            style="color:#ffd700;"></span></span>
                    <input type="number" id="val-score" class="search-input" value="2"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-gold" style="flex:2"
                            onclick="quickTrigger('multiplier', 'val-score')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('multiplier')">OFF</button>
                    </div>
                </div>
            </div>

            <!-- Logic -->
            <h4
                style="margin: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; color: #4facfe;">
                🎮 ლოგიკა & ივენთები</h4>
            <div class="dashboard-grid">
                <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                    <span class="mini-label">⚠️ კრიზისის დრო <span id="cur-crisis" class="cur-val"
                            style="color:orange;"></span></span>
                    <input type="number" id="val-crisis" class="search-input" value="10"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('crisis_time', 'val-crisis')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('crisis_time')">OFF</button>
                    </div>
                </div>
                <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                    <span class="mini-label">🧼 საპნის სიხშირე <span id="cur-soap" class="cur-val"
                            style="color:#ff69b4;"></span></span>
                    <input type="number" id="val-soap" class="search-input" value="1000" placeholder="Score"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('soap_thresh', 'val-soap')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('soap_thresh')">OFF</button>
                    </div>
                </div>
                <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                    <span class="mini-label">🎮 მინი-თამაში <span id="cur-minigame" class="cur-val"
                            style="color:#4facfe;"></span></span>
                    <input type="number" id="val-minigame" class="search-input" value="1500" placeholder="Score"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('minigame_thresh', 'val-minigame')">SET</button>
                        <button class="btn btn-outline" style="flex:1"
                            onclick="stopEvent('minigame_thresh')">OFF</button>
                    </div>
                </div>
                <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                    <span class="mini-label">🧼 Cutscene <span id="cur-cutscene" class="cur-val"
                            style="color:#ff69b4;"></span></span>
                    <input type="number" id="val-cutscene" class="search-input" value="1500" placeholder="ms"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('soap_cutscene', 'val-cutscene')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('soap_cutscene')">OFF</button>
                    </div>
                </div>
                <div class="mini-card" style="background: rgba(0, 255, 0, 0.1); border-color: rgba(0, 255, 0, 0.2);">
                    <span class="mini-label">🛡️ უკვდავება (God Mode) <span id="cur-god" class="cur-val"
                            style="color:lime;"></span></span>
                    <div class="flex-row gap-5" style="margin-top:28px;">
                        <button class="btn btn-primary" style="flex:2; background: rgba(0, 200, 0, 0.8);"
                            onclick="quickTrigger('god_mode', '1')">ON</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('god_mode')">OFF</button>
                    </div>
                </div>
                <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                    <span class="mini-label">⚡ გაძლიერების ძალა (Default 1.3) <span id="cur-upgpow" class="cur-val"
                            style="color:gold;"></span></span>
                    <input type="number" id="val-upgpow" class="search-input" value="1.3" step="0.1"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('upgrade_power', 'val-upgpow')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('upgrade_power')">OFF</button>
                    </div>
                </div>
                <div class="mini-card" style="border-color: rgba(79, 172, 254, 0.3);">
                    <span class="mini-label">🌸 Pink გაძლიერება (Default 1.5) <span id="cur-pinkpow" class="cur-val"
                            style="color:#ff69b4;"></span></span>
                    <input type="number" id="val-pinkpow" class="search-input" value="1.5" step="0.1"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('pink_power', 'val-pinkpow')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('pink_power')">OFF</button>
                    </div>
                </div>
            </div>

            <!-- YouTube Notifier Multi-Channel -->
            <h4
                style="margin: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px; color: #ff0000; display: flex; align-items: center; gap: 10px;">
                📺 YouTube Multi-Channel Notifier
                <span
                    style="font-size: 0.7rem; background: #333; color: #fff; padding: 2px 8px; border-radius: 4px;">LIMIT:
                    5</span>
            </h4>
            <div class="card" style="background: rgba(0,0,0,0.2); border: 1px solid rgba(255,0,0,0.1); padding: 15px;">
                <div id="channel-config-list">
                    <!-- JS will populate or we can hardcode 5 slots -->
                    <div
                        style="display: grid; grid-template-columns: 3fr 1fr; gap: 10px; margin-bottom: 15px; background: rgba(255,255,255,0.02); padding: 10px; border-radius: 8px;">
                        <div style="font-size: 0.7rem; opacity: 0.5;">Channel ID / User</div>
                        <div style="font-size: 0.7rem; opacity: 0.5;">Weight (0-100)</div>

                        <input type="text" id="ch-id-1" class="search-input" placeholder="UCycgfC-1XTtOeMLr5Vz..."
                            style="width: 100%;">
                        <input type="number" id="ch-wt-1" class="search-input" value="100" style="width: 100%;">

                        <input type="text" id="ch-id-2" class="search-input" placeholder="Channel 2"
                            style="width: 100%;">
                        <input type="number" id="ch-wt-2" class="search-input" value="0" style="width: 100%;">

                        <input type="text" id="ch-id-3" class="search-input" placeholder="Channel 3"
                            style="width: 100%;">
                        <input type="number" id="ch-wt-3" class="search-input" value="0" style="width: 100%;">

                        <input type="text" id="ch-id-4" class="search-input" placeholder="Channel 4"
                            style="width: 100%;">
                        <input type="number" id="ch-wt-4" class="search-input" value="0" style="width: 100%;">

                        <input type="text" id="ch-id-5" class="search-input" placeholder="Channel 5"
                            style="width: 100%;">
                        <input type="number" id="ch-wt-5" class="search-input" value="0" style="width: 100%;">
                    </div>
                </div>
                <button class="btn btn-danger full-width" onclick="saveVideoConfig()">🚀 UPDATE MULTI-CHANNEL
                    CONFIG</button>

                <div
                    style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 1px dashed rgba(255, 0, 0, 0.3);">
                    <span class="mini-label">🎯 კონკრეტული ვიდეოს ლინკი (პრიორიტეტი) <span id="cur-forced-video"
                            class="cur-val" style="color: lime;"></span></span>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="val-forced-video" class="search-input"
                            placeholder="https://www.youtube.com/watch?v=..." style="flex: 3;">
                        <button class="btn btn-gold" style="flex: 1;" onclick="saveForcedVideo()">SET
                            VIDEO</button>
                    </div>
                    <button class="btn btn-outline full-width" onclick="stopEvent('forced_video')">გათიშვა (BACK
                        TO
                        CHANNELS)</button>
                </div>
            </div>

            <div class="dashboard-grid mt-10">
                <div class="mini-card" style="border-color: rgba(255, 0, 0, 0.3);">
                    <span class="mini-label">⏱️ Timings (csv) <span id="cur-timings" class="cur-val"
                            style="color:orange;"></span></span>
                    <input type="text" id="val-timings" class="search-input" value="10,30,60,300"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('video_timings', 'val-timings')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('video_timings')">OFF</button>
                    </div>
                </div>
                <div class="mini-card" style="border-color: rgba(255, 0, 0, 0.3);">
                    <span class="mini-label">🔄 Loop (sec) <span id="cur-loop" class="cur-val"
                            style="color:cyan;"></span></span>
                    <input type="number" id="val-loop" class="search-input" value="300"
                        style="width: 100%; margin-bottom: 5px;">
                    <div class="flex-row gap-5">
                        <button class="btn btn-primary" style="flex:2"
                            onclick="quickTrigger('video_loop', 'val-loop')">SET</button>
                        <button class="btn btn-outline" style="flex:1" onclick="stopEvent('video_loop')">OFF</button>
                    </div>
                </div>
            </div>

            <button class="btn btn-danger full-width mt-20" id="stop-events"
                style="opacity: 0.9; padding: 15px; font-size: 1.1rem;">🛑 ყველა ცვლილების გაუქმება
                (RESET)</button>
        </div>
    </div>

    <!-- CRITICAL TAB -->
    <div id="tab-critical" class="tab-content">
        <div class="header-bar">
            <h2 style="color: var(--danger);">⚠️ კრიტიკული მოქმედებები</h2>
        </div>
        <div class="dashboard-grid">
            <div class="card" style="border-color: var(--accent);">
                <h3 style="color: var(--accent);">🚀 DATABASE SETUP</h3>
                <p style="opacity: 0.6; margin-bottom: 20px;">ახალი Database-ის გამართვა და ცხრილების შექმნა ერთ
                    კლიკში.</p>
                <button class="btn btn-gold full-width" id="run-setup-btn">RUN SETUP SCRIPT</button>
            </div>
            <div class="card" style="border-color: var(--danger);">
                <h3 style="color: var(--danger);">🔥 SITE RESTART</h3>
                <p style="opacity: 0.6; margin-bottom: 20px;">ყველა მოთამაშის გვერდის გადატვირთვა და სესიების
                    გაწყვეტა.</p>
                <button class="btn btn-danger full-width" id="restart-site">RESTART NOW</button>
            </div>
            <div class="card" style="border-color: var(--danger); background: rgba(255, 77, 77, 0.05);">
                <h3 style="color: var(--danger);">🧹 WIPE DATA</h3>
                <p style="opacity: 0.6; margin-bottom: 20px;">პროგრესის ან მთლიანი ბაზის გასუფთავება.</p>
                <button class="btn btn-danger full-width" id="wipe-progress-btn" style="margin-bottom: 10px;">RESET
                    PROGRESS (Keep Accounts)</button>
                <button class="btn btn-danger full-width" id="full-wipe-btn"
                    style="background: #ff0000; border: 2px solid white;">🔥 FULL RESET (Delete All
                    Accounts)</button>
            </div>
        </div>
    </div>

    <!-- CONSOLE TAB -->
    <div id="tab-console" class="tab-content">
        <div class="header-bar">
            <h2>💻 სისტემური კონსოლი</h2>
            <button class="btn btn-danger" onclick="clearConsole()">🗑️ გასუფთავება</button>
        </div>
        <div id="console-output"
            style="background: #1e1e1e; color: #d4d4d4; padding: 15px; height: 500px; overflow-y: scroll; font-family: 'Courier New', monospace; border-radius: 10px; border: 1px solid #333; font-size: 0.9rem;">
            <div style="color: #6a9955;">[INFO] სისტემა მზადაა...</div>
        </div>
    </div>
    </div>
    </div>

    <!-- Status Messages -->
    <div id="status-msg"></div>

    <!-- Edit User Modal -->
    <div id="edit-user-modal" class="modal-overlay hidden">
        <div class="modal">
            <h2 style="margin-bottom: 20px;">✏️ მომხმარებლის რედაქტირება</h2>
            <div class="mini-card" style="margin-bottom: 10px;">
                <span class="mini-label">ნიკნეიმი</span>
                <input type="text" id="edit-user-nick" class="search-input" style="width: 100%;">
            </div>
            <div class="mini-card" style="margin-bottom: 10px;">
                <span class="mini-label">იმეილი (არ იცვლება)</span>
                <input type="text" id="edit-user-email" class="search-input" style="width: 100%; opacity: 0.5;"
                    readonly>
            </div>
            <div class="dashboard-grid" style="margin-bottom: 15px;">
                <div class="mini-card">
                    <span class="mini-label">⭐ ქულა</span>
                    <input type="number" id="edit-user-score" class="search-input" style="width: 100%;">
                </div>
                <div class="mini-card">
                    <span class="mini-label">🪙 ბალანსი</span>
                    <input type="number" id="edit-user-coins" class="search-input" style="width: 100%;">
                </div>
                <div class="mini-card">
                    <span class="mini-label">💰 სულ ქოინები</span>
                    <input type="number" id="edit-user-total-coins" class="search-input" style="width: 100%;">
                </div>
                <div class="mini-card">
                    <span class="mini-label">👑 VIP</span>
                    <div style="margin-top: 5px;">
                        <input type="checkbox" id="edit-user-vip" style="width: 25px; height: 25px;">
                    </div>
                </div>
            </div>
            <div class="flex-row gap-10">
                <button class="btn btn-primary" style="flex: 2" onclick="saveUserEdit()">შენახვა</button>
                <button class="btn btn-outline" style="flex: 1"
                    onclick="get('edit-user-modal').classList.add('hidden')">გაუქმება</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { neon } from 'https://cdn.jsdelivr.net/npm/@neondatabase/serverless@0.9.4/+esm';
        const sql = neon("postgresql://neondb_owner:npg_NBPsUe3FXb4o@ep-calm-wildflower-aim8iczt-pooler.c-4.us-east-1.aws.neon.tech/neondb?sslmode=require");

        const get = (id) => document.getElementById(id);
        const status = get('status-msg');

        function log(msg, color = 'var(--primary)') {
            status.textContent = msg;
            status.style.display = 'block';
            status.style.borderLeft = `5px solid ${color}`;
            setTimeout(() => {
                status.style.display = 'none';
            }, 4000);
        }

        // --- Tabs Logic ---
        document.querySelectorAll('.nav-item').forEach(item => {
            item.onclick = () => {
                const target = item.dataset.tab;

                // Update nav
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                // Update content
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                get(`tab-${target}`).classList.add('active');

                // Auto-load if entering tab
                if (target === 'players') loadPlayers();
            };
        });

        // Console Logic
        async function updateConsole() {
            try {
                const logs = await sql`SELECT * FROM chat_messages WHERE nickname = 'SYSTEM_LOG' ORDER BY created_at DESC LIMIT 50`;
                const output = get('console-output');
                if (!output) return;
                output.innerHTML = '';
                logs.forEach(log => {
                    const parts = log.message.split('|');
                    let level = 'INFO';
                    let msg = log.message;
                    if (parts.length > 1) { level = parts[0]; msg = parts.slice(1).join('|'); }

                    let color = '#d4d4d4';
                    if (level === 'ERROR') color = '#f44336';
                    if (level === 'WARN') color = '#ff9800';
                    if (level === 'SUCCESS') color = '#4caf50';

                    const time = new Date(log.created_at).toLocaleTimeString();
                    const line = document.createElement('div');
                    line.style.borderBottom = '1px solid #333';
                    line.style.padding = '4px 0';
                    line.innerHTML = `<span style="color: #666;">[${time}]</span> <span style="font-weight:bold; color:${color}">[${level}]</span> ${msg}`;
                    output.appendChild(line);
                });
            } catch (e) { }
        }

        window.clearConsole = async () => {
            if (confirm('წავშალოთ ლოგები?')) {
                try { await sql`DELETE FROM chat_messages WHERE nickname = 'SYSTEM_LOG'`; updateConsole(); } catch (e) { }
            }
        };
        setInterval(() => { if (get('tab-console')?.classList.contains('active')) updateConsole(); }, 3000);

        // Auth Logic
        const loginBtn = get('login-btn');
        if (loginBtn) {
            loginBtn.onclick = async () => {
                const passInput = get('admin-pass');
                const pass = passInput ? passInput.value.trim() : '';
                const loginStatus = get('login-status');

                if (!pass) return;
                if (loginStatus) loginStatus.textContent = "ამოწმებს...";

                console.log("Admin Login Attempt...");

                // The password is: unoobi123!123!
                if (pass === "unoobi123!123!") {
                    get('login-section').style.display = 'none';
                    get('admin-controls').style.display = 'flex';
                    log('მოგესალმებით, ადმინ!', 'var(--primary)');
                    if (typeof updateDashboardStats === 'function') updateDashboardStats();
                    loadPlayers(); // Load players immediately
                } else {
                    if (loginStatus) {
                        loginStatus.textContent = "პაროლი არასწორია!";
                        loginStatus.style.color = "var(--danger)";
                    }
                    console.warn("Invalid admin password attempt.");
                }
            };
        }

        get('give-coins').onclick = async () => {
            const name = get('target-nick').value.trim();
            if (!name) return;
            try {
                await sql`UPDATE users SET coins = coins + 1000 WHERE nickname = ${name}`;
                log(`Sent 1000 coins to ${name}`);
            } catch (e) { log('Error updating database', 'red'); }
        };

        get('give-vip').onclick = async () => {
            const name = get('target-nick').value.trim();
            if (!name) return;
            try {
                await sql`UPDATE users SET is_vip = true WHERE nickname = ${name}`;
                log(`Given VIP to ${name}`);
            } catch (e) { log('Error updating database', 'red'); }
        };

        get('ban-user').onclick = async () => {
            const name = get('target-nick').value.trim();
            if (!name) return;
            if (confirm(`Are you sure you want to BAN ${name}?`)) {
                try {
                    await sql`UPDATE users SET score = 0, survival_time = 0, coins = 0, is_vip = false, best_score = 0 WHERE nickname = ${name}`;
                    log(`Banned/Reset ${name}`, 'red');
                } catch (e) { log('Error updating database', 'red'); }
            }
        };

        get('reset-lb').onclick = async () => {
            if (confirm("RESET ENTIRE LEADERBOARD?")) {
                try {
                    await sql`UPDATE users SET score = 0, survival_time = 0`;
                    log("Leaderboard Reset!", 'red');
                } catch (e) { log('Error', 'red'); }
            }
        };

        get('send-broadcast').onclick = async () => {
            const msg = get('broadcast-msg').value.trim();
            if (!msg) return;
            try {
                // Send as Chat Message
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('📢 SYSTEM', ${msg})`;

                // Send as Central Alert (Info Event)
                // Duration: 2s per word, min 5s -> Converted to minutes for triggerEvent (0.1 min = 6s)
                const wordCount = msg.split(/\s+/).length;
                const durMin = Math.max(0.1, (wordCount * 2) / 60);

                triggerEvent('info', msg, durMin);

                get('broadcast-msg').value = '';
                log("Broadcast & Central Alert sent!");
            } catch (e) { log('Error', 'red'); }
        };

        const triggerEvent = async (type, val, duration) => {
            try {
                const expireDate = new Date(Date.now() + duration * 60000);
                await sql`DELETE FROM global_events WHERE event_type = ${type}`;
                await sql`INSERT INTO global_events (event_type, event_value, expires_at) 
                          VALUES (${type}, ${val.toString()}, ${expireDate.toISOString()})`;

                let msg = `Global Event Active!`;
                if (type === 'multiplier') msg = `🌍 გლობალური ${val}X ქულების ბუსტი!`;
                else if (type === 'crisis_time') msg = `⚠️ კრიზისის დრო: ${val} წამი`;
                else if (type === 'spawn_interval') msg = `⚡ გაჩენის სიჩქარე: ${val}ms`;
                else if (type === 'boss_limit') msg = `☠️ ბოსების ლიმიტი: ${val}`;
                else if (type === 'stain_limit') msg = `🧹 ლაქების ლიმიტი: ${val}`;
                else if (type === 'rainbow') msg = `🌈 RAINBOW რეჟიმი ჩაირთო!`;
                else if (type === 'player_strength') msg = `💪 მოთამაშის ძალა: ${val}X`;
                else if (type === 'player_radius') msg = `📏 მოთამაშის რადიუსი: ${val}X`;
                else if (type === 'coin_mult') msg = `💰 ქოინების მამრავლი: ${val}X`;
                else if (type === 'boss_hp') msg = `☠️ ბოსის HP: ${val}`;
                else if (type === 'soap_thresh') msg = `🧼 საპნის სიხშირე: ყოველ ${val} ქულაზე`;
                else if (type === 'minigame_thresh') msg = `🎮 მინი-თამაში: ყოველ ${val} ქულაზე`;
                else if (type === 'soap_cutscene') msg = `🧼 საპნის დრო: ${val}ms`;
                else if (type === 'video_config') msg = `📺 YouTube Notifier განახლდა!`;
                else if (type === 'boss_spawn_rate') msg = `⏱️ ბოსების გაჩენის დრო: ყოველ ${val} წამში`;
                else if (type === 'upgrade_power') msg = `⚡ გაძლიერებების ძალა: ${val}X`;
                else if (type === 'pink_power') msg = `🌸 Pink გაძლიერების ძალა: ${val}X`;
                else if (type === 'regular_boss_config') msg = `⭕ ჩვეულებრივი ბოსი განახლდა!`;
                else if (type === 'triangle_boss_config') msg = `🔺 სამკუთხედი ბოსი განახლდა!`;
                else if (type === 'reg_boss_img') msg = `🖼️ ჩვეულებრივი ბოსის ფოტო შეიცვალა`;
                else if (type === 'reg_boss_scale') msg = `📐 ჩვეულებრივი ბოსის მასშტაბი: ${val}`;
                else if (type === 'reg_boss_opacity') msg = `👁️ ჩვეულებრივი ბოსის სიმკრთალე: ${val}`;
                else if (type === 'reg_boss_hp') msg = `❤️ ჩვეულებრივი ბოსის HP: ${val}`;
                else if (type === 'reg_boss_spawn') msg = `⏱️ ჩვეულებრივი ბოსის სპაუნი: ${val}წმ`;
                else if (type === 'reg_boss_threshold') msg = `📈 ჩვეულებრივი ბოსის ქულა: ${val}`;
                else if (type === 'tri_boss_img') msg = `🖼️ Elite ბოსის ფოტო შეიცვალა`;
                else if (type === 'tri_boss_scale') msg = `📐 Elite ბოსის მასშტაბი: ${val}`;
                else if (type === 'tri_boss_opacity') msg = `👁️ Elite ბოსის სიმკრთალე: ${val}`;
                else if (type === 'tri_boss_hp') msg = `❤️ Elite ბოსის HP: ${val}`;
                else if (type === 'tri_boss_spawn') msg = `⏱️ Elite ბოსის სპაუნი: ${val}წმ`;
                else if (type === 'tri_boss_threshold') msg = `📈 Elite ბოსის ქულა: ${val}`;
                else if (type === 'spawn_now') msg = `🚀 მყისიერი ბოსის გაჩენა: ${val.toUpperCase()}!`;

                msg += ` (${duration} წთ) ✨`;

                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('📢 SYSTEM', ${msg})`;
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('SYSTEM_LOG', ${'INFO|Event: ' + type + ' = ' + val})`;
                log(`გააქტიურდა: ${type} (${val}) - ${duration} წთ`);
                updateBonusTimer();
            } catch (e) { console.error(e); log('Error triggering event', 'red'); }
        };

        const updateDashboardStatus = async () => {
            try {
                const events = await sql`SELECT * FROM global_events WHERE expires_at > NOW()`;
                document.querySelectorAll('.cur-val').forEach(el => el.textContent = '');

                events.forEach(ev => {
                    if (ev.event_type === 'player_strength') get('cur-strength').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'player_radius') get('cur-radius').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'coin_mult') get('cur-coin').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'multiplier') get('cur-score').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'boss_hp') get('cur-bosshp').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'boss_limit') get('cur-bosslimit').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'stain_limit') get('cur-stainlimit').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'spawn_interval') get('cur-spawn').textContent = `(${ev.event_value}ms)`;
                    if (ev.event_type === 'crisis_time') get('cur-crisis').textContent = `(${ev.event_value}s)`;
                    if (ev.event_type === 'soap_thresh') get('cur-soap').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'minigame_thresh') get('cur-minigame').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'soap_cutscene') get('cur-cutscene').textContent = `(${ev.event_value}ms)`;
                    if (ev.event_type === 'god_mode') get('cur-god').textContent = `(ON)`;
                    if (ev.event_type === 'freeze_enemies') get('cur-freeze').textContent = `(ON)`;
                    if (ev.event_type === 'video_config') {
                        try {
                            const cfg = JSON.parse(ev.event_value);
                            cfg.forEach((item, idx) => {
                                if (idx < 5) {
                                    const id = get(`ch-id-${idx + 1}`);
                                    const wt = get(`ch-wt-${idx + 1}`);
                                    if (id && !id.value) id.value = item.id;
                                    if (wt && wt.value == "0") wt.value = item.weight;
                                }
                            });
                        } catch (e) { }
                    }
                    if (ev.event_type === 'video_channel') get('cur-channel').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'video_timings') get('cur-timings').textContent = `(${ev.event_value})`;
                    if (ev.event_type === 'video_loop') get('cur-loop').textContent = `(${ev.event_value}s)`;
                    if (ev.event_type === 'boss_config') get('cur-boss-config').textContent = `(ACTIVE)`;
                    if (ev.event_type === 'forced_video') get('cur-forced-video').textContent = `(ACTIVE)`;
                    if (ev.event_type === 'boss_spawn_rate') get('cur-bossrate').textContent = `(${ev.event_value}s)`;
                    if (ev.event_type === 'upgrade_power') get('cur-upgpow').textContent = `(${ev.event_value}X)`;
                    if (ev.event_type === 'pink_power') get('cur-pinkpow').textContent = `(${ev.event_value}X)`;

                    // Individual Boss Stats
                    if (ev.event_type === 'reg_boss_hp') get('cur-reg-hp')?.textContent ? get('cur-reg-hp').textContent = `(${ev.event_value})` : null;
                    if (ev.event_type === 'reg_boss_spawn') get('cur-reg-spawn')?.textContent ? get('cur-reg-spawn').textContent = `(${ev.event_value}s)` : null;
                    if (ev.event_type === 'reg_boss_threshold') get('cur-reg-thresh')?.textContent ? get('cur-reg-thresh').textContent = `(${ev.event_value})` : null;

                    if (ev.event_type === 'tri_boss_hp') get('cur-tri-hp')?.textContent ? get('cur-tri-hp').textContent = `(${ev.event_value})` : null;
                    if (ev.event_type === 'tri_boss_spawn') get('cur-tri-spawn')?.textContent ? get('cur-tri-spawn').textContent = `(${ev.event_value}s)` : null;
                    if (ev.event_type === 'tri_boss_threshold') get('cur-tri-thresh')?.textContent ? get('cur-tri-thresh').textContent = `(${ev.event_value})` : null;
                });
            } catch (e) { }
        };
        setInterval(updateDashboardStatus, 5000);
        updateDashboardStatus();

        window.quickTrigger = (type, inputId, customDur = null) => {
            const val = inputId === '1' ? '1' : (get(inputId)?.value || inputId);
            const dur = customDur || parseInt(get('global-duration').value) || 10;
            triggerEvent(type, val, dur);
        };

        window.stopEvent = async (type) => {
            if (!confirm(`ნამდვილად გსურთ ${type}-ის გაუქმება?`)) return;
            try {
                await sql`DELETE FROM global_events WHERE event_type = ${type}`;
                log(`🛑 ${type} გაუქმდა`, 'orange');
                updateBonusTimer();
                updateDashboardStatus();
            } catch (e) { log('Error', 'red'); }
        };

        window.saveVideoConfig = async () => {
            let config = [];
            for (let i = 1; i <= 5; i++) {
                let id = get(`ch-id-${i}`).value.trim();
                let wt = parseInt(get(`ch-wt-${i}`).value) || 0;
                if (id) config.push({ id, weight: wt });
            }
            if (config.length === 0) { alert('მიუთითეთ მინიმუმ 1 არხი'); return; }
            const val = JSON.stringify(config);
            const dur = parseInt(get('global-duration').value) || 120;
            triggerEvent('video_config', val, dur);
        };

        window.saveBossConfig = async () => {
            const img = get('boss-img-url').value.trim();
            const scale = get('boss-scale').value || "1.0";
            const dur = parseInt(get('global-duration').value) || 60;
            const config = { img, scale, opacity: get('boss-opacity').value || "10", triangleHP: get('triangle-boss-hp').value || "30000" };
            triggerEvent('boss_config', JSON.stringify(config), dur);
        };

        // Regular Boss Functions
        window.saveRegularBoss = async () => {
            const img = get('regular-boss-img').value.trim();
            const scale = get('regular-boss-scale').value || "1.0";
            const opacity = get('regular-boss-opacity').value || "10";
            const hp = get('regular-boss-hp').value || "10000";
            const spawn = get('regular-boss-spawn').value || "60";
            const threshold = get('regular-boss-threshold').value || "500";
            const dur = parseInt(get('global-duration').value) || 60;
            const config = { img, scale, opacity, hp, spawn, threshold };
            await triggerEvent('regular_boss_config', JSON.stringify(config), dur);
            get('regular-boss-status').textContent = `Active (HP: ${hp}, Spawn: ${spawn}s, Threshold: ${threshold})`;
            log('✅ ჩვეულებრივი ბოსი განახლდა', 'green');
        };

        window.resetRegularBoss = async () => {
            if (!confirm('ნამდვილად გსურთ ჩვეულებრივი ბოსის ყველა პარამეტრის განულება?')) return;
            try {
                const types = ['reg_boss_img', 'reg_boss_scale', 'reg_boss_opacity', 'reg_boss_hp', 'reg_boss_spawn', 'reg_boss_threshold'];
                for (const t of types) {
                    await sql`DELETE FROM global_events WHERE event_type = ${t}`;
                }

                get('reg-boss-img').value = '';
                get('reg-boss-scale').value = '1.0';
                get('reg-boss-opacity').value = '10';
                get('reg-boss-hp').value = '10000';
                get('reg-boss-spawn').value = '60';
                get('reg-boss-threshold').value = '500';

                log('🔄 ჩვეულებრივი ბოსის პარამეტრები განულდა', 'orange');
                updateDashboardStatus();
            } catch (e) { log('Error resetting boss', 'red'); }
        };

        // Triangle Boss Functions
        window.saveTriangleBoss = async () => {
            const img = get('triangle-boss-img').value.trim();
            const scale = get('triangle-boss-scale').value || "1.0";
            const opacity = get('triangle-boss-opacity').value || "10";
            const hp = get('triangle-boss-hp-input').value || "30000";
            const spawn = get('triangle-boss-spawn').value || "120";
            const threshold = get('triangle-boss-threshold').value || "1000";
            const dur = parseInt(get('global-duration').value) || 60;
            const config = { img, scale, opacity, hp, spawn, threshold };
            await triggerEvent('triangle_boss_config', JSON.stringify(config), dur);
            get('triangle-boss-status').textContent = `Active (HP: ${hp}, Spawn: ${spawn}s, Threshold: ${threshold})`;
            log('✅ სამკუთხედი ბოსი განახლდა', 'cyan');
        };

        window.resetTriangleBoss = async () => {
            if (!confirm('ნამდვილად გსურთ სამკუთხედი ბოსის ყველა პარამეტრის განულება?')) return;
            try {
                const types = ['tri_boss_img', 'tri_boss_scale', 'tri_boss_opacity', 'tri_boss_hp', 'tri_boss_spawn', 'tri_boss_threshold'];
                for (const t of types) {
                    await sql`DELETE FROM global_events WHERE event_type = ${t}`;
                }

                get('tri-boss-img').value = '';
                get('tri-boss-scale').value = '1.0';
                get('tri-boss-opacity').value = '10';
                get('tri-boss-hp').value = '30000';
                get('tri-boss-spawn').value = '120';
                get('tri-boss-threshold').value = '1000';

                log('🔄 სამკუთხედი ბოსის პარამეტრები განულდა', 'orange');
                updateDashboardStatus();
            } catch (e) { log('Error resetting boss', 'red'); }
        };

        window.resetGlobalEnemies = async () => {
            if (!confirm('ნამდვილად გსურთ გლობალური პარამეტრების განულება?')) return;
            try {
                const types = ['boss_hp', 'spawn_interval', 'boss_limit', 'stain_limit'];
                for (const t of types) {
                    await sql`DELETE FROM global_events WHERE event_type = ${t}`;
                }

                get('val-bosshp').value = '10000';
                get('val-spawn').value = '500';
                get('val-bosslimit').value = '20';
                get('val-stainlimit').value = '200';

                log('🔄 გლობალური პარამეტრები განულდა', 'orange');
                updateDashboardStatus();
            } catch (e) { log('Error resetting global settings', 'red'); }
        };

        window.spawnBossNow = async (type) => {
            // Type is 'regular' or 'triangle'
            // Trigger a very short event that clients will pick up
            await triggerEvent('spawn_now', type, 1); // Only active for 1 minute
            log(`🚀 მყისიერი სპაუნი: ${type.toUpperCase()}`, 'yellow');
        };

        window.saveForcedVideo = async () => {
            const url = get('val-forced-video').value.trim();
            if (!url) return alert("შეიყვანეთ ლინკი");

            let videoId = '';
            try {
                if (url.includes('v=')) videoId = url.split('v=')[1].split('&')[0];
                else if (url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1].split('?')[0];
                else videoId = url; // assume raw ID
            } catch (e) { return alert("არასწორი ლინკი"); }

            if (!videoId) return alert("ID ვერ მოიძებნა");

            const dur = parseInt(get('global-duration').value) || 60;
            const config = { id: videoId, link: url };
            triggerEvent('forced_video', JSON.stringify(config), dur);
        };

        get('stop-events').onclick = async () => {
            if (!confirm('ნამდვილად გსურთ ყველა ივენთის გაუქმება?')) return;
            try {
                await sql`DELETE FROM global_events`;
                log('🛑 ყველა ივენთი გაუქმდა', 'orange');
                updateBonusTimer();
            } catch (e) { log('Error', 'red'); }
        };

        get('restart-site').onclick = async () => {
            if (confirm("⚠️ ნამდვილად გსურთ მთელი საიტის რესტარტი? ყველა მოთამაშე გადატვირთულ იქნება!")) {
                try {
                    await sql`DELETE FROM global_events`;
                    await sql`INSERT INTO chat_messages (nickname, message) VALUES ('📢 SYSTEM', '🔄 საიტი რესტარტდება 5 წამში...')`;
                    log("Restarting site in 5 seconds...", 'red');
                    localStorage.setItem('tilo_force_reload', Date.now().toString());
                    setTimeout(() => { window.location.reload(); }, 5000);
                } catch (e) { console.error(e); log('Error restarting site', 'red'); }
            }
        };

        async function updateBonusTimer() {
            try {
                const events = await sql`SELECT event_type, event_value, expires_at FROM global_events WHERE expires_at > NOW() LIMIT 1`;
                const timerDiv = get('active-bonus-timer');
                const noMsg = get('no-bonus-msg');
                const bonusName = get('bonus-name');
                const timeLeft = get('bonus-time-left');

                if (events.length > 0) {
                    const event = events[0];
                    const remainingMs = new Date(event.expires_at) - new Date();
                    if (remainingMs > 0) {
                        const min = Math.floor(remainingMs / 60000);
                        const sec = Math.floor((remainingMs % 60000) / 1000);
                        bonusName.textContent = event.event_type === 'multiplier' ? `${event.event_value}X Score Bonus` : 'Rainbow Event';
                        timeLeft.textContent = `${min}:${sec.toString().padStart(2, '0')}`;
                        timerDiv.style.display = 'block';
                        noMsg.style.display = 'none';
                    } else {
                        timerDiv.style.display = 'none';
                        noMsg.style.display = 'block';
                    }
                } else {
                    timerDiv.style.display = 'none';
                    noMsg.style.display = 'block';
                }
            } catch (e) { console.error('Timer error:', e); }
        }

        setInterval(updateBonusTimer, 1000);

        // PLAYERS DB
        let allPlayers = [];
        let filteredPlayers = [];

        async function loadPlayers() {
            try {
                const sortBy = get('sort-players').value;
                let players;

                if (sortBy === 'newest') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY id DESC LIMIT 1000`;
                } else if (sortBy === 'score') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY score DESC LIMIT 1000`;
                } else if (sortBy === 'coins') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY coins DESC LIMIT 1000`;
                } else if (sortBy === 'time') {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY survival_time DESC LIMIT 1000`;
                } else {
                    players = await sql`SELECT nickname, email, score, survival_time, coins, total_coins, is_vip, last_active FROM users ORDER BY nickname ASC LIMIT 1000`;
                }

                allPlayers = players;
                filteredPlayers = players;
                displayPlayers(filteredPlayers);
                get('total-players').textContent = players.length;
            } catch (e) {
                console.error(e);
                log('მოთამაშეების ჩატვირთვა ვერ მოხერხდა', 'red');
                alert("ჩატვირთვის შეცდომა: " + e.message);
            }
        }

        function displayPlayers(players) {
            const container = get('players-list');
            if (players.length === 0) {
                container.innerHTML = '<p style="text-align: center; width: 100%; opacity: 0.5; padding: 50px;">მოთამაშეები ვერ მოიძებნა</p>';
                return;
            }

            container.innerHTML = players.map(player => {
                const isGuest = player.email.startsWith('guest_');
                const timeFormatted = formatTime(player.survival_time);
                const lastActive = player.last_active ? new Date(player.last_active).toLocaleString('ka-GE') : 'არასდროს';

                return `
                    <div class="player-card ${player.is_vip ? 'vip' : ''}">
                        <div class="player-details">
                            <div class="player-name">
                                ${player.is_vip ? '👑 ' : ''}${player.nickname}
                                ${isGuest ? '<span style="font-size: 0.65rem; background: #333; padding: 2px 6px; border-radius: 4px;">GUEST</span>' : ''}
                            </div>
                            <div style="font-size: 0.8rem; opacity: 0.5;">${player.email}</div>
                        </div>
                        <div class="stats">
                            <span class="stat-badge">⭐ ქულა: <strong>${Math.floor(player.score)}</strong></span>
                            <span class="stat-badge">🪙 ბალანსი: <strong>${player.coins}</strong></span>
                            <span class="stat-badge">💰 სულ: <strong>${player.total_coins || 0}</strong></span>
                            <span class="stat-badge">⏱️ დრო: <strong>${timeFormatted}</strong></span>
                        </div>
                        <div style="margin-top: 15px; font-size: 0.7rem; opacity: 0.4;">აქტიური: ${lastActive}</div>
                        <div class="flex-row gap-5" style="margin-top: 15px;">
                            <button class="btn btn-outline" style="font-size: 0.75rem; padding: 5px 10px;" 
                                onclick="editUser('${player.email}')">✏️ EDIT</button>
                            <button class="btn btn-danger" style="font-size: 0.75rem; padding: 5px 10px;" 
                                onclick="deleteUser('${player.email}')">🗑️ DELETE</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.deleteUser = async (email) => {
            if (!confirm(`ნამდვილად გსურთ მომხმარებლის წაშლა: ${email}?`)) return;
            try {
                await sql`DELETE FROM users WHERE email = ${email}`;
                log(`მომხმარებელი წაიშალა: ${email}`, 'red');
                loadPlayers();
            } catch (e) { log('შეცდომა წაშლისას', 'red'); }
        };

        window.editUser = (email) => {
            const player = allPlayers.find(p => p.email === email);
            if (!player) return;

            const modal = get('edit-user-modal');
            get('edit-user-email').value = player.email;
            get('edit-user-nick').value = player.nickname;
            get('edit-user-score').value = Math.floor(player.score);
            get('edit-user-coins').value = player.coins;
            get('edit-user-total-coins').value = player.total_coins || 0;
            get('edit-user-vip').checked = player.is_vip;

            modal.classList.remove('hidden');
        };

        window.saveUserEdit = async () => {
            const email = get('edit-user-email').value;
            const nick = get('edit-user-nick').value.trim();
            const score = parseInt(get('edit-user-score').value) || 0;
            const coins = parseInt(get('edit-user-coins').value) || 0;
            const totalCoins = parseInt(get('edit-user-total-coins').value) || 0;
            const isVip = get('edit-user-vip').checked;

            try {
                await sql`UPDATE users SET 
                    nickname = ${nick}, 
                    score = ${score}, 
                    coins = ${coins}, 
                    total_coins = ${totalCoins}, 
                    is_vip = ${isVip} 
                    WHERE email = ${email}`;

                log(`მონაცემები განახლდა: ${nick}`, 'green');
                get('edit-user-modal').classList.add('hidden');
                loadPlayers();
            } catch (e) { log('განახლების შეცდომა', 'red'); }
        };

        function formatTime(s) {
            const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sc = s % 60;
            return h > 0 ? `${h}ს ${m}წ` : m > 0 ? `${m}წ ${sc}წ` : `${sc}წ`;
        }

        get('search-player').oninput = () => {
            const q = get('search-player').value.toLowerCase().trim();
            filteredPlayers = q ? allPlayers.filter(p => p.nickname.toLowerCase().includes(q) || p.email.toLowerCase().includes(q)) : allPlayers;
            displayPlayers(filteredPlayers);
        };

        get('refresh-players').onclick = loadPlayers;
        get('sort-players').onchange = loadPlayers;


        // DB SETUP
        // WIPE PROGRESS Logic
        get('wipe-progress-btn').onclick = async () => {
            const confirmed = confirm("⚠️ გაფრთხილება: ნამდვილად გსურთ ყველა მობთამაშის ქულების, ქოინების და დროის განულება?\n\nექაუნთები (იმეილი/პაროლი) შენარჩუნდება, მაგრამ პროგრესი წაიშლება!");
            if (!confirmed) return;

            log('Wiping progress...', 'var(--danger)');
            try {
                await sql`
                    UPDATE users 
                    SET score = 0, 
                        coins = 0, 
                        survival_time = 0, 
                        best_score = 0
                `;

                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('📢 SYSTEM', '🔄 ადმინისტრაციამ მოახდინა ქულების გლობალური განულება! ყველაფერი იწყება 0-დან! 🧼')`;

                const msg = '🎉 ყველა მოთამაშის პროგრესი წარმატებით განულდა!';
                log(msg, 'green');
                alert(msg);
                loadPlayers();
            } catch (e) {
                console.error(e);
                log('შეცდომა განულებისას', 'red');
                alert('შეცდომა: ' + e.message);
            }
        };

        // FULL WIPE Logic
        get('full-wipe-btn').onclick = async () => {
            const confirmed = confirm("🔥 ყურადღება: ნამდვილად გსურთ მთლიანი ბაზის წაშლა?\n\nწაიშლება ყველა იმეილი, პაროლი და ექაუნთი! ამის დაბრუნება შეუძლებელია!");
            if (!confirmed) return;

            log('Deleting ALL data...', 'var(--danger)');
            try {
                await sql`DELETE FROM users`;
                await sql`INSERT INTO chat_messages (nickname, message) VALUES ('📢 SYSTEM', '🔥 ადმინისტრაციამ სრულად გაასუფთავა მომხმარებლების ბაზა!')`;
                log('💥 ბაზა სრულად წაიშალა!', 'red');
                loadPlayers();
            } catch (e) { log('Error: ' + e.message, 'red'); }
        };

        get('run-setup-btn').onclick = async () => {
            if (!confirm("ნამდვილად გსურთ Database Setup? (ეს არ წაშლის არსებულ მონაცემებს)")) return;
            log('Setup იწყება...', 'var(--accent)');
            try {
                // 1. Users table update
                await sql`CREATE TABLE IF NOT EXISTS users (id SERIAL PRIMARY KEY, email VARCHAR(255) UNIQUE NOT NULL, password VARCHAR(255) NOT NULL, nickname VARCHAR(50) NOT NULL, score INTEGER DEFAULT 0, coins INTEGER DEFAULT 0, total_coins INTEGER DEFAULT 0, is_vip BOOLEAN DEFAULT FALSE, survival_time INTEGER DEFAULT 0, best_score INTEGER DEFAULT 0, best_survival_time INTEGER DEFAULT 0, total_survival_time INTEGER DEFAULT 0, last_active TIMESTAMP DEFAULT NOW(), created_at TIMESTAMP DEFAULT NOW())`;
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS total_coins INTEGER DEFAULT 0`; } catch (e) { }
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS best_survival_time INTEGER DEFAULT 0`; } catch (e) { }
                try { await sql`ALTER TABLE users ADD COLUMN IF NOT EXISTS total_survival_time INTEGER DEFAULT 0`; } catch (e) { }

                // 2. Achievements (Match History) table
                await sql`CREATE TABLE IF NOT EXISTS game_results (id SERIAL PRIMARY KEY, user_email VARCHAR(255) REFERENCES users(email) ON DELETE CASCADE, score INTEGER NOT NULL, duration_seconds INTEGER NOT NULL, coins_earned INTEGER NOT NULL, played_at TIMESTAMP DEFAULT NOW())`;

                // 3. Indexes & Supporting tables
                await sql`CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)`;
                await sql`CREATE TABLE IF NOT EXISTS chat_messages (id SERIAL PRIMARY KEY, nickname VARCHAR(50) NOT NULL, message TEXT NOT NULL, created_at TIMESTAMP DEFAULT NOW())`;
                await sql`CREATE TABLE IF NOT EXISTS global_events (event_type VARCHAR(50) PRIMARY KEY, event_value TEXT, expires_at TIMESTAMP)`;

                log('🎉 SETUP დასრულებულია!', 'green');
                loadPlayers();
            } catch (e) { log('Setup Error: ' + e.message, 'red'); }
        };

        get('test-db-btn').onclick = async () => {
            log('კავშირის შემოწმება...', 'white');
            try {
                const res = await sql`SELECT 1 as test`;
                const tables = await sql`SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'`;
                const tNames = tables.map(t => t.table_name);
                alert(`✅ კავშირი OK!\nცხრილები: ${tNames.join(', ')}`);
                log('კავშირი წარმატებულია', 'green');
            } catch (e) { log('DB Error', 'red'); alert('შეცდომა: ' + e.message); }
        };

    </script>
</body>

</html>