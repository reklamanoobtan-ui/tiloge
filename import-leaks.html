<!--
  ğŸ”® áƒ”áƒ áƒ—áƒ¯áƒ”áƒ áƒáƒ“áƒ˜ Leak-áƒ”áƒ‘áƒ˜áƒ¡ áƒ˜áƒ›áƒáƒáƒ áƒ¢áƒ˜
  áƒ’áƒáƒ®áƒ¡áƒ”áƒœáƒ˜ áƒ”áƒ¡ áƒ¤áƒáƒ˜áƒšáƒ˜ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¨áƒ˜ â†’ áƒ¦áƒ˜áƒšáƒáƒ™áƒ–áƒ” áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ” â†’ 15 leak áƒ¨áƒ”áƒ˜áƒ•áƒ¡áƒ”áƒ‘áƒ áƒ‘áƒáƒ–áƒáƒ¨áƒ˜
  áƒ¡áƒ®áƒ•áƒáƒ“áƒáƒ¡áƒ®áƒ•áƒ áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜áƒ— (áƒáƒ®áƒáƒšáƒ˜ áƒ–áƒ”áƒ›áƒáƒ—)
-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Leak Importer</title>
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: monospace;
            padding: 30px;
        }

        button {
            padding: 15px 30px;
            background: #f9a825;
            color: #000;
            border: none;
            font-size: 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        #log {
            margin-top: 20px;
            white-space: pre-wrap;
            line-height: 1.8;
        }
    </style>
</head>

<body>
    <h1>ğŸ”® 15 Leak-áƒ˜áƒ¡ áƒ˜áƒ›áƒáƒáƒ áƒ¢áƒ˜</h1>
    <p>áƒ”áƒ¡ áƒ¡áƒ™áƒ áƒ˜áƒáƒ¢áƒ˜ áƒ©áƒáƒ¡áƒ•áƒáƒ›áƒ¡ 15 leak-áƒ¡ áƒ‘áƒáƒ–áƒáƒ¨áƒ˜ áƒ¡áƒ®áƒ•áƒáƒ“áƒáƒ¡áƒ®áƒ•áƒ áƒ—áƒáƒ áƒ˜áƒ¦áƒ”áƒ‘áƒ˜áƒ—.</p>
    <button onclick="importLeaks()">ğŸš€ áƒ˜áƒ›áƒáƒáƒ áƒ¢áƒ˜áƒ¡ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ</button>
    <div id="log"></div>

    <script type="module">
        import { neon } from 'https://cdn.jsdelivr.net/npm/@neondatabase/serverless@0.9.4/+esm';

        const DB_URL = "postgresql://neondb_owner:npg_NBPsUe3FXb4o@ep-calm-wildflower-aim8iczt-pooler.c-4.us-east-1.aws.neon.tech/neondb?sslmode=require";
        const sql = neon(DB_URL);

        const FANDOM_API = 'https://stealabrainrot.fandom.com/api.php';

        const logEl = document.getElementById('log');
        function log(msg) {
            logEl.textContent += msg + '\n';
        }

        async function getImageUrl(filename) {
            try {
                const resp = await fetch(`${FANDOM_API}?action=query&titles=File:${encodeURIComponent(filename)}&prop=imageinfo&iiprop=url&format=json&origin=*`);
                const data = await resp.json();
                const pages = data.query.pages;
                const pageId = Object.keys(pages)[0];
                if (pages[pageId].imageinfo && pages[pageId].imageinfo.length > 0) {
                    return pages[pageId].imageinfo[0].url;
                }
            } catch (e) { }
            return '';
        }

        const opinions = [
            "áƒ”áƒ¡ áƒ«áƒáƒšáƒ˜áƒáƒœ áƒ¡áƒáƒ˜áƒœáƒ¢áƒ”áƒ áƒ”áƒ¡áƒáƒ“ áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ£áƒ áƒ”áƒ‘áƒ! ğŸ”¥",
            "áƒ›áƒáƒ£áƒ—áƒ›áƒ”áƒœáƒšáƒáƒ“ áƒ•áƒ”áƒšáƒ˜áƒ— áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒáƒ¡! ğŸ®",
            "áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ”áƒáƒ˜áƒ™áƒ£áƒ áƒ˜ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ áƒ˜áƒ¥áƒœáƒ”áƒ‘áƒ! ğŸ’¥",
            "áƒ•áƒ”áƒ  áƒ•áƒ£áƒªáƒ“áƒ˜ áƒáƒ› áƒáƒ¤áƒ“áƒ”áƒ˜áƒ—áƒ¡! ğŸ˜",
            "áƒ”áƒ¡ áƒ£áƒ™áƒ•áƒ” áƒšáƒ”áƒ’áƒ”áƒœáƒ“áƒáƒ áƒ£áƒšáƒ˜áƒ! ğŸ†",
            "áƒ áƒ áƒ›áƒáƒ’áƒáƒ áƒ˜ áƒ“áƒ˜áƒ–áƒáƒ˜áƒœáƒ˜áƒ! ğŸ¨",
            "áƒ—áƒáƒ›áƒáƒ¨áƒ˜ áƒ™áƒ˜áƒ“áƒ”áƒ• áƒ£áƒ¤áƒ áƒ áƒ’áƒáƒ›áƒáƒ’áƒ áƒ“áƒ”áƒ‘áƒ! ğŸ’ª",
            "áƒ¤áƒáƒœáƒ”áƒ‘áƒ¡ áƒ”áƒ¡ áƒ›áƒáƒ”áƒ¬áƒáƒœáƒ”áƒ‘áƒáƒ—! â¤ï¸",
            "áƒ”áƒ¡ áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ¡ áƒ¨áƒ”áƒªáƒ•áƒšáƒ˜áƒ¡! ğŸŒŸ",
            "áƒ¬áƒáƒ áƒ›áƒáƒ£áƒ“áƒ’áƒ”áƒœáƒ”áƒšáƒ˜ áƒ™áƒáƒœáƒ¢áƒ”áƒœáƒ¢áƒ˜ áƒ›áƒáƒ“áƒ˜áƒ¡! ğŸš€",
            "áƒáƒ›áƒáƒ¡ áƒ§áƒ•áƒ”áƒšáƒ áƒ”áƒšáƒáƒ“áƒ”áƒ‘áƒáƒ“áƒ! ğŸ‘€",
            "áƒ áƒ áƒšáƒáƒ›áƒáƒ–áƒ˜áƒ, áƒ›áƒáƒ›áƒ¬áƒáƒœáƒ¡! âœ¨",
            "áƒáƒ®áƒáƒšáƒ˜ áƒ”áƒáƒáƒ¥áƒ áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ! ğŸŒ",
            "áƒ“áƒ”áƒ•áƒ”áƒšáƒáƒáƒ”áƒ áƒ”áƒ‘áƒ›áƒ áƒ˜áƒ›áƒ£áƒ¨áƒáƒ•áƒ”áƒ¡! ğŸ‘",
            "áƒ¢áƒáƒ áƒ’áƒáƒœáƒáƒ®áƒšáƒ”áƒ‘áƒ áƒ›áƒáƒ”áƒ›áƒ–áƒáƒ“áƒ”áƒ—! ğŸ¯"
        ];

        window.importLeaks = async function () {
            try {
                log('ğŸ“¡ Fandom Wiki-áƒ“áƒáƒœ leak-áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒáƒ›áƒáƒ¦áƒ”áƒ‘áƒ...');

                // 1. Fetch wikitext
                const resp = await fetch(`${FANDOM_API}?action=parse&page=Leaks&format=json&prop=wikitext&origin=*`);
                const data = await resp.json();
                const wikitext = data.parse.wikitext['*'];

                // 2. Parse all leaks
                const entries = [];
                const regex = /File:([^\|]+)\|(.+)/g;
                let match;
                while ((match = regex.exec(wikitext)) !== null) {
                    entries.push({
                        filename: match[1].trim(),
                        description: match[2].trim().replace(/\[\[([^\|\]]+)\|?([^\]]*)\]\]/g, (_, link, display) => display || link)
                    });
                }

                log(`ğŸ“‹ áƒ¡áƒ£áƒš ${entries.length} leak áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ`);

                // 3. Take last 15
                const last15 = entries.slice(-15);

                // 4. Check existing
                const existing = await sql`SELECT title FROM news WHERE category = 'Leak ğŸ”®'`;
                const existingSet = new Set(existing.map(e => e.title.toLowerCase().trim()));

                // 5. Create dates â€” spread over last 15 days, oldest first
                // last15[0] = oldest â†’ 15 days ago
                // last15[14] = newest â†’ today
                const now = new Date();

                let addedCount = 0;

                for (let i = 0; i < last15.length; i++) {
                    const leak = last15[i];
                    const title = `ğŸ”® áƒáƒ®áƒáƒšáƒ˜ áƒšáƒ˜áƒ™áƒ˜: ${leak.description}`;

                    if (existingSet.has(title.toLowerCase().trim())) {
                        log(`â­ï¸ áƒ£áƒ™áƒ•áƒ” áƒáƒ áƒ¡áƒ”áƒ‘áƒáƒ‘áƒ¡: ${leak.description}`);
                        continue;
                    }

                    log(`ğŸ–¼ï¸ [${i + 1}/15] áƒ¡áƒ£áƒ áƒáƒ—áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ: ${leak.filename}...`);
                    const imageUrl = await getImageUrl(leak.filename);

                    const opinion = opinions[i % opinions.length];

                    const content = `
                        <p><strong>${leak.description}</strong> â€” áƒáƒ®áƒáƒšáƒ˜ áƒšáƒ˜áƒ™áƒ˜ áƒ’áƒáƒ›áƒáƒ©áƒœáƒ“áƒ!</p>
                        <p>ğŸ’¬ <em>áƒáƒ•áƒ¢áƒ-áƒ›áƒáƒ“áƒ”áƒ áƒáƒ¢áƒáƒ áƒ˜áƒ¡ áƒáƒ–áƒ áƒ˜:</em> <strong>${opinion}</strong></p>
                        <p>áƒ¬áƒ§áƒáƒ áƒ: <a href="https://stealabrainrot.fandom.com/wiki/Leaks" target="_blank">Steal a Brainrot Fandom Wiki</a></p>
                        <p style="opacity:0.5;font-size:0.85em;">ğŸ”® áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ¡áƒ˜áƒœáƒ¥áƒ áƒáƒœáƒ˜áƒ–áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ</p>
                    `;

                    // Date: oldest leak = 15 days ago, newest = now
                    // Spread evenly: index 0 = -15 days, index 14 = 0 days
                    const daysAgo = (last15.length - 1 - i);
                    const hoursOffset = Math.floor(Math.random() * 12); // random hour within the day
                    const leakDate = new Date(now);
                    leakDate.setDate(leakDate.getDate() - daysAgo);
                    leakDate.setHours(8 + hoursOffset, Math.floor(Math.random() * 60), 0);
                    const dateStr = leakDate.toISOString();

                    await sql`INSERT INTO news (title, content, image_url, video_url, category, created_at) VALUES (${title}, ${content}, ${imageUrl}, ${''}, ${'Leak ğŸ”®'}, ${dateStr})`;

                    log(`âœ… [${i + 1}/15] áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒ: "${leak.description}" â€” ${leakDate.toLocaleDateString()}`);
                    addedCount++;
                }

                log('');
                log(`ğŸ‰ áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ! ${addedCount} leak áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒ áƒ‘áƒáƒ–áƒáƒ¨áƒ˜.`);
                log('áƒáƒ®áƒšáƒ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒ áƒ”áƒ¡ áƒ¤áƒáƒ˜áƒšáƒ˜ áƒ¬áƒáƒ¨áƒáƒšáƒ áƒ“áƒ áƒ¡áƒáƒ˜áƒ¢áƒ–áƒ” áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ!');

            } catch (e) {
                log(`âŒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ${e.message}`);
                console.error(e);
            }
        };
    </script>
</body>

</html>