<!DOCTYPE html>
<html lang="ka">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1P900RJ6DJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-1P900RJ6DJ');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TILO.LIFE - áƒ§áƒ•áƒ”áƒšáƒ áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒ‘áƒ˜áƒ£áƒ¡áƒ˜</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Outfit:wght@400;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="news.css">
    <link rel="stylesheet" href="settings.css">
    <link rel="stylesheet" href="ratings.css">
    <script src="security.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5131926411609590"
        crossorigin="anonymous"></script>
    <style>
        .abuse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .abuse-card {
            background: var(--news-card-bg);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid var(--news-border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .abuse-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--news-shadow);
            border-color: var(--news-primary);
        }

        .abuse-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .abuse-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            flex: 1;
        }

        .timer-badge {
            display: inline-block;
            padding: 8px 15px;
            background: rgba(0, 102, 204, 0.1);
            color: var(--news-primary);
            border-radius: 50px;
            font-weight: 800;
            font-family: monospace;
            font-size: 1.1rem;
            text-align: center;
        }

        .suggest-section {
            margin-top: 60px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--news-border);
            border-radius: 30px;
            backdrop-filter: blur(10px);
        }

        .top-suggestion-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--news-border);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: 0.3s;
        }

        .top-suggestion-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--news-primary);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="news-portal">

    <!-- Header -->
    <header class="news-header">
        <div class="header-container">
            <a href="index.html" class="logo-text">TILO<span>.LIFE</span></a>
            <nav class="nav-menu">
                <a href="index.html" id="nav-home" class="nav-link">áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜</a>
                <a href="game.html" id="nav-game" class="nav-link">áƒ—áƒáƒ›áƒáƒ¨áƒ˜</a>
            </nav>
            <div class="auth-nav">
                <div id="language-switcher"
                    style="display: flex; gap: 5px; margin-right: 15px; background: rgba(255,255,255,0.05); padding: 5px; border-radius: 50px; border: 1px solid var(--news-border);">
                    <button id="lang-ka" class="lang-btn active" onclick="switchLanguage('ka')"
                        style="background: var(--news-primary); color: white; border: none; padding: 5px 12px; border-radius: 50px; cursor: pointer; font-weight: 800; font-size: 0.7rem; transition: 0.3s;">GE</button>
                    <button id="lang-en" class="lang-btn" onclick="switchLanguage('en')"
                        style="background: none; color: var(--news-text); border: none; padding: 5px 12px; border-radius: 50px; cursor: pointer; font-weight: 800; font-size: 0.7rem; transition: 0.3s;">EN</button>
                </div>
                <a href="index.html" id="btn-back" class="nav-link">ğŸ  áƒ£áƒ™áƒáƒœ</a>
            </div>
        </div>
    </header>

    <div class="portal-container" style="display: block;">
        <h1 id="page-title"
            style="font-weight: 900; margin-bottom: 30px; display: flex; align-items: center; gap: 15px;">
            ğŸ’  áƒ§áƒ•áƒ”áƒšáƒ áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒ‘áƒ˜áƒ£áƒ¡áƒ˜
        </h1>

        <div id="all-abuse-list" class="abuse-grid">
            <p id="loading-text" style="text-align: center; grid-column: 1/-1; padding: 50px; opacity: 0.5;">
                áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</p>
        </div>

        <!-- Suggestion Section -->
        <section class="suggest-section">
            <div style="text-align: center; margin-bottom: 40px;">
                <h2 id="qa-title" style="font-weight: 900; font-size: 2rem;">ğŸ’¡ áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ-áƒáƒáƒ¡áƒ£áƒ®áƒ˜</h2>
                <p id="qa-desc" style="opacity: 0.7; font-size: 1.1rem; margin-top: 10px;">áƒ áƒáƒ›áƒ”áƒšáƒ˜ áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒ‘áƒ˜áƒ£áƒ¡áƒ˜
                    áƒ“áƒáƒ•áƒáƒ›áƒáƒ¢áƒáƒ— áƒ™áƒ˜áƒ“áƒ”áƒ•?</p>
            </div>

            <div style="display: flex; gap: 15px; max-width: 600px; margin: 0 auto 40px;">
                <input type="text" id="suggestion-input" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ”áƒ— áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜..."
                    style="flex: 1; padding: 15px 25px; border-radius: 15px; border: 1px solid var(--news-border); background: var(--news-bg); color: var(--news-text); font-weight: 600; font-size: 1rem;">
                <button id="submit-suggest-btn" class="action-btn" style="padding: 0 30px;">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>
            </div>

            <div style="text-align: center; margin-bottom: 25px;">
                <h3 id="top-qa-title" style="font-weight: 800; font-size: 1.4rem; color: var(--news-primary);">ğŸ”¥ TOP 3
                    áƒáƒáƒ¡áƒ£áƒ®áƒ˜</h3>
            </div>

            <div id="top-suggestions-list" style="display: grid; gap: 15px; max-width: 600px; margin: 0 auto;">
                <!-- Top 3 suggestions load here -->
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="news-footer">
        <div class="footer-container">
            <h2 class="logo-text">TILO<span>.LIFE</span></h2>
            <p id="footer-rights" style="opacity: 0.6; margin-top: 10px;">áƒ§áƒ•áƒ”áƒšáƒ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ áƒ“áƒáƒªáƒ£áƒšáƒ˜áƒ &copy; 2026</p>

            <div class="footer-counters">
                <!-- TOP.GE ASYNC COUNTER CODE -->
                <div id="top-ge-counter-container" data-site-id="118538"></div>
                <script async src="//counter.top.ge/counter.js"></script>

                <!-- WAUST.AT COUNTER CODE -->
                <script
                    id="_wau3mz">var _wau = _wau || []; _wau.push(["dynamic", "rcj6goig4h", "3mz", "c4302bffffff", "small"]);</script>
                <script async src="//waust.at/d.js"></script>
            </div>

            <div id="footer-links"
                style="margin-top:20px; display:flex; justify-content:center; gap:20px; flex-wrap:wrap; font-size: 0.85rem;">
                <a href="privacy.html" style="color:var(--news-primary); text-decoration:none;">ğŸ”’ áƒ™áƒáƒœáƒ¤áƒ˜áƒ“áƒ”áƒœáƒªáƒ˜áƒáƒšáƒ£áƒ áƒáƒ‘áƒ</a>
                <a href="about.html" style="color:var(--news-primary); text-decoration:none;">ğŸŒ áƒ©áƒ•áƒ”áƒœ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘</a>
                <a href="mailto:contact@tilo.life" style="color:var(--news-primary); text-decoration:none;">ğŸ“§
                    áƒ™áƒáƒœáƒ¢áƒáƒ¥áƒ¢áƒ˜</a>
            </div>
        </div>
    </footer>

    <script type="module">
        import { neon } from 'https://cdn.jsdelivr.net/npm/@neondatabase/serverless@0.9.4/+esm';
        const DB_URL = "postgresql://neondb_owner:npg_NBPsUe3FXb4o@ep-calm-wildflower-aim8iczt-pooler.c-4.us-east-1.aws.neon.tech/neondb?sslmode=require";
        const sql = neon(DB_URL);

        const userEmail = localStorage.getItem('tilo_email');
        const nickname = localStorage.getItem('tilo_nick');

        let currentLang = localStorage.getItem('tilo_lang') || 'ka';

        const translations = {
            ka: {
                home: "áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜",
                game: "áƒ—áƒáƒ›áƒáƒ¨áƒ˜",
                back: "ğŸ  áƒ£áƒ™áƒáƒœ",
                pageTitle: "ğŸ’  áƒ§áƒ•áƒ”áƒšáƒ áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒ‘áƒ˜áƒ£áƒ¡áƒ˜",
                loading: "áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...",
                noAbuse: "áƒ¡áƒšáƒáƒ¢áƒ”áƒ‘áƒ˜ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ áƒ˜áƒ¡.",
                qaTitle: "ğŸ’¡ áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ-áƒáƒáƒ¡áƒ£áƒ®áƒ˜",
                qaDesc: "áƒ áƒáƒ›áƒ”áƒšáƒ˜ áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒáƒ“áƒ›áƒ˜áƒœ áƒáƒ‘áƒ˜áƒ£áƒ¡áƒ˜ áƒ“áƒáƒ•áƒáƒ›áƒáƒ¢áƒáƒ— áƒ™áƒ˜áƒ“áƒ”áƒ•?",
                suggestPlaceholder: "áƒ“áƒáƒ¬áƒ”áƒ áƒ”áƒ— áƒ—áƒáƒ›áƒáƒ¨áƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜...",
                send: "áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ",
                topQa: "ğŸ”¥ TOP 3 áƒáƒáƒ¡áƒ£áƒ®áƒ˜",
                noSuggestions: "áƒ¯áƒ”áƒ  áƒáƒáƒ¡áƒ£áƒ®áƒ”áƒ‘áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡.",
                go: "ğŸš€ áƒ’áƒáƒ“áƒáƒ¡áƒ•áƒšáƒ",
                finished: "áƒ“áƒáƒ¡áƒ áƒ£áƒšáƒ“áƒ",
                wait: "â±ï¸",
                rights: "áƒ§áƒ•áƒ”áƒšáƒ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ áƒ“áƒáƒªáƒ£áƒšáƒ˜áƒ &copy; 2026",
                privacy: "ğŸ”’ áƒ™áƒáƒœáƒ¤áƒ˜áƒ“áƒ”áƒœáƒªáƒ˜áƒáƒšáƒ£áƒ áƒáƒ‘áƒ",
                about: "ğŸŒ áƒ©áƒ•áƒ”áƒœ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘",
                contact: "ğŸ“§ áƒ™áƒáƒœáƒ¢áƒáƒ¥áƒ¢áƒ˜",
                thanks: "áƒ›áƒáƒ“áƒšáƒáƒ‘áƒ, áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒáƒáƒ¡áƒ£áƒ®áƒ˜ áƒ“áƒáƒ¤áƒ˜áƒ¥áƒ¡áƒ˜áƒ áƒ“áƒ!",
                authReq: "áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ’áƒáƒ˜áƒáƒ áƒáƒ— áƒáƒ•áƒ¢áƒáƒ áƒ˜áƒ–áƒáƒªáƒ˜áƒ",
                alreadyLiked: "áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ£áƒ™áƒ•áƒ” áƒ“áƒáƒáƒšáƒáƒ˜áƒ¥áƒ”áƒ— áƒ”áƒ¡ áƒáƒáƒ¡áƒ£áƒ®áƒ˜",
                enterText: "áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜",
                day: "áƒ“",
            },
            en: {
                home: "Home",
                game: "Game",
                back: "ğŸ  Back",
                pageTitle: "ğŸ’  All Admin Abuse",
                loading: "Loading...",
                noAbuse: "No abuse slots yet.",
                qaTitle: "ğŸ’¡ Q&A",
                qaDesc: "Which game's admin abuse should we add next?",
                suggestPlaceholder: "Write the game name...",
                send: "Send",
                topQa: "ğŸ”¥ TOP 3 Answers",
                noSuggestions: "No answers yet.",
                go: "ğŸš€ Go To",
                finished: "Finished",
                wait: "â±ï¸",
                rights: "All Rights Reserved &copy; 2026",
                privacy: "ğŸ”’ Privacy Policy",
                about: "ğŸŒ About Us",
                contact: "ğŸ“§ Contact",
                thanks: "Thanks, your response has been recorded!",
                authReq: "Please authorize first",
                alreadyLiked: "You already liked this answer",
                enterText: "Please enter text",
                day: "d",
            }
        };

        const get = id => document.getElementById(id);

        async function translateToEn(text) {
            if (!text || !/[áƒ-áƒ°]/.test(text)) return text;
            try {
                const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=ka&tl=en&dt=t&q=${encodeURIComponent(text)}`;
                const res = await fetch(url);
                const data = await res.json();
                if (data && data[0]) return data[0].map(x => x[0]).join('');
                return text;
            } catch (e) { return text; }
        }

        function applyLanguage() {
            const t = translations[currentLang];
            if (get('nav-home')) get('nav-home').textContent = t.home;
            if (get('nav-game')) get('nav-game').textContent = t.game;
            if (get('btn-back')) get('btn-back').textContent = t.back;
            if (get('page-title')) get('page-title').textContent = t.pageTitle;
            if (get('loading-text')) get('loading-text').textContent = t.loading;
            if (get('qa-title')) get('qa-title').textContent = t.qaTitle;
            if (get('qa-desc')) get('qa-desc').textContent = t.qaDesc;
            if (get('suggestion-input')) get('suggestion-input').placeholder = t.suggestPlaceholder;
            if (get('submit-suggest-btn')) get('submit-suggest-btn').textContent = t.send;
            if (get('top-qa-title')) get('top-qa-title').textContent = t.topQa;
            if (get('footer-rights')) get('footer-rights').innerHTML = t.rights;

            const links = get('footer-links').querySelectorAll('a');
            if (links[0]) links[0].textContent = t.privacy;
            if (links[1]) links[1].textContent = t.about;
            if (links[2]) links[2].textContent = t.contact;

            document.querySelectorAll('.lang-btn').forEach(b => {
                b.style.background = 'none';
                b.style.color = 'var(--news-text)';
            });
            const activeBtn = get('lang-' + currentLang);
            if (activeBtn) {
                activeBtn.style.background = 'var(--news-primary)';
                activeBtn.style.color = 'white';
            }
        }

        window.switchLanguage = (lang) => {
            currentLang = lang;
            localStorage.setItem('tilo_lang', lang);
            applyLanguage();
            loadAllAbuse();
            loadTopSuggestions();
        };

        async function loadAllAbuse() {
            const container = document.getElementById('all-abuse-list');
            const t = translations[currentLang];
            try {
                const slots = await sql`
                    SELECT * FROM admin_abuse 
                    ORDER BY 
                        CASE WHEN end_time > NOW() THEN 0 ELSE 1 END, 
                        end_time ASC, 
                        created_at DESC
                `;

                if (slots.length === 0) {
                    container.innerHTML = `<p style="text-align: center; grid-column: 1/-1; padding: 50px; opacity: 0.5;">${t.noAbuse}</p>`;
                    return;
                }

                container.innerHTML = '';
                for (const s of slots) {
                    const card = document.createElement('div');
                    card.className = 'abuse-card';

                    const img = s.image_url || 'https://images.unsplash.com/photo-1542751371-adc38448a05e?auto=format&fit=crop&q=80&w=1000';
                    const timerId = `timer-${s.id}`;
                    let title = s.title;
                    if (currentLang === 'en') title = await translateToEn(title);

                    card.innerHTML = `
                        <img src="${img}" class="abuse-img">
                        <div class="abuse-body">
                            <h3 style="font-weight: 800; font-size: 1.2rem;">${title}</h3>
                            <div class="timer-badge" id="${timerId}">00:00:00</div>
                            <button onclick="window.open('${s.link_url}', '_blank')" class="action-btn" style="width:100%; margin-top:auto;">${t.go}</button>
                        </div>
                    `;
                    container.appendChild(card);

                    const updateTimer = () => {
                        const el = document.getElementById(timerId);
                        if (!el) return;
                        if (!s.end_time) { el.textContent = t.wait; return; }
                        const now = new Date();
                        const end = new Date(s.end_time);
                        const diff = end - now;
                        if (diff <= 0) { el.textContent = t.finished; el.style.color = "#ff4757"; return; }
                        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const sv = Math.floor((diff % (1000 * 60)) / 1000);
                        let timeStr = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${sv.toString().padStart(2, '0')}`;
                        if (d > 0) timeStr = `${d}${t.day} ${timeStr}`;
                        el.textContent = timeStr;
                    };
                    updateTimer();
                    setInterval(updateTimer, 1000);
                }
            } catch (e) { console.error(e); }
        }

        async function loadTopSuggestions() {
            const list = document.getElementById('top-suggestions-list');
            const t = translations[currentLang];
            try {
                const suggestions = await sql`
                    SELECT LOWER(TRIM(suggest_text)) as text, SUM(likes) as total_likes, MAX(suggest_text) as original_text
                    FROM abuse_suggestions
                    GROUP BY LOWER(TRIM(suggest_text))
                    ORDER BY total_likes DESC, MAX(created_at) DESC
                    LIMIT 3
                `;

                if (suggestions.length === 0) {
                    list.innerHTML = `<p style="text-align: center; opacity: 0.5;">${t.noSuggestions}</p>`;
                    return;
                }

                list.innerHTML = '';
                for (let i = 0; i < suggestions.length; i++) {
                    const s = suggestions[i];
                    let text = s.original_text;
                    if (currentLang === 'en') text = await translateToEn(text);

                    const item = document.createElement('div');
                    item.className = 'top-suggestion-item';
                    item.style.animation = `slideIn 0.3s ease-out backwards`;
                    item.style.animationDelay = `${i * 0.1}s`;

                    item.innerHTML = `
                        <div style="font-size: 1.5rem; font-weight: 900; color: var(--news-primary); min-width: 30px;">#${i + 1}</div>
                        <div style="flex: 1; font-weight: 700; font-size: 1.1rem; color: var(--news-text);">${text}</div>
                        <button onclick="likeSuggestion('${s.text}')" id="like-btn-${s.text.replace(/\s+/g, '-')}"
                            style="background: ${localStorage.getItem('liked_' + s.text) ? 'var(--news-primary)' : 'rgba(255,255,255,0.1)'}; 
                                   border: none; padding: 8px 15px; border-radius: 10px; color: #fff; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 800; transition: 0.3s;">
                            â¤ï¸ <span>${s.total_likes}</span>
                        </button>
                    `;
                    list.appendChild(item);
                }
            } catch (e) { console.error(e); }
        }

        window.likeSuggestion = async (text) => {
            const t = translations[currentLang];
            if (!userEmail) return alert(t.authReq);
            if (localStorage.getItem('liked_' + text)) return alert(t.alreadyLiked);

            try {
                const groupRes = await sql`SELECT id FROM abuse_suggestions WHERE LOWER(TRIM(suggest_text)) = ${text} LIMIT 1`;
                if (groupRes.length === 0) return;

                const suggestId = groupRes[0].id;
                await sql`INSERT INTO suggestion_likes (suggestion_id, user_email) VALUES (${suggestId}, ${userEmail})`;
                await sql`UPDATE abuse_suggestions SET likes = likes + 1 WHERE LOWER(TRIM(suggest_text)) = ${text}`;

                localStorage.setItem('liked_' + text, 'true');
                loadTopSuggestions();
            } catch (e) {
                console.error(e);
                if (e.message.includes('unique')) alert(t.alreadyLiked);
            }
        };

        document.getElementById('submit-suggest-btn').onclick = async () => {
            const t = translations[currentLang];
            const input = document.getElementById('suggestion-input');
            const text = input.value.trim();
            if (!text) return alert(t.enterText);

            try {
                await sql`INSERT INTO abuse_suggestions (suggest_text, nickname) VALUES (${text}, ${nickname || 'Guest'})`;
                input.value = '';
                alert(t.thanks);
                loadTopSuggestions();
            } catch (e) { console.error(e); }
        };

        applyLanguage();
        loadAllAbuse();
        loadTopSuggestions();

        if (localStorage.getItem('tilo_dark_mode') !== 'false') document.body.classList.add('dark-mode');

        setInterval(() => {
            document.querySelectorAll('.footer-counters a').forEach(a => {
                if (a.getAttribute('target') !== '_blank') a.setAttribute('target', '_blank');
            });
        }, 3000);
    </script>
</body>

</html>